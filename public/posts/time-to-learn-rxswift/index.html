<!DOCTYPE html>
<html>

<head>
  <meta content="width=device-width,initial-scale=1" name="viewport" />
  <meta charset="UTF-8">
  <link rel="icon" href="https://fav.farm/ğŸ‘»" />
  <title>
æ˜¯æ—¶å€™å­¦ä¹  RxSwift äº†
</title>
  <link rel="stylesheet" href="/assets/main.css?6&#x2F;2ShUT3RYeReiJdlrDhZN+03rWSUD7DPccwza9UdPM=" />
  <script async defer data-domain="limboy.me" src="https://analytics.limboy.me/js/plausible.js"></script>
  
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@_limboy">
<meta name="twitter:site" content="@_limboy">
<meta property="og:url" content="https://limboy.me/posts/time-to-learn-rxswift/">

<meta name="twitter:title" content="æ˜¯æ—¶å€™å­¦ä¹  RxSwift äº†">
<meta property="og:title" content="æ˜¯æ—¶å€™å­¦ä¹  RxSwift äº†">

<meta property="og:description" content="">
<meta name="twitter:description" content="">



</head>

<body class="  ">
  <nav class="flex justify-center items-center opacity-80 bg-black h-12 py-0 ">
    <div class="inner flex justify-between flex-row mx-1">
      <ul class="color-white flex flex-row justify-start gap-4">
        <li><a class="nav-link opacity-90 text-2xl" href="/">Limboy</a></li>
        <!--<li><a class="nav-link" href="/coodle">Coodle</a></li>-->
      </ul>
      <ul class="color-white flex flex-row gap-4 items-center text-base">
        <!--<li> <a class="nav-link" href="/books" class="decoration-0"> Books </a> </li>-->
        <li> <a class="nav-link" href="/highlights" class="decoration-0"> Highlights </a> </li>
        <li> <a class="nav-link" href="/projects" class="decoration-0"> Projects </a> </li>
        <li> <a class="nav-link" href="/about" class="decoration-0"> About </a> </li>
      </ul>
    </div>
  </nav>

  <div class="flex flex-col">
    <div id="wrapper" class="flex justify-center" style="min-height: calc(100vh - 6.5rem);">
      <div class="inner mb-2">
        
<div class="mt-4 lg:mt-6">
  

  <h1 class="title font-medium text-3xl"><a href="https:&#x2F;&#x2F;limboy.me&#x2F;posts&#x2F;time-to-learn-rxswift&#x2F;">æ˜¯æ—¶å€™å­¦ä¹  RxSwift äº†</a></h1>
  <div class="flex gap-4 items-center my-1">
    <time class="text-gray-500">2016-12-11</time>

  </div>
  <hr class="border-t-[3px]" />

  <div class="prose lg:prose-xl max-w-full my-6">
    <p>ç›¸ä¿¡åœ¨è¿‡å»çš„ä¸€æ®µæ—¶é—´é‡Œï¼Œå¯¹ RxSwift å¤šå°‘æœ‰è¿‡æ¥è§¦æˆ–è€³é—»ï¼Œæˆ–è€…å·²ç»ç§¯ç´¯äº†ä¸å°‘å®æˆ˜ç»éªŒã€‚æ­¤æ–‡ä¸»è¦é’ˆå¯¹é‚£äº›åœ¨é—¨å£å¾˜å¾Šï¼Œæƒ³è¿›åˆæ‹è¸©å‘çš„åŒå­¦ã€‚</p>
<h3 id="wei-shi-yao-yao-xue-xi-rxswift">ä¸ºä»€ä¹ˆè¦å­¦ä¹  RxSwift</h3>
<p>å½“å†³å®šåšä¸€ä»¶äº‹æƒ…æ—¶ï¼Œè‡³å°‘è¦çŸ¥é“ä¸ºä»€ä¹ˆã€‚RxSwift å®˜ç½‘ä¸¾äº†<a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Why.md">å‡ ä¸ªä¾‹å­</a>ï¼Œæ¯”å¦‚å¯ä»¥ç»Ÿä¸€å¤„ç† <code>Delegate</code>, <code>KVO</code>, <code>Notification</code>ï¼Œå¯ä»¥ç»‘å®š UIï¼Œæ–¹ä¾¿ç½‘ç»œè¯·æ±‚çš„å¤„ç†ç­‰ç­‰ã€‚ä½†è¿™äº›æ›´å¤šçš„æ˜¯æè¿°å¯ä»¥ç”¨ RxSwift æ¥åšä»€ä¹ˆï¼Œè·Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨ RxSwift è¿˜æ˜¯ä¼šæœ‰ç‚¹ä¸åŒã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹ GUI ç¼–ç¨‹çš„æœ¬è´¨ï¼Œæˆ‘å–œæ¬¢æŠŠå®ƒæŠ½è±¡ä¸ºè§†å›¾å’Œæ•°æ®çš„ç»“åˆã€‚å…¶ä¸­è§†å›¾è´Ÿè´£ä¸¤ä»¶äº‹ï¼šå±•ç¤ºå’Œäº¤äº’ï¼Œå±•ç¤ºä»€ä¹ˆç”±æ•°æ®å†³å®šã€‚</p>

<p  style="text-align:center" ><img src="&#x2F;posts&#x2F;time-to-learn-rxswift&#x2F;14814474678383.jpg"
        width="1276" /></p>
<p>å…¶ä¸­å•å‘æ•°æ®æµå¯ä»¥é€šè¿‡<a href="http://limboy.me/tech/2016/12/04/reswift-analyze.html">ä¹‹å‰ä»‹ç»çš„ ReSwift</a> å®Œæˆã€‚çœ‹èµ·æ¥å¥½åƒæ²¡ RxSwift ä»€ä¹ˆäº‹æƒ…ï¼Œå…¶å®ä¸ç„¶ï¼ŒRxSwift å¯ä»¥åœ¨ UniDirectional Data Flow çš„å„ä¸ªé˜¶æ®µéƒ½å‘æŒ¥ä½œç”¨ï¼Œä»è€Œè®© Data çš„å¤„ç†å’ŒæµåŠ¨æ›´åŠ ç®€æ´å’Œæ¸…æ™°ã€‚</p>

<p  style="text-align:center" ><img src="&#x2F;posts&#x2F;time-to-learn-rxswift&#x2F;14814474032179.jpg"
        width="1272" /></p>
<ol>
<li>é€šè¿‡å¯¹ RxCocoa çš„å„ç§å›è°ƒè¿›è¡Œç»Ÿä¸€å¤„ç†ï¼Œæ–¹ä¾¿äº†ã€ŒInteractã€çš„å¤„ç†ã€‚</li>
<li>é€šè¿‡å¯¹ <code>Observable</code> çš„ transform å’Œ compositeï¼Œæ–¹ä¾¿äº† <code>Action</code> çš„ç”Ÿæˆï¼ˆæ¯”å¦‚ä½¿ç”¨ <code>throttle</code> æ¥å‹ç¼© <code>Action</code>ï¼‰ã€‚</li>
<li>é€šè¿‡å¯¹ç½‘ç»œè¯·æ±‚ä»¥åŠå…¶ä»–å¼‚æ­¥æ•°æ®çš„è·å–è¿›è¡Œ <code>Observable</code> å°è£…ï¼Œæ–¹ä¾¿äº†å¼‚æ­¥æ•°æ®çš„å¤„ç†ã€‚</li>
<li>é€šè¿‡ RxCocoa çš„ bindingï¼Œæ–¹ä¾¿äº†æ•°æ®çš„æ¸²æŸ“ã€‚</li>
</ol>
<p>æ‰€ä»¥ ReSwift è§„èŒƒäº†æ•°æ®æµï¼ŒRxSwift ä¸ºæ•°æ®çš„å¤„ç†æä¾›äº†æ–¹ä¾¿ï¼Œè¿™ä¸¤ä¸ªç±»åº“çš„ç»“åˆï¼Œå¯ä»¥äº§ç”Ÿæ¸…æ™°çš„æ¶æ„å’Œæ˜“ç»´æŠ¤çš„ä»£ç ã€‚</p>
<p>å½“ç„¶ï¼Œå‰ææ˜¯å¯¹å®ƒä»¬æœ‰è¶³å¤Ÿçš„äº†è§£ï¼Œå°¤å…¶æ˜¯ RxSwiftï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’ã€‚</p>
<h3 id="shi-yao-shi-rxswift">ä»€ä¹ˆæ˜¯ RxSwift</h3>
<p>åœ¨ GUI ç¼–ç¨‹ä¸­ï¼Œæˆ‘è®¤ä¸ºæ¯”è¾ƒå¤æ‚çš„æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>éåŸç”Ÿ UI æ•ˆæœçš„å®ç°ï¼ˆæ¯”å¦‚äº§å“ç»ç†ä»¬ç»å¸¸å†’å‡ºæ¥çš„å„ç§æƒ³æ³•ï¼‰ã€‚</li>
<li>å¤§é‡çŠ¶æ€çš„ç»´æŠ¤ã€‚</li>
<li>å¼‚æ­¥æ•°æ®çš„å¤„ç†ã€‚</li>
</ol>
<p>1ï¼‰ä¸åœ¨è¿™æ¬¡çš„è®¨è®ºèŒƒç•´ï¼ˆè¿™é‡Œçš„å­¦é—®ä¹Ÿå¾ˆå¤šï¼Œæ¯”å¦‚æµç•…æ€§å’Œæ€§èƒ½ï¼‰ã€‚2) å¯ä»¥é€šè¿‡å•å‘æ•°æ®æµæ¥è§£å†³ï¼ˆç»“åˆ Immutable Dataï¼‰ã€‚3) å¯ä»¥é€šè¿‡ RxSwift æ¥è§£å†³ã€‚é‚£ä¹ˆ RxSwift æ˜¯å¦‚ä½•å¤„ç†å¼‚æ­¥æ•°æ®çš„å‘¢ï¼Ÿ</p>
<p>åœ¨è¯´ RxSwift ä¹‹å‰ï¼Œå…ˆæ¥è¯´ä¸‹ Rxï¼Œ <a href="http://reactivex.io/">ReactiveX</a> æ˜¯ä¸€ç§ç¼–ç¨‹æ¨¡å‹ï¼Œæœ€åˆç”±å¾®è½¯å¼€å‘ï¼Œç»“åˆäº†è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼å’Œå‡½æ•°å¼ç¼–ç¨‹çš„ç²¾åï¼Œæ¥æ›´æ–¹ä¾¿åœ°å¤„ç†å¼‚æ­¥æ•°æ®æµã€‚å…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µæ˜¯ <code>Observable</code>ã€‚</p>
<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå½“åˆ«äººåœ¨è·Ÿä½ è¯´è¯æ—¶ï¼Œä½ å°±æ˜¯é‚£ä¸ªè§‚å¯Ÿè€…ï¼Œåˆ«äººå°±æ˜¯é‚£ä¸ª <code>Observable</code>ï¼Œå®ƒæœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<ol>
<li>å¯èƒ½ä¼šä¸æ–­åœ°è·Ÿä½ è¯´è¯ã€‚ï¼ˆ<code>onNext:</code>ï¼‰</li>
<li>å¯èƒ½ä¼šè¯´é”™è¯ã€‚ï¼ˆ<code>onError:</code>ï¼‰</li>
<li>ç»“æŸä¼šè¯´è¯ã€‚ï¼ˆ<code>onCompleted</code>ï¼‰</li>
</ol>
<p>ä½ åœ¨å¬åˆ°å¯¹æ–¹è¯´çš„è¯åï¼Œä¹Ÿå¯ä»¥æœ‰å‡ ç§ååº”ï¼š</p>
<ol>
<li>æ ¹æ®è¯´çš„è¯ï¼Œåšç›¸åº”çš„äº‹ï¼Œæ¯”å¦‚å¯¹æ–¹è®©ä½ å€Ÿæœ¬ä¹¦ç»™ä»–ã€‚ï¼ˆ<code>subscribe</code>ï¼‰</li>
<li>æŠŠå¯¹æ–¹è¯´çš„è¯ï¼ŒåŠ å·¥ä¸‹å†ä¼ è¾¾ç»™å…¶ä»–äººï¼Œæ¯”å¦‚å¯¹æ–¹è¯´å°å¼ å¥½åƒä¸å¤ªèˆ’æœï¼Œä½ ä¼ è¾¾ç»™å…¶ä»–äººæ—¶å°±å˜æˆäº†å°å¼ å¤±æ‹äº†ã€‚ï¼ˆ<code>map:</code>ï¼‰</li>
<li>å‚è€ƒå…¶ä»–äººè¯´çš„è¯å†åšå¤„ç†ï¼Œæ¯”å¦‚ A è¯´æŸå®¶åº—å¾ˆå¥½åƒï¼ŒB è¯´æŸå®¶åº—ä¸€èˆ¬èˆ¬ï¼Œä½ éœ€è¦ç»“åˆä¸¤ä¸ªäººçš„æ„è§å†åšå®šå¤ºã€‚ï¼ˆ<code>zip:</code>ï¼‰</li>
</ol>
<p>æ‰€ä»¥ï¼Œä»ç”Ÿæ´»ä¸­ä¹Ÿèƒ½çœ‹åˆ° Rx çš„å½±å­ã€‚ã€Œæœ‰äº›äº‹æƒ…æ€¥ä¸å¾—ï¼Œä½ å¾—ç­‰å®ƒè‡ªå·±ç†Ÿã€ï¼Œå¼‚æ­¥ï¼Œå…¶å®å°±æ˜¯è·Ÿæ—¶é—´æ‰“äº¤é“ï¼Œä¸åŒçš„æ—¶é—´ï¼Œæ‹¿åˆ°çš„æ•°æ®ä¹Ÿä¼šä¸ä¸€æ ·ã€‚å¯ä»¥<a href="http://rxmarbles.com">åœ¨çº¿æ„Ÿå—ä¸‹</a></p>

<p  style="text-align:center" ><img src="&#x2F;posts&#x2F;time-to-learn-rxswift&#x2F;14814518766811.jpg"
        width="1626" /></p>
<p>è¿™é‡Œçš„æ ¸å¿ƒæ˜¯å½“æ•°æ®æœ‰å˜åŒ–æ—¶ï¼Œèƒ½å¤Ÿç«‹åˆ»çŸ¥æ™“ï¼Œå¹¶ä¸”é€šè¿‡ç»„åˆå’Œè½¬æ¢åï¼Œå¯ä»¥å³æ—¶ä½œå‡ºå“åº”ã€‚æœ‰ç‚¹åƒå¡”é˜²ï¼Œå…ˆåœ¨è·¯ä¸Šçš„å„ä¸ªèŠ‚ç‚¹åŸ‹å¥½æ­¦å™¨ï¼Œç„¶åç­‰ç€å°æ€ªå…½ä»¬è¿‡æ¥ã€‚</p>
<h3 id="rxswift-workflow">RxSwift Workflow</h3>
<p>å¤§è‡´åˆ†ä¸ºè¿™ä¹ˆå‡ ä¸ªé˜¶æ®µï¼šå…ˆæŠŠ Native Object å˜æˆ Observableï¼Œå†é€šè¿‡ Observable å†…ç½®çš„å„ç§å¼ºå¤§çš„è½¬æ¢å’Œç»„åˆèƒ½åŠ›å˜æˆæ–°çš„ Observableï¼Œæœ€åæ¶ˆè´¹æ–°çš„ Observable çš„æ•°æ®ã€‚</p>

<p  style="text-align:center" ><img src="&#x2F;posts&#x2F;time-to-learn-rxswift&#x2F;14814540314644.jpg"
        width="1448" /></p><h4 id="native-object-observable">Native Object -&gt; Observable</h4>
<h5 id="rx-extension">.rx extension</h5>
<p>å‡è®¾éœ€è¦å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œæ­£å¸¸çš„åšæ³•æ˜¯ç»™ Tap Gesture æ·»åŠ ä¸€ä¸ª Target-Actionï¼Œç„¶ååœ¨é‚£é‡Œå®ç°å…·ä½“çš„é€»è¾‘ï¼Œè¿™æ ·çš„é—®é¢˜åœ¨äºéœ€è¦é‡æ–°å–åå­—ï¼Œè€Œä¸”ä¸¢å¤±äº†ä¸Šä¸‹æ–‡ã€‚RxSwift (ç¡®åˆ‡è¯´æ˜¯ RxCocoa) ç»™ç³»ç»Ÿçš„è¯¸å¤šåŸç”Ÿæ§ä»¶ï¼ˆåŒ…æ‹¬åƒ <code>URLSession</code>ï¼‰æä¾›äº† rx æ‰©å±•ï¼Œæ‰€ä»¥ç‚¹å‡»çš„å¤„ç†å°±å˜æˆäº†è¿™æ ·ï¼š</p>
<pre data-lang="swift" style="background-color:#f9f9f9;color:#111111;" class="language-swift "><code class="language-swift" data-lang="swift"><span style="color:#8959a8;">let</span><span> tapBackground </span><span style="color:#3e999f;">=</span><span> UITapGestureRecognizer()
</span><span>
</span><span>tapBackground</span><span style="color:#3e999f;">.</span><span>rx</span><span style="color:#3e999f;">.</span><span>event
</span><span>    </span><span style="color:#3e999f;">.</span><span>subscribe(onNext: { [</span><span style="color:#8959a8;">weak self</span><span>] _ </span><span style="color:#8959a8;">in
</span><span>        </span><span style="color:#8959a8;">self</span><span>?</span><span style="color:#3e999f;">.</span><span>view</span><span style="color:#3e999f;">.</span><span>endEditing(</span><span style="color:#8959a8;">true</span><span>)
</span><span>    })
</span><span>    </span><span style="color:#3e999f;">.</span><span>addDisposableTo(disposeBag)
</span><span>
</span><span>view</span><span style="color:#3e999f;">.</span><span>addGestureRecognizer(tapBackground)
</span></code></pre>
<p>æ˜¯ä¸æ˜¯ç®€æ´äº†å¾ˆå¤šã€‚</p>
<h5 id="observable-create">Observable.create</h5>
<p>é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å°† Native çš„ object åŒ…è£…æˆ <code>Observable</code>ï¼Œæ¯”å¦‚å¯¹ç½‘ç»œè¯·æ±‚çš„å°è£…ï¼š</p>
<pre data-lang="swift" style="background-color:#f9f9f9;color:#111111;" class="language-swift "><code class="language-swift" data-lang="swift"><span style="color:#8959a8;">public func </span><span>response(_ request: URLRequest) </span><span style="color:#3e999f;">-&gt;</span><span> Observable&lt;(Data, HTTPURLResponse)&gt; {
</span><span>	</span><span style="color:#8959a8;">return</span><span> Observable</span><span style="color:#3e999f;">.</span><span>create { observer </span><span style="color:#8959a8;">in
</span><span>		</span><span style="color:#8959a8;">let</span><span> task </span><span style="color:#3e999f;">= </span><span style="color:#8959a8;">self</span><span style="color:#3e999f;">.</span><span>dataTaskWithRequest(request) { (data, response, error) </span><span style="color:#8959a8;">in
</span><span>			observer</span><span style="color:#3e999f;">.</span><span>on(</span><span style="color:#3e999f;">.</span><span>next(data, httpResponse))
</span><span>			observer</span><span style="color:#3e999f;">.</span><span>on(</span><span style="color:#3e999f;">.</span><span>completed)
</span><span>		}
</span><span>
</span><span>		task</span><span style="color:#3e999f;">.</span><span>resume()
</span><span>
</span><span>		</span><span style="color:#8959a8;">return</span><span> Disposables</span><span style="color:#3e999f;">.</span><span>create {
</span><span>			task</span><span style="color:#3e999f;">.</span><span>cancel()
</span><span>		}
</span><span>	}
</span><span>}
</span></code></pre>
<p>å‡ºäºä»£ç çš„ç®€æ´ï¼Œç•¥å»äº†å¯¹ error çš„å¤„ç†ï¼Œä½¿ç”¨å§¿åŠ¿ç±»ä¼¼</p>
<pre data-lang="swift" style="background-color:#f9f9f9;color:#111111;" class="language-swift "><code class="language-swift" data-lang="swift"><span style="color:#8959a8;">let</span><span> disposeBag </span><span style="color:#3e999f;">=</span><span> DisposeBag()
</span><span>
</span><span>response(aRequest)
</span><span>  </span><span style="color:#3e999f;">.</span><span>subscribe(onNext: { data </span><span style="color:#8959a8;">in
</span><span>    print(data)
</span><span>  })
</span><span>  </span><span style="color:#3e999f;">.</span><span>addDisposableTo(disposeBag)
</span></code></pre>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š</p>
<ol>
<li><code>Observerable</code> è¿”å›çš„æ˜¯ä¸€ä¸ª <code>Disposable</code>ï¼Œè¡¨ç¤ºã€Œå¯æ‰”æ‰ã€çš„ï¼Œæ‰”å“ªé‡Œå‘¢ï¼Œå°±æ‰”åˆ°åˆšåˆšåˆ›å»ºçš„è¢‹å­é‡Œï¼Œè¿™æ ·å½“è¢‹å­è¢«å›æ”¶ï¼ˆ<code>dealloc</code>ï¼‰æ—¶ï¼Œä¼šé¡ºä¾¿æ‰§è¡Œä¸€ä¸‹ <code>Disposable.dispose()</code>ï¼Œä¹‹å‰åˆ›å»º <code>Disposable</code> æ—¶ç”³è¯·çš„èµ„æºå°±ä¼šè¢«ä¸€å¹¶é‡Šæ”¾æ‰ã€‚</li>
<li>å¦‚æœæœ‰å¤šä¸ª subscriber æ¥ subscribe <code>response(aRequest)</code> é‚£ä¹ˆä¼šåˆ›å»ºå¤šä¸ªè¯·æ±‚ï¼Œä»ä»£ç ä¹Ÿå¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œæ¥ä¸€ä¸ª observer å°±åˆ›å»ºä¸€ä¸ª taskï¼Œç„¶åæ‰§è¡Œã€‚è¿™å¾ˆæœ‰å¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå¦‚ä½•è®©å¤šä¸ª subscriber å…±äº«ä¸€ä¸ªç»“æœï¼Œè¿™ä¸ªåé¢ä¼šæåˆ°ã€‚</li>
</ol>
<h5 id="variable">Variable()</h5>
<p><code>Variable(value)</code> å¯ä»¥æŠŠ value å˜æˆä¸€ä¸ª <code>Observable</code>ï¼Œä¸è¿‡å‰ææ˜¯ä½¿ç”¨æ–°çš„èµ‹å€¼æ–¹å¼ <code>aVariable.value = newValue</code>ï¼Œæ¥çœ‹ä¸ª Demo</p>
<pre data-lang="swift" style="background-color:#f9f9f9;color:#111111;" class="language-swift "><code class="language-swift" data-lang="swift"><span style="color:#8959a8;">let</span><span> magicNumber </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">42
</span><span>
</span><span style="color:#8959a8;">let</span><span> magicNumberVariable </span><span style="color:#3e999f;">=</span><span> Variable(magicNumber)
</span><span>magicNumberVariable</span><span style="color:#3e999f;">.</span><span>asObservable()</span><span style="color:#3e999f;">.</span><span>subscribe(onNext: {
</span><span>    print(</span><span style="color:#839c00;">&quot;magic number is </span><span>\($</span><span style="color:#f07219;">0</span><span>)</span><span style="color:#839c00;">&quot;</span><span>)
</span><span>})
</span><span>
</span><span>magicNumberVariable</span><span style="color:#3e999f;">.</span><span>value </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">73
</span><span>
</span><span style="color:#8e908c;">// output
</span><span style="color:#8e908c;">//
</span><span style="color:#8e908c;">// magic number is 42
</span><span style="color:#8e908c;">// magic number is 73
</span></code></pre>
<p>èµ·åˆçœ‹åˆ°æ—¶ï¼Œè§‰å¾—è¿˜è›®ç¥å¥‡çš„ï¼Œè·Ÿè¿›å»çœ‹äº†ä¸‹ï¼Œå‘ç°æ˜¯é€šè¿‡ <code>subject</code> æ¥åšçš„ï¼Œå¤§æ„æ˜¯æŠŠ <code>value</code> å­˜åˆ°ä¸€ä¸ªå†…éƒ¨å˜é‡ <code>_value</code> é‡Œï¼Œå½“è°ƒç”¨ <code>value</code> æ–¹æ³•æ—¶ï¼Œå…ˆæ›´æ–° <code>_value</code> å€¼ï¼Œç„¶åè°ƒç”¨å†…éƒ¨çš„ <code>_subject.on(.next(newValue))</code> æ–¹æ³•å‘ŠçŸ¥ subscriberã€‚</p>
<h5 id="subject">Subject</h5>
<p><code>Subject</code> ç®€å•æ¥è¯´æ˜¯ä¸€ä¸ªå¯ä»¥ä¸»åŠ¨å‘å°„æ•°æ®çš„ <code>Observable</code>ï¼Œå¤šäº† <code>onNext(value)</code>, <code>onError(error)</code>, 'onCompleted' æ–¹æ³•ï¼Œå¯è°“å…¨èƒ½å‹é€‰æ‰‹ã€‚</p>
<pre data-lang="swift" style="background-color:#f9f9f9;color:#111111;" class="language-swift "><code class="language-swift" data-lang="swift"><span style="color:#8959a8;">let</span><span> disposeBag </span><span style="color:#3e999f;">=</span><span> DisposeBag()
</span><span style="color:#8959a8;">let</span><span> subject </span><span style="color:#3e999f;">=</span><span> PublishSubject</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">String</span><span style="color:#3e999f;">&gt;</span><span>()
</span><span>
</span><span>subject</span><span style="color:#3e999f;">.</span><span>addObserver(</span><span style="color:#839c00;">&quot;1&quot;</span><span>)</span><span style="color:#3e999f;">.</span><span>addDisposableTo(disposeBag)
</span><span>subject</span><span style="color:#3e999f;">.</span><span>onNext(</span><span style="color:#839c00;">&quot;ğŸ¶&quot;</span><span>)
</span><span>subject</span><span style="color:#3e999f;">.</span><span>onNext(</span><span style="color:#839c00;">&quot;ğŸ±&quot;</span><span>)
</span><span>
</span><span>subject</span><span style="color:#3e999f;">.</span><span>addObserver(</span><span style="color:#839c00;">&quot;2&quot;</span><span>)</span><span style="color:#3e999f;">.</span><span>addDisposableTo(disposeBag)
</span><span>subject</span><span style="color:#3e999f;">.</span><span>onNext(</span><span style="color:#839c00;">&quot;ğŸ…°ï¸&quot;</span><span>)
</span><span>subject</span><span style="color:#3e999f;">.</span><span>onNext(</span><span style="color:#839c00;">&quot;ğŸ…±ï¸&quot;</span><span>)
</span></code></pre>
<p>è®°å¾—åœ¨ RAC æ—¶ä»£ï¼Œsubject æ˜¯ä¸€ä¸ªä¸å¤ªæ¨èä½¿ç”¨çš„åŠŸèƒ½ï¼Œå› ä¸ºè¿‡äºå¼ºå¤§äº†ï¼Œå®¹æ˜“å¤±æ§ã€‚RxSwift é‡Œå€’æ˜¯æ²¡æœ‰å¤ªæåŠï¼Œä½†è¿˜æ˜¯å°‘ç”¨ä¸ºä½³ã€‚</p>
<h4 id="observable-new-observable">Observable -&gt; New Observable</h4>
<p><code>Observable</code> çš„å¼ºå¤§ä¸ä»…åœ¨äºå®ƒèƒ½å®æ—¶æ›´æ–° valueï¼Œè¿˜åœ¨äºå®ƒèƒ½è¢«ä¿®æ”¹ï¼è¿‡æ»¤ï¼ç»„åˆç­‰ï¼Œè¿™æ ·å°±èƒ½éšå¿ƒæ‰€æ¬²åœ°æ„é€ è‡ªå·±æƒ³è¦çš„æ•°æ®ï¼Œè¿˜ä¸ç”¨æ‹…å¿ƒæ•°æ®å‘ç”Ÿå˜åŒ–äº†å´ä¸çŸ¥é“çš„æƒ…å†µã€‚</p>
<h5 id="combine">Combine</h5>
<p>Combine å°±æ˜¯æŠŠå¤šä¸ª <code>Observable</code> ç»„åˆèµ·æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚ <code>zip</code> (å°æç¤ºï¼šå¦‚æœå¯¹è¿™äº›å‡½æ•°ä¸å¤ªæ•æ„Ÿï¼Œå¯ä»¥<a href="http://rxmarbles.com/">å®é™…æ“ä½œä¸‹</a>ï¼Œä½“ä¼šä¼šæ›´æ·±äº›)</p>
<p><code>zip</code> å¯¹åº”ç°å®ä¸­çš„ä¾‹å­å°±æ˜¯æ‹‰é“¾ï¼Œæ‹‰é“¾éœ€è¦ä¸¤ä¸ªå…ƒç´ è¿™æ ·æ‰èƒ½æ‹‰ä¸Šå»ï¼Œè¿™é‡Œä¹Ÿä¸€æ ·ï¼Œåªæœ‰å½“ä¸¤ä¸ª <code>Observable</code> éƒ½æœ‰äº†æ–°çš„å€¼æ—¶ï¼Œsubscribe æ‰ä¼šè¢«è§¦å‘ã€‚</p>
<pre data-lang="swift" style="background-color:#f9f9f9;color:#111111;" class="language-swift "><code class="language-swift" data-lang="swift"><span style="color:#8959a8;">let</span><span> stringSubject </span><span style="color:#3e999f;">=</span><span> PublishSubject</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">String</span><span style="color:#3e999f;">&gt;</span><span>()
</span><span style="color:#8959a8;">let</span><span> intSubject </span><span style="color:#3e999f;">=</span><span> PublishSubject</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">Int</span><span style="color:#3e999f;">&gt;</span><span>()
</span><span>
</span><span>Observable</span><span style="color:#3e999f;">.</span><span>zip(stringSubject, intSubject) { stringElement, intElement </span><span style="color:#8959a8;">in
</span><span>	</span><span style="color:#839c00;">&quot;</span><span>\(stringElement) \(intElement)</span><span style="color:#839c00;">&quot;
</span><span>	}
</span><span>	</span><span style="color:#3e999f;">.</span><span>subscribe(onNext: { print($</span><span style="color:#f07219;">0</span><span>) })
</span><span>	</span><span style="color:#3e999f;">.</span><span>addDisposableTo(disposeBag)
</span><span>
</span><span>stringSubject</span><span style="color:#3e999f;">.</span><span>onNext(</span><span style="color:#839c00;">&quot;ğŸ…°ï¸&quot;</span><span>)
</span><span>stringSubject</span><span style="color:#3e999f;">.</span><span>onNext(</span><span style="color:#839c00;">&quot;ğŸ…±ï¸&quot;</span><span>)
</span><span>
</span><span>intSubject</span><span style="color:#3e999f;">.</span><span>onNext(</span><span style="color:#f07219;">1</span><span>)
</span><span>intSubject</span><span style="color:#3e999f;">.</span><span>onNext(</span><span style="color:#f07219;">2</span><span>)
</span><span>
</span><span style="color:#8e908c;">// output
</span><span style="color:#8e908c;">//
</span><span style="color:#8e908c;">// ğŸ…°ï¸ 1
</span><span style="color:#8e908c;">// ğŸ…±ï¸ 2
</span></code></pre>
<p>å¦‚æœè¿™é‡Œ <code>intSubject</code> å§‹ç»ˆæ²¡æœ‰æ‰§è¡Œ <code>onNext</code>ï¼Œé‚£ä¹ˆå°†ä¸ä¼šæœ‰è¾“å‡ºï¼Œå°±åƒæ‹‰é“¾æ‰äº†ä¸€è¾¹çš„é“¾å­å°±æ‹‰ä¸ä¸Šäº†ã€‚</p>
<p>é™¤äº† <code>zip</code>ï¼Œè¿˜æœ‰å…¶ä»–çš„ combine çš„å§¿åŠ¿ï¼Œæ¯”å¦‚ <code>combineLatest</code> / <code>switchLatest</code> ç­‰ã€‚</p>
<h5 id="transform">Transform</h5>
<p>è¿™æ˜¯æœ€å¸¸è§çš„æ“ä½œäº†ï¼Œå¯¹ä¸€ä¸ª <code>Observable</code> çš„æ•°å€¼åšä¸€äº›å°æ”¹åŠ¨ï¼Œç„¶åäº§å‡ºæ–°çš„å€¼ï¼Œä¾æ—§æ˜¯ä¸€ä¸ª <code>Observable</code>ã€‚</p>
<pre data-lang="swift" style="background-color:#f9f9f9;color:#111111;" class="language-swift "><code class="language-swift" data-lang="swift"><span style="color:#8959a8;">let</span><span> disposeBag </span><span style="color:#3e999f;">=</span><span> DisposeBag()
</span><span>Observable</span><span style="color:#3e999f;">.</span><span>of(</span><span style="color:#f07219;">1</span><span>, </span><span style="color:#f07219;">2</span><span>, </span><span style="color:#f07219;">3</span><span>)
</span><span>    </span><span style="color:#3e999f;">.</span><span>map { $</span><span style="color:#f07219;">0 </span><span style="color:#3e999f;">*</span><span> $</span><span style="color:#f07219;">0</span><span> }
</span><span>    </span><span style="color:#3e999f;">.</span><span>subscribe(onNext: { print($</span><span style="color:#f07219;">0</span><span>) })
</span><span>    </span><span style="color:#3e999f;">.</span><span>addDisposableTo(disposeBag)
</span></code></pre>
<p>è¿™æ˜¯å¤§è‡´çš„å®ç°ï¼ˆæ‘˜è‡ªå®˜ç½‘ï¼‰</p>
<pre data-lang="swift" style="background-color:#f9f9f9;color:#111111;" class="language-swift "><code class="language-swift" data-lang="swift"><span style="color:#8959a8;">extension</span><span> ObservableType {
</span><span>    </span><span style="color:#8959a8;">func </span><span>myMap&lt;R&gt;(transform: E </span><span style="color:#3e999f;">-&gt;</span><span> R) </span><span style="color:#3e999f;">-&gt;</span><span> Observable&lt;R&gt; {
</span><span>        </span><span style="color:#8959a8;">return</span><span> Observable</span><span style="color:#3e999f;">.</span><span>create { observer </span><span style="color:#8959a8;">in
</span><span>            </span><span style="color:#8959a8;">let</span><span> subscription </span><span style="color:#3e999f;">= </span><span style="color:#8959a8;">self</span><span style="color:#3e999f;">.</span><span>subscribe { e </span><span style="color:#8959a8;">in
</span><span>                    </span><span style="color:#8959a8;">switch</span><span> e {
</span><span>                    </span><span style="color:#8959a8;">case </span><span style="color:#3e999f;">.</span><span>next(</span><span style="color:#8959a8;">let</span><span> value):
</span><span>                        </span><span style="color:#8959a8;">let</span><span> result </span><span style="color:#3e999f;">=</span><span> transform(value)
</span><span>                        observer</span><span style="color:#3e999f;">.</span><span>on(</span><span style="color:#3e999f;">.</span><span>next(result))
</span><span>                    </span><span style="color:#8959a8;">case </span><span style="color:#3e999f;">.</span><span>error(</span><span style="color:#8959a8;">let</span><span> error):
</span><span>                        observer</span><span style="color:#3e999f;">.</span><span>on(</span><span style="color:#3e999f;">.</span><span>error(error))
</span><span>                    </span><span style="color:#8959a8;">case </span><span style="color:#3e999f;">.</span><span>completed:
</span><span>                        observer</span><span style="color:#3e999f;">.</span><span>on(</span><span style="color:#3e999f;">.</span><span>completed)
</span><span>                    }
</span><span>                }
</span><span>
</span><span>            </span><span style="color:#8959a8;">return</span><span> subscription
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<p>æ¥å—ä¸€ä¸ª transform é—­åŒ…ï¼Œç„¶åè¿”å›ä¸€ä¸ª <code>Observable</code>ï¼Œå› ä¸ºæ¥ä¸‹æ¥ä½¿ç”¨è€…å°†ä¼šå¯¹ <code>myMap</code> çš„ç»“æœè¿›è¡Œ subscribeï¼Œæ‰€ä»¥éœ€è¦åœ¨ create å†…éƒ¨ subscribe ä¸€ä¸‹ï¼Œä¸ç„¶æœ€å¼€å§‹çš„é‚£ä¸ª <code>Observable</code> å°±æ˜¯ä¸ª <code>Cold Observable</code>ï¼Œä¸€ä¸ª <code>Cold Observable</code> æ˜¯ä¸ä¼šäº§ç”Ÿæ–°çš„æ•°æ®çš„ã€‚</p>
<h5 id="filter">Filter</h5>
<p>Filter çš„ä½œç”¨æ˜¯å¯¹ <code>Observable</code> ä¼ è¿‡æ¥çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œåªæœ‰ç¬¦åˆæ¡ä»¶çš„æ‰æœ‰èµ„æ ¼è¢« subscribeã€‚å†™æ³•ä¸Šè·Ÿ map å·®ä¸å¤šï¼Œå°±ä¸èµ˜è¿°äº†ã€‚</p>
<h5 id="connect">Connect</h5>
<p>è¿™æ˜¯æŒºæœ‰æ„æ€çš„ä¸€å—ï¼Œåœ¨ä¹‹å‰ä»‹ç» <code>Observable.create</code> æ—¶æœ‰æåˆ°è¿‡ï¼Œä¸€ä¸ª <code>Observable</code> è¢«å¤šæ¬¡ subscribe å°±ä¼šè¢«å¤šæ¬¡è§¦å‘ï¼Œå¦‚æœä¸€ä¸ªç½‘ç»œè¯·æ±‚åªæƒ³è¢«è§¦å‘ä¸€æ¬¡ï¼ŒåŒæ—¶æ”¯æŒå¤šä¸ª subscriberï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>publish</code> + <code>connect</code> çš„ç»„åˆã€‚</p>
<p>å½“ä¸€ä¸ª <code>Observable</code> ä½¿ç”¨äº† <code>publish()</code> æ–¹æ³•åï¼Œæ­£å¸¸çš„ subscribe å°±ä¸ä¼šè§¦å‘å®ƒäº†ï¼Œé™¤é <code>connect()</code> æ–¹æ³•è¢«è°ƒç”¨ã€‚è€Œä¸”æ¯æ¬¡ subscribe ä¸ä¼šå¯¼è‡´ <code>Observable</code> é‡æ–°é’ˆå¯¹ observer å¤„ç†ä¸€éã€‚çœ‹ä¸€ä¸‹è¿™å¼ å›¾</p>
<p><img src="http://reactivex.io/documentation/operators/images/publishConnect.c.png" alt="" /></p>
<p>æœ‰ä¸¤å—éœ€è¦æ³¨æ„ï¼š</p>
<ol>
<li><code>connect()</code> ä¹‹å‰çš„ä¸¤æ¬¡ <code>subscribe</code> å¹¶æ²¡æœ‰äº§ç”Ÿæ–°çš„ valueã€‚</li>
<li><code>connect()</code> ä¹‹å <code>subscribe</code> çš„ï¼Œåªæ˜¯ç­‰å¾…æ–°çš„ valueï¼ŒåŒæ—¶æ–°çš„ value è¿˜ä¼šåˆ†å‘ç»™ä¹‹å‰çš„ subscriberã€‚</li>
<li>å³ä½¿æ‰€æœ‰çš„ <code>subscription</code> è¢« <code>dispose</code>, <code>Observable</code> ä¾æ—§å¤„äº <code>hot</code> çŠ¶æ€ï¼Œå°±å¥½åƒè¿˜ä»¥ä¸ºæœ‰äººå…³å¿ƒæ–°çš„å€¼ä¸€æ ·ã€‚ï¼ˆè¿™å¯èƒ½ä¸æ˜¯æƒ³è¦çš„ç»“æœï¼‰</li>
</ol>
<p>é’ˆå¯¹ç¬¬ 3 ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>refcount()</code> æ¥ä»£æ›¿ <code>connect()</code>ï¼Œå‰è€…ä¼šåœ¨æ²¡æœ‰ subscriber æ—¶è‡ªåŠ¨ã€Œå†·ã€ä¸‹æ¥ï¼Œä¸ä¼šå†äº§ç”Ÿæ–°çš„å€¼ã€‚ï¼ˆDemo å–è‡ª<a href="http://www.tailec.com/blog/understanding-publish-connect-refcount-share">è¿™é‡Œ</a>ï¼‰</p>
<pre data-lang="swift" style="background-color:#f9f9f9;color:#111111;" class="language-swift "><code class="language-swift" data-lang="swift"><span style="color:#8959a8;">let</span><span> myObservable </span><span style="color:#3e999f;">=</span><span> Observable</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">Int</span><span style="color:#3e999f;">&gt;.</span><span>interval(</span><span style="color:#f07219;">1</span><span>, scheduler: MainScheduler</span><span style="color:#3e999f;">.</span><span>instance)</span><span style="color:#3e999f;">.</span><span>publish()</span><span style="color:#3e999f;">.</span><span>refCount() </span><span style="color:#8e908c;">// 1)
</span><span>
</span><span style="color:#8959a8;">let</span><span> mySubscription </span><span style="color:#3e999f;">=</span><span> myObservable</span><span style="color:#3e999f;">.</span><span>subscribe(onNext: {
</span><span>    print(</span><span style="color:#839c00;">&quot;Next: </span><span>\($</span><span style="color:#f07219;">0</span><span>)</span><span style="color:#839c00;">&quot;</span><span>)
</span><span>})
</span><span>
</span><span>delay(</span><span style="color:#f07219;">3</span><span>) {
</span><span>    print(</span><span style="color:#839c00;">&quot;Disposing at 3 seconds&quot;</span><span>)
</span><span>    mySubscription</span><span style="color:#3e999f;">.</span><span>dispose()
</span><span>}
</span><span>
</span><span>delay(</span><span style="color:#f07219;">6</span><span>) {
</span><span>    print(</span><span style="color:#839c00;">&quot;Subscribing again at 6 seconds&quot;</span><span>)
</span><span>    myObservable</span><span style="color:#3e999f;">.</span><span>subscribe(onNext: {
</span><span>        print(</span><span style="color:#839c00;">&quot;Next: </span><span>\($</span><span style="color:#f07219;">0</span><span>)</span><span style="color:#839c00;">&quot;</span><span>)
</span><span>    })
</span><span>}
</span></code></pre>
<p>è¾“å‡º</p>
<pre style="background-color:#f9f9f9;color:#111111;"><code><span>Starting at 0 seconds
</span><span>Next: 0
</span><span>Next: 1
</span><span>Next: 2
</span><span>Disposing at 3 seconds
</span><span>Subscribing again at 6 seconds
</span><span>Next: 0
</span><span>Next: 1
</span></code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ3 ç§’å subscription disposeï¼Œæ­¤æ—¶æ²¡æœ‰ä»»ä½• subscriber è¿˜å…³å¿ƒ <code>Observable</code>ï¼Œå› æ­¤å°±é‡ç½®äº†ï¼Œæ‰€ä»¥ 6 ç§’ååˆå›åˆ°äº†åˆå§‹çŠ¶æ€ï¼ˆå¦‚æœå˜æˆ <code>connect</code> æ–¹æ³•çš„è¯ï¼Œä¼šå‘ç° 6 ç§’åä¼šè¾“å‡º <code>Next: 6 / Next: 7</code>ï¼‰</p>
<p>é‚£å¦‚æœååŠ å…¥çš„ subscriber æƒ³è¦ä¹‹å‰çš„æ•°æ®æ€ä¹ˆåŠï¼Ÿå¯ä»¥å¯¹åŸå§‹çš„ <code>Observable</code> è®¾ç½® <code>replay(n)</code>ï¼Œè¡¨ç¤ºæœ€å¤šè¿”å› n ä¸ªå…ƒç´ ç»™ååŠ å…¥çš„ subscriberã€‚</p>
<h3 id="tips">Tips</h3>
<p>ä¸Šé¢ä»‹ç»çš„æ˜¯æœ€åŸºæœ¬çš„æ¦‚å¿µã€‚é¡ºä¾¿æä¸€ä¸‹æ¯”è¾ƒå¸¸è§çš„å‡ ä¸ªé—®é¢˜ï¼š</p>
<h4 id="ru-he-chu-li-scheduler">å¦‚ä½•å¤„ç† Schedulerï¼Ÿ</h4>
<p>é»˜è®¤ä»£ç éƒ½æ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå¦‚æœè¦æ‰‹åŠ¨åˆ‡æ¢çº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>subsribeOn</code> å’Œ <code>observeOn</code> ä¸¤ç§æ–¹å¼ï¼Œä¸€èˆ¬æ¥è¯´åè€…ç”¨å¾—ä¼šå¤šä¸€äº›ï¼Œé‚£è¿™ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<p><code>subscribeOn</code> è·Ÿä½ç½®æ— å…³ï¼Œä¹Ÿå°±æ˜¯æ— è®ºåœ¨é“¾å¼è°ƒç”¨çš„ä»€ä¹ˆåœ°æ–¹ï¼Œ<code>Observable</code> å’Œ <code>subscription</code> éƒ½ä¼šå—å½±å“ï¼›è€Œ <code>observeOn</code> åˆ™ä»…å¯¹ä¹‹åçš„è°ƒç”¨äº§ç”Ÿå½±å“ï¼Œçœ‹ä¸ª Demoï¼š</p>
<pre data-lang="swift" style="background-color:#f9f9f9;color:#111111;" class="language-swift "><code class="language-swift" data-lang="swift"><span style="color:#8959a8;">var</span><span> observable </span><span style="color:#3e999f;">=</span><span> Observable</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">Int</span><span style="color:#3e999f;">&gt;.</span><span>create { (observer: AnyObserver</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">Int</span><span style="color:#3e999f;">&gt;</span><span>) </span><span style="color:#3e999f;">-&gt;</span><span> Disposable </span><span style="color:#8959a8;">in
</span><span>    print(</span><span style="color:#839c00;">&quot;observable thread: </span><span>\(Thread</span><span style="color:#3e999f;">.</span><span>current)</span><span style="color:#839c00;">&quot;</span><span>)
</span><span>    observer</span><span style="color:#3e999f;">.</span><span>onNext(</span><span style="color:#f07219;">1</span><span>)
</span><span>    observer</span><span style="color:#3e999f;">.</span><span>onCompleted()
</span><span>    </span><span style="color:#8959a8;">return</span><span> Disposables</span><span style="color:#3e999f;">.</span><span>create()
</span><span>}
</span><span>
</span><span style="color:#8959a8;">let</span><span> disposeBag </span><span style="color:#3e999f;">=</span><span> DisposeBag()
</span><span>
</span><span>observable
</span><span>    </span><span style="color:#3e999f;">.</span><span>map({ (e) </span><span style="color:#3e999f;">-&gt; </span><span style="color:#c99e00;">Int </span><span style="color:#8959a8;">in
</span><span>        print(</span><span style="color:#839c00;">&quot;map1 thread: </span><span>\(Thread</span><span style="color:#3e999f;">.</span><span>current)</span><span style="color:#839c00;">&quot;</span><span>)
</span><span>        </span><span style="color:#8959a8;">return</span><span> e </span><span style="color:#3e999f;">+ </span><span style="color:#f07219;">1
</span><span>    })
</span><span>    </span><span style="color:#3e999f;">.</span><span>observeOn(ConcurrentDispatchQueueScheduler(qos: </span><span style="color:#3e999f;">.</span><span>userInteractive)) </span><span style="color:#8e908c;">// 1
</span><span>    </span><span style="color:#3e999f;">.</span><span>map({ (e) </span><span style="color:#3e999f;">-&gt; </span><span style="color:#c99e00;">Int </span><span style="color:#8959a8;">in
</span><span>        print(</span><span style="color:#839c00;">&quot;map2 thread: </span><span>\(Thread</span><span style="color:#3e999f;">.</span><span>current)</span><span style="color:#839c00;">&quot;</span><span>)
</span><span>        </span><span style="color:#8959a8;">return</span><span> e </span><span style="color:#3e999f;">+ </span><span style="color:#f07219;">2
</span><span>    })
</span><span>    </span><span style="color:#3e999f;">.</span><span>subscribe(onNext:{ (e) </span><span style="color:#3e999f;">-&gt; </span><span style="color:#c99e00;">Void </span><span style="color:#8959a8;">in
</span><span>        print(</span><span style="color:#839c00;">&quot;subscribe thread: </span><span>\(Thread</span><span style="color:#3e999f;">.</span><span>current)</span><span style="color:#839c00;">&quot;</span><span>)
</span><span>    })
</span><span>    </span><span style="color:#3e999f;">.</span><span>addDisposableTo(disposeBag)
</span></code></pre>
<p>å¦‚æœ 1) æ˜¯ <code>observeOn</code>ï¼Œé‚£ä¹ˆè¾“å‡ºå¦‚ä¸‹</p>
<pre style="background-color:#f9f9f9;color:#111111;"><code><span>observable thread: &lt;NSThread: 0x7f901cc0d510&gt;{number = 1, name = main}
</span><span>map1 thread: &lt;NSThread: 0x7f901cc0d510&gt;{number = 1, name = main}
</span><span>map2 thread: &lt;NSThread: 0x7f901ce15560&gt;{number = 3, name = (null)}
</span><span>subscribe thread: &lt;NSThread: 0x7f901ce15560&gt;{number = 3, name = (null)}
</span></code></pre>
<p>å¯ä»¥çœ‹åˆ° observable thread å’Œ map1 thread ä¾æ—§ä¿æŒå½“å‰çº¿ç¨‹ï¼Œä½† <code>observeOn</code> ä¹‹åå°±å˜æˆäº†å¦ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
<p>å¦‚æœ 1) æ˜¯ <code>subscribeOn</code>ï¼Œé‚£ä¹ˆä¼šè¾“å‡º</p>
<pre style="background-color:#f9f9f9;color:#111111;"><code><span>observable thread: &lt;NSThread: 0x7fbdf1e097a0&gt;{number = 3, name = (null)}
</span><span>map1 thread: &lt;NSThread: 0x7fbdf1e097a0&gt;{number = 3, name = (null)}
</span><span>map2 thread: &lt;NSThread: 0x7fbdf1e097a0&gt;{number = 3, name = (null)}
</span><span>subscribe thread: &lt;NSThread: 0x7fbdf1e097a0&gt;{number = 3, name = (null)}
</span></code></pre>
<p>å¯ä»¥çœ‹åˆ°å…¨éƒ½å˜æˆäº† <code>subscribeOn</code> æŒ‡å®šçš„ Queueã€‚æ‰€ä»¥ <code>subscribeOn</code> çš„æ„ŸæŸ“åŠ›å¾ˆå¼ºï¼Œè¿ <code>Observable</code> éƒ½èƒ½å½±å“åˆ°ã€‚</p>
<h4 id="cold-observable-he-hot-observable">Cold Observable å’Œ Hot Observable</h4>
<p>Cold ç›¸å½“äº InActiveï¼Œå°±åƒè¥¿éƒ¨ä¸–ç•Œé‡Œï¼Œæœªè¢«æ¿€æ´»çš„æœºå™¨äººä¸€æ ·ï¼›Hot å°±æ˜¯å¤„äºå·¥ä½œçŠ¶æ€çš„æœºå™¨äººã€‚</p>
<h4 id="subscription-wei-shi-yao-yao-dispose">Subscription ä¸ºä»€ä¹ˆè¦ Disposeï¼Ÿ</h4>
<p>å› ä¸ºæœ‰äº† <code>Subscriber</code> æ‰€ä»¥ <code>Observable</code> è¢«æ¿€æ´»ï¼Œç„¶åå†…éƒ¨å°±ä¼šä½¿ç”¨å„ç§å˜é‡æ¥ä¿å­˜èµ„æºï¼Œå¦‚æœä¸ <code>dispose</code> çš„è¯ï¼Œè¿™äº›èµ„æºå°±ä¼šä¸€ç›´è¢« keepï¼Œå¾ˆå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚</p>
<p>åŒæ—¶æ‰‹åŠ¨ dispose åˆå«Œéº»çƒ¦ï¼Œæ‰€ä»¥å°±æœ‰äº† <code>DisposeBag</code>ï¼Œå½“è¿™ä¸ª Bag è¢«å›æ”¶æ—¶ï¼ŒBag é‡Œé¢çš„ subscription ä¼šè‡ªåŠ¨è¢« disposeï¼Œç›¸å½“äºä» MRC å˜æˆäº† ARCã€‚</p>
<h3 id="xiao-jie">å°ç»“</h3>
<p>RxSwift å¦‚æœæ¦‚å¿µä¸Šæ•´ç†æ¸…æ¥šäº†ï¼Œä¼šå‘ç°å…¶å®å¹¶ä¸éš¾ï¼Œå¤šä» <code>Observable</code> çš„è§’åº¦å»æ€è€ƒé—®é¢˜ï¼Œå¤šæƒ³ç€è½¬æ¢å’Œç»„åˆï¼Œæ…¢æ…¢å°±ä¼šä»å‘½ä»¤å¼ç¼–ç¨‹è½¬åˆ°å£°æ˜å¼ç¼–ç¨‹ï¼Œå¯¹äºæŠ½è±¡èƒ½åŠ›å’Œä»£ç çš„å¯è¯»æ€§éƒ½ä¼šæœ‰æå‡ã€‚</p>

  </div>


  <ul class="tags flex flex-wrap justify-center items-center gap-4 mt-5 mb-8 text-lg">
    
    
    <li
      class="px-4 pb-[2px] leading-8 rounded-full border text-gray-700 border-gray-700 hover:text-gray-100 hover:border-gray-900 hover:bg-gray-900 transition-all">
      <a class="inline-block" href="https://limboy.me/tags/programming/">programming</a>
    </li>
    
    <li
      class="px-4 pb-[2px] leading-8 rounded-full border text-gray-700 border-gray-700 hover:text-gray-100 hover:border-gray-900 hover:bg-gray-900 transition-all">
      <a class="inline-block" href="https://limboy.me/tags/ios/">iOS</a>
    </li>
    
    
  </ul>

  
  <script src="https://giscus.app/client.js" data-repo="limboy/telescope"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzODEwOTA2MTg=" data-category="General"
    data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMzMDY2MTQy" data-mapping="title" data-reactions-enabled="1"
    data-emit-metadata="0" data-theme="light" data-lang="en" crossorigin="anonymous" async>
    </script>
  

  

</div>

      </div>
    </div>
    
    <footer
      class="flex border-t border-gray-300 text-gray-600 bg-gray-50 items-center justify-center h-12 text-sm mt-2">
      <div class="flex inner justify-center gap-4">
        <a class="hover:underline" href="https://github.com/limboy" target="_blank">GitHub</a>
        <a class="hover:underline" href="https://twitter.com/_limboy" target="_blank">Twitter</a>
        <a class="hover:underline" href="https://limboy.me/index.xml">RSS</a>
      </div>
    </footer>
    
  </div>

  
  

  <script>
    // éƒ½æ˜¯ä¸ºäº† iOS...
    document.querySelector("#wrapper").style.minHeight = `calc(${window.innerHeight}px - 6.5rem)`
    window.addEventListener('resize', () => {
      document.querySelector("#wrapper").style.minHeight = `calc(${window.innerHeight}px - 6.5rem)`
    })
  </script>
</body>

</html>