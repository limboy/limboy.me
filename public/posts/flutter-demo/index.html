<!DOCTYPE html>
<html>

<head>
  <meta content="width=device-width,initial-scale=1" name="viewport" />
  <meta charset="UTF-8">
  <link rel="icon" href="https://fav.farm/ğŸ‘»" />
  <title>
ä¸€ä¸ª Demo å…¥é—¨ Flutter
</title>
  <link rel="stylesheet" href="/assets/main.css?gkCPK9ibGk2PIXzFp9c+CG7gIjpFY2pNyZ+E7aXMGlU=" />
  <script async defer data-domain="limboy.me" src="https://analytics.limboy.me/js/plausible.js"></script>
  
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@_limboy">
<meta name="twitter:site" content="@_limboy">
<meta property="og:url" content="https://limboy.me/posts/flutter-demo/">

<meta name="twitter:title" content="ä¸€ä¸ª Demo å…¥é—¨ Flutter">
<meta property="og:title" content="ä¸€ä¸ª Demo å…¥é—¨ Flutter">

<meta property="og:description" content="">
<meta name="twitter:description" content="">



</head>

<body class="  ">
  <nav class="flex justify-center items-center opacity-80 bg-black h-12 py-0 ">
    <div class="inner flex justify-between flex-row mx-1">
      <ul class="color-white flex flex-row justify-start gap-4">
        <li><a class="nav-link opacity-90 text-2xl" href="/">Limboy</a></li>
        <!--<li><a class="nav-link" href="/coodle">Coodle</a></li>-->
      </ul>
      <ul class="color-white flex flex-row gap-4 items-center text-base">
        <!--<li> <a class="nav-link" href="/books" class="decoration-0"> Books </a> </li>-->
        <li> <a class="nav-link" href="/highlights" class="decoration-0"> Highlights </a> </li>
        <li> <a class="nav-link" href="/projects" class="decoration-0"> Projects </a> </li>
        <li> <a class="nav-link" href="/about" class="decoration-0"> About </a> </li>
      </ul>
    </div>
  </nav>

  <div class="flex flex-col">
    <div id="wrapper" class="flex justify-center" style="min-height: calc(100vh - 6.5rem);">
      <div class="inner mb-2">
        
<div class="mt-4 lg:mt-6">
  

  <h1 class="title font-medium text-3xl"><a href="https:&#x2F;&#x2F;limboy.me&#x2F;posts&#x2F;flutter-demo&#x2F;">ä¸€ä¸ª Demo å…¥é—¨ Flutter</a></h1>
  <div class="flex gap-4 items-center my-1">
    <time class="text-gray-500">2018-12-07</time>

  </div>
  <hr class="border-t-[3px]" />

  <div class="prose lg:prose-xl max-w-full my-6">
    <p>Flutter æ˜¯ Google ç ”å‘çš„ä¸€å¥—ç§»åŠ¨ç«¯å¼€å‘æ¡†æ¶ï¼Œä¹Ÿæ˜¯ Google æ­£åœ¨ç ”å‘çš„ä¸‹ä¸€ä»£æ“ä½œç³»ç»Ÿ Fuchsia çš„ App å¼€å‘æ¡†æ¶ï¼ˆWeb å’Œ Desktop ä¹Ÿéƒ½åœ¨è¿›è¡Œç§¯æçš„å°è¯•ï¼‰ï¼Œå‰å‡ å¤©åˆšå‘å¸ƒäº† 1.0 æ­£å¼ç‰ˆã€‚å…³äº Flutter çš„åŸç†å’Œä»‹ç»å¯ä»¥å‚è€ƒç¾å›¢çš„<a href="https://tech.meituan.com/waimai_flutter_practice.html">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>
<p>æœ¬æ–‡å¸Œæœ›é€šè¿‡ä¸€ä¸ª Demo æ¥æ›´æ·±å…¥åœ°äº†è§£ Flutter çš„å¸ƒå±€ã€çŠ¶æ€ç®¡ç†ç­‰ç»†èŠ‚ã€‚è¿™ä¸ª Demo å¯ä»¥è·å–è±†ç“£çš„ Top 250 ç”µå½±ï¼Œä»¥è‡ªå®šä¹‰åˆ—è¡¨å½¢å¼å‘ˆç°ï¼Œå¯ä»¥æ”¶è—/å–æ¶ˆæ”¶è—ï¼Œå¯ä»¥ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…é¡µã€‚</p>
<p>æºç : <a href="https://github.com/lzyy/flutter-demo-topmovies">https://github.com/lzyy/flutter-demo-topmovies</a></p>
<p><a href="https://video.twimg.com/ext_tw_video/1070286725656662017/pu/vid/360x640/uoeUgoq2-EigTzi7.mp4?tag=6">è¿™é‡Œ</a>å¯ä»¥æŸ¥çœ‹æœ€ç»ˆçš„æ•ˆæœã€‚</p>

<p  style="text-align:center" ><img src="&#x2F;posts&#x2F;flutter-demo&#x2F;movie250-demo.png"
        width="964" /></p><h3 id="mu-lu-hua-fen">ç›®å½•åˆ’åˆ†</h3>
<p>æ¥åˆ°è¿™ä¸ªéœ€æ±‚åé¦–å…ˆè¦è€ƒè™‘çš„æ˜¯ç›®å½•ç»“æ„åº”è¯¥æ€ä¹ˆåˆ’åˆ†ï¼Œè¿™ä¹Ÿæ˜¯æ¶æ„çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘æ˜¯è¿™ä¹ˆåˆ†çš„:</p>
<pre style="background-color:#f9f9f9;color:#111111;"><code><span>blocs/
</span><span>widgets/
</span><span>models/
</span><span>pages/
</span><span>routes/
</span><span>services/
</span><span>main.dart
</span><span>env.dart
</span></code></pre>
<h4 id="bloc">BLoC</h4>
<p><code>BLoC</code> æ˜¯ Business Logic of Components çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯è´Ÿè´£æ‰€æœ‰ä¸šåŠ¡é€»è¾‘çš„ï¼Œè·Ÿ <code>ViewModel</code> çš„èŒèƒ½æŒºåƒçš„ã€‚æ˜¯ä¸€ä¸ªçº¯æ´çš„ Dart ç±»ï¼Œè·Ÿ UI å®Œå…¨è§£è€¦ï¼Œæ›´åŠ è¯¦ç»†çš„è¯´æ˜å¯ä»¥å‚è§<a href="https://juejin.im/post/5bb6f344f265da0aa664d68a">è¿™ç¯‡æ–‡ç« </a></p>
<h4 id="widgets">Widgets</h4>
<p>è¿™ä¸ªç›®å½•ä¸‹é¢æ”¾çš„æ˜¯æ‰€æœ‰çš„ Widgetï¼ŒWidget ä½äº Flutter Framework çš„æœ€ä¸Šå±‚ï¼Œç”¨æ¥æè¿° UI å…ƒç´ çš„ Layout / Animation ç­‰ï¼Œæˆ–è€…é UI å…ƒç´ (å¦‚ DataProvider)ï¼Œæœ€ç»ˆè¿™äº› Widget ä¼šè¢«ç»„è£…èµ·æ¥å½¢æˆ Pageã€‚</p>
<h4 id="models">Models</h4>
<p>æœåŠ¡ç«¯çš„ JSON è¿‡æ¥åï¼Œéœ€è¦è½¬æ¢æˆå¯¹åº”çš„ Model æ–¹ä¾¿ä½¿ç”¨ï¼ŒModel ä¸éœ€è¦åŒ…å«ä¸šåŠ¡é€»è¾‘ï¼Œä½†å¯ä»¥æœ‰ä¸€äº›ç®€å•çš„ Model ç›¸å…³çš„æ“ä½œï¼Œæ¯”å¦‚ CRUDã€‚</p>
<h4 id="pages">Pages</h4>
<p>é€šå¸¸ä¸€ä¸ª App ä¼šæœ‰å¤šä¸ªé¡µé¢ç»„æˆï¼Œè¿™äº›é¡µé¢å°±å¯ä»¥æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹ã€‚</p>
<h4 id="routes">Routes</h4>
<p>è™½ç„¶ Flutter ä¹Ÿæ”¯æŒç›´æ¥ push ä¸€ä¸ª Widgetï¼Œä½†è¿™æ ·ä¸æ–¹ä¾¿é¡µé¢ç®¡ç†ï¼Œå¯¹äºåƒã€Œå¤–éƒ¨çš„ URL å¯ä»¥ç›´æ¥è·³è½¬åˆ°æŸä¸ªé¡µé¢ã€è¿™æ ·çš„åŠŸèƒ½å¤„ç†èµ·æ¥ä¹Ÿä¼šéº»çƒ¦äº›ã€‚å› æ­¤ï¼Œéœ€è¦æœ‰ä¸€ä¸ªåœ°æ–¹å¯ä»¥å¯¹ URL è¿›è¡Œæ³¨å†Œã€‚</p>
<h4 id="services">Services</h4>
<p>è¿™ä¸ªæ˜¯æ”¾ Remote API ç›¸å…³çš„ï¼Œç†è®ºä¸Šæ¥è¯´ï¼ŒåŠ ä¸€å±‚ Repository æŠ½è±¡ä¼šæ›´åŠ åˆé€‚ï¼Œå‡ºäºæ–¹ä¾¿ï¼Œå°±å»æ‰äº†è¿™ä¸€å±‚ã€‚</p>
<h4 id="main-dart">main.dart</h4>
<p>å…¥å£æ–‡ä»¶ï¼Œç”¨æ¥åˆå§‹åŒ– App</p>
<h4 id="env-dart">env.dart</h4>
<p>ç”¨æ¥è®¾ç½®ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œç±»ä¼¼äº Configã€‚</p>
<p>è®¾ç½®å¥½äº†ç›®å½•åï¼Œæ¥ä¸‹æ¥è¿›è¡Œä»»åŠ¡åˆ†è§£ï¼Œé¦–å…ˆè¦å®Œæˆçš„å°±æ˜¯å¸ƒå±€ï¼Œè¿›è¡Œå¸ƒå±€ä¹‹å‰éœ€è¦æœ‰æ•°æ®æºï¼Œæ–¹ä¾¿æ¨¡æ‹Ÿï¼Œæœ€å¥½è·Ÿæ­£å¼æ¥å£ä¸€è‡´ï¼Œé‚£å°±å…ˆæ¥å®Œæˆè¿™ä¸€é¡¹å·¥ä½œã€‚</p>
<h3 id="she-zhi-shu-ju-jie-kou">è®¾ç½®æ•°æ®æ¥å£</h3>
<p>æˆ‘ä»¬å¸Œæœ›ä»æ¨¡æ‹Ÿç¯å¢ƒåˆ°çœŸå®ç¯å¢ƒåªéœ€æ”¹ä¸€ä¸ªé…ç½®å³å¯ï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬å…ˆæŠŠåè®®å®šå¥½ï¼Œåˆ°æ—¶åªè¦æ¢ä¸€ä¸ªå®ç°å°±è¡Œã€‚è¿™é‡Œä¼šç”¨åˆ°ä¸¤ä¸ªæ¥å£</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#8959a8;">import </span><span style="color:#839c00;">&#39;package:topmovies/models/movie.dart&#39;</span><span>;
</span><span>
</span><span style="color:#8959a8;">abstract class </span><span style="color:#c99e00;">API</span><span> {
</span><span>  </span><span style="color:#c99e00;">Future</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">MovieEnvelope</span><span style="color:#3e999f;">&gt; </span><span style="color:#4271ae;">getMovieList</span><span>(</span><span style="color:#c99e00;">int</span><span> start);
</span><span>  </span><span style="color:#c99e00;">Future</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">Movie</span><span style="color:#3e999f;">&gt; </span><span style="color:#4271ae;">getMovie</span><span>(</span><span style="color:#c99e00;">String</span><span> movieID);
</span><span>}
</span></code></pre>
<p>ç„¶åæ–°å»ºä¸€ä¸ª Mock API ç±»æ¥å®ç°è¿™ä¸ªæ¥å£</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#8959a8;">class </span><span style="color:#c99e00;">MockAPI </span><span style="color:#8959a8;">extends </span><span style="color:#c99e00;">API</span><span> {
</span><span>  </span><span style="color:#8959a8;">@override
</span><span>  </span><span style="color:#c99e00;">Future</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">Movie</span><span style="color:#3e999f;">&gt; </span><span style="color:#4271ae;">getMovie</span><span>(</span><span style="color:#c99e00;">String</span><span> movieID) {
</span><span>    </span><span style="color:#8959a8;">return </span><span style="color:#4271ae;">createMockMovieWithTitle</span><span>(</span><span style="color:#839c00;">&#39;æˆ‘æ˜¯ç”µå½± $</span><span style="color:#f07219;">movieID</span><span style="color:#839c00;">&#39;</span><span>);
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#8959a8;">@override
</span><span>  </span><span style="color:#c99e00;">Future</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">MovieEnvelope</span><span style="color:#3e999f;">&gt; </span><span style="color:#4271ae;">getMovieList</span><span>(</span><span style="color:#c99e00;">int</span><span> start) {
</span><span>    </span><span style="color:#8e908c;">// ç°åœ¨è¿˜ç”¨ä¸ç€
</span><span>    </span><span style="color:#8959a8;">return </span><span style="color:#f07219;">null</span><span>;
</span><span>  }
</span><span>}
</span></code></pre>
<p>ç„¶ååœ¨ <code>env.dart</code> é‡Œæ–°å»ºä¸€ä¸ª Env ç±»</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#8959a8;">import </span><span style="color:#839c00;">&#39;services/api.dart&#39;</span><span>;
</span><span>
</span><span style="color:#8959a8;">class </span><span style="color:#c99e00;">Env</span><span> {
</span><span>  </span><span style="color:#8959a8;">static </span><span style="color:#c99e00;">API</span><span> apiClient;
</span><span>}
</span></code></pre>
<p>å…¶å®å°±æ˜¯æä¾›ä¸€ä¸ªå…¨å±€çš„ apiClient æ³¨å…¥æ¥å£ï¼ŒApp åˆå§‹åŒ–æ—¶ï¼Œè®¾ç½®å¥½ apiClientï¼Œä½¿ç”¨æ—¶ä¸éœ€è¦å…³å¿ƒæ˜¯å“ªä¸ª apiClient å®ä¾‹ï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿å•å…ƒæµ‹è¯•ã€‚</p>
<p>ç»è¿‡è¿™ä¸¤æ­¥åï¼Œæ•°æ®æ¥å£å°±å‡†å¤‡å¥½äº†ï¼Œæ¥ä¸‹æ¥éœ€è¦è®¾ç½® BLoCã€‚</p>
<h3 id="she-zhi-shou-ye-de-bloc">è®¾ç½®é¦–é¡µçš„ BLoC</h3>
<p>BLoC å…¶å®å°±æ˜¯ ViewModelï¼Œæœ‰äº† API å®ç°ä¹‹åï¼Œæ¥ä¸‹æ¥å°±è¦è®© Widget å¯ä»¥ç”¨ä¸Šè¿™äº›æ•°æ®ï¼Œè¿™å°±æ˜¯ BLoC åšçš„äº‹ã€‚</p>

<p  style="text-align:center" ><img src="&#x2F;posts&#x2F;flutter-demo&#x2F;movie250-bloc.png"
        width="561" /></p>
<p>Widget å‘Šè¯‰ BLoC å‘ç”Ÿäº†ä»€ä¹ˆï¼ŒBLoC å‘Šè¯‰ Widget å“ªäº›æ•°æ®æ›´æ–°äº†ã€‚</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#8959a8;">class </span><span style="color:#c99e00;">MoviesBloc </span><span style="color:#8959a8;">extends </span><span style="color:#c99e00;">BlocBase</span><span> {
</span><span>  </span><span style="color:#8959a8;">final </span><span style="color:#c99e00;">BehaviorSubject</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">MovieEnvelope</span><span style="color:#3e999f;">&gt;</span><span> _movieEnvelope </span><span style="color:#3e999f;">= </span><span style="color:#c99e00;">BehaviorSubject</span><span>();
</span><span>  </span><span style="color:#8959a8;">var</span><span> _currentStart </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">0</span><span>;
</span><span>
</span><span>  </span><span style="color:#c99e00;">Observable</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">MovieEnvelope</span><span style="color:#3e999f;">&gt; </span><span style="color:#8959a8;">get </span><span style="color:#4271ae;">movieEnvelope</span><span> =&gt; _movieEnvelope.stream;
</span><span>
</span><span>  </span><span style="color:#c99e00;">MoviesBloc</span><span>() {
</span><span>    </span><span style="color:#4271ae;">_getMovies</span><span>();
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#4271ae;">_getMovies</span><span>() {
</span><span>    </span><span style="color:#c99e00;">Env</span><span>.apiClient.</span><span style="color:#4271ae;">getMovieList</span><span>(_currentStart).</span><span style="color:#4271ae;">then</span><span>((movieEnvelope) {
</span><span>      </span><span style="color:#8959a8;">var</span><span> newMovieEnvelope </span><span style="color:#3e999f;">=</span><span> movieEnvelope;
</span><span>      </span><span style="color:#8959a8;">if</span><span> (_movieEnvelope.value </span><span style="color:#3e999f;">!= </span><span style="color:#f07219;">null</span><span>) {
</span><span>        newMovieEnvelope.movies </span><span style="color:#3e999f;">=</span><span> _movieEnvelope.value.movies
</span><span>          ..</span><span style="color:#4271ae;">addAll</span><span>(movieEnvelope.movies);
</span><span>      }
</span><span>      _movieEnvelope.</span><span style="color:#4271ae;">add</span><span>(newMovieEnvelope);
</span><span>      _currentStart </span><span style="color:#3e999f;">=</span><span> movieEnvelope.movies.length;
</span><span>    });
</span><span>  }
</span><span>}
</span></code></pre>
<p>å¯¹äº Widget æ¥è¯´ï¼Œåªè¦ listen <code>bloc.movieEnvelope</code> å°±èƒ½ç¬¬ä¸€æ—¶é—´æ‹¿åˆ°æœ€æ–°çš„ movie æ•°æ®ï¼Œç„¶åæŠŠå®ƒä»¬å±•ç¤ºå‡ºæ¥å³å¯ã€‚</p>
<h3 id="streambuilder">StreamBuilder</h3>
<p>å¦‚æœç›´æ¥ç”¨ <code>setState</code> çš„è¯ï¼Œä½¿ç”¨å§¿åŠ¿æ˜¯åœ¨ state çš„ <code>initState</code> æ—¶ listen <code>bloc.movieEnvelope</code>ï¼Œå½“æ”¶åˆ°æ–°çš„å†…å®¹æ—¶ï¼ŒsetStateï¼Œè¿™æ ·ç³»ç»Ÿå°±ä¼š rebuild widgetï¼Œç„¶åç”¨ä¸Šæœ€æ–°çš„æ•°æ®ã€‚Flutter å¾ˆè´´å¿ƒåœ°æä¾›äº†ä¾¿æ·çš„ç±» <code>StreamBuilder</code>ï¼Œåªè¦å‘Šè¯‰å®ƒ <code>stream</code>ï¼Œé‚£ä¹ˆå½“è¿™ä¸ª stream æœ‰æ–°æ•°æ®æ—¶ï¼Œ<code>itemBuilder</code> å°±ä¼šè‡ªåŠ¨ rebuildã€‚</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#8959a8;">class </span><span style="color:#c99e00;">Movies </span><span style="color:#8959a8;">extends </span><span style="color:#c99e00;">StatefulWidget</span><span> {
</span><span>  </span><span style="color:#8959a8;">@override
</span><span>  </span><span style="color:#c99e00;">State</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">StatefulWidget</span><span style="color:#3e999f;">&gt; </span><span style="color:#4271ae;">createState</span><span>() {
</span><span>    </span><span style="color:#8959a8;">return </span><span style="color:#c99e00;">_MoviesState</span><span>();
</span><span>  }
</span><span>}
</span><span>
</span><span style="color:#8959a8;">class </span><span style="color:#c99e00;">_MoviesState </span><span style="color:#8959a8;">extends </span><span style="color:#c99e00;">State</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">Movies</span><span style="color:#3e999f;">&gt;</span><span> {
</span><span>  </span><span style="color:#8959a8;">@override
</span><span>  </span><span style="color:#c99e00;">Widget </span><span style="color:#4271ae;">build</span><span>(</span><span style="color:#c99e00;">BuildContext</span><span> context) {
</span><span>
</span><span>    </span><span style="color:#8959a8;">final</span><span> bloc </span><span style="color:#3e999f;">= </span><span style="color:#c99e00;">BlocProvider</span><span>.</span><span style="color:#4271ae;">of</span><span>&lt;</span><span style="color:#c99e00;">MoviesBloc</span><span style="color:#3e999f;">&gt;</span><span>(context);
</span><span>
</span><span>    </span><span style="color:#8959a8;">return </span><span style="color:#c99e00;">StreamBuilder</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">MovieEnvelope</span><span style="color:#3e999f;">&gt;</span><span>(
</span><span>        stream</span><span style="color:#3e999f;">:</span><span> bloc.movieEnvelope,
</span><span>        builder</span><span style="color:#3e999f;">:</span><span> (context, snapshot) {
</span><span>        </span><span style="color:#8e908c;">// snapshot.data å°±æ˜¯æœ€æ–°çš„å†…å®¹
</span><span>        </span><span style="color:#8e908c;">// è¿”å›ä¸€ä¸ªæ–°çš„ widget å³å¯
</span><span>        })
</span><span>  }
</span><span>}
</span></code></pre>
<p>æ³¨æ„åˆ°è¿™é‡Œæœ‰ä¸€ä¸ª <code>BlocProvider</code>ï¼Œè¿™æ˜¯ä½•ç‰©ï¼Ÿå®ƒå…¶å®ä¹Ÿæ˜¯ä¸ª Widgetï¼ˆæ˜¯çš„ï¼ŒFlutter çš„ Widget å¹¶ä¸å±€é™äº UIï¼‰ã€‚</p>
<p>ä¸ºä»€ä¹ˆé€šè¿‡<code>of</code>æ–¹æ³•èƒ½æ‹¿åˆ°è¿™ä¸ª blocï¼Ÿå› ä¸ºåœ¨æ„å»º Tree æ—¶ï¼Œ<code>BlocProvider</code> å¥—åœ¨äº†å½“å‰è§†å›¾çš„ä¸Šå±‚(åªè¦ä»å½“å‰èŠ‚ç‚¹å‘ä¸Šè¿½æº¯èƒ½æ‰¾åˆ°å°±è¡Œ)ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#8959a8;">class </span><span style="color:#c99e00;">MyApp </span><span style="color:#8959a8;">extends </span><span style="color:#c99e00;">StatelessWidget</span><span> {
</span><span>  </span><span style="color:#8959a8;">@override
</span><span>  </span><span style="color:#c99e00;">Widget </span><span style="color:#4271ae;">build</span><span>(</span><span style="color:#c99e00;">BuildContext</span><span> context) {
</span><span>    </span><span style="color:#8959a8;">return </span><span style="color:#c99e00;">BlocProvider</span><span>(
</span><span>        bloc</span><span style="color:#3e999f;">: </span><span style="color:#c99e00;">MoviesBloc</span><span>(),
</span><span>        child</span><span style="color:#3e999f;">: </span><span style="color:#c99e00;">MaterialApp</span><span>(
</span><span>          title</span><span style="color:#3e999f;">: </span><span style="color:#839c00;">&#39;Douban Movie Top 250&#39;</span><span>,
</span><span>          home</span><span style="color:#3e999f;">: </span><span style="color:#c99e00;">Home</span><span>(),
</span><span>        ));
</span><span>  }
</span><span>}
</span></code></pre>
<p>è€Œè¿™ä¸ª <code>of</code> æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#8959a8;">static </span><span style="color:#c99e00;">T </span><span style="color:#4271ae;">of</span><span>&lt;</span><span style="color:#c99e00;">T </span><span style="color:#8959a8;">extends </span><span style="color:#c99e00;">BlocBase</span><span style="color:#3e999f;">&gt;</span><span>(</span><span style="color:#c99e00;">BuildContext</span><span> context) {
</span><span>  </span><span style="color:#8959a8;">final</span><span> type </span><span style="color:#3e999f;">= </span><span style="color:#4271ae;">_typeOf</span><span>&lt;</span><span style="color:#c99e00;">BlocProvider</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">T</span><span style="color:#3e999f;">&gt;&gt;</span><span>();
</span><span>  </span><span style="color:#8e908c;">// è¿™å¥è¯çš„æ„æ€å°±æ˜¯ä»å½“å‰ context å‘ä¸Šæ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªè¯¥ç±»å‹çš„å®ä¾‹ä¸ºæ­¢ï¼Œæ‰¾ä¸åˆ°å°±è¿”å› null
</span><span>  </span><span style="color:#c99e00;">BlocProvider</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">T</span><span style="color:#3e999f;">&gt;</span><span> provider </span><span style="color:#3e999f;">=</span><span> context.</span><span style="color:#4271ae;">ancestorWidgetOfExactType</span><span>(type);
</span><span>  </span><span style="color:#8959a8;">return</span><span> provider.bloc;
</span><span>}
</span></code></pre>
<p>BLoC å·®ä¸å¤šæœ‰äº†ä¹‹åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è¿›å…¥å¸ƒå±€é˜¶æ®µäº†ã€‚</p>
<h3 id="shou-ye-bu-ju">é¦–é¡µå¸ƒå±€</h3>

<p  style="text-align:center" ><img src="&#x2F;posts&#x2F;flutter-demo&#x2F;movie250-home-layout.png"
        width="255" /></p>
<p>Flutter æä¾›äº†ä¸¤ç§åˆ—è¡¨å¸ƒå±€æ–¹å¼: <code>ListView</code> å’Œ <code>GridView</code>ï¼Œå¦‚æœé¡µé¢é‡Œé™¤äº†åˆ—è¡¨è¿˜æœ‰å…¶ä»–å…ƒç´ ï¼ˆæ¯”å¦‚é¡¶éƒ¨çš„ SlideView ç­‰ï¼‰ï¼Œå°±éœ€è¦ç”¨åˆ° <code>CustomScrollView</code> æˆ–è€… <code>NestedScrollView</code>ï¼Œé¦–é¡µé™¤äº†åˆ—è¡¨æ²¡æœ‰å…¶ä»–å…ƒç´ ï¼ŒåŒæ—¶ä¸€è¡Œå¯èƒ½åŒ…å«å¤šä¸ªè§†å›¾ï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹© <a href="https://docs.flutter.io/flutter/widgets/GridView-class.html">GridView</a>ã€‚</p>
<p>GridView çš„æ„å»ºå¯ä»¥ä½¿ç”¨ <code>GridView.builder</code>, å®ƒéœ€è¦æä¾›å‡ ä¸ªå…³é”®ä¿¡æ¯:</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#c99e00;">GridView</span><span>.</span><span style="color:#4271ae;">builder</span><span>(
</span><span>  gridDelegate</span><span style="color:#3e999f;">: </span><span style="color:#8e908c;">// æä¾›æœ€ç»ˆçš„å¸ƒå±€ä¿¡æ¯ï¼Œx,y,width.height
</span><span>  itemCount</span><span style="color:#3e999f;">: </span><span style="color:#8e908c;">// ä¸€å…±æœ‰å¤šå°‘å…ƒç´ 
</span><span>  itemBuilder</span><span style="color:#3e999f;">:</span><span> (context, index) {} </span><span style="color:#8e908c;">// æ¯ä¸ª item å…·ä½“é•¿å•¥æ ·
</span><span>);
</span></code></pre>
<p>å¦‚æœæ˜¯å›ºå®šçš„æ¯è¡Œå‡ åˆ—æˆ–å›ºå®šå®½åº¦ï¼Œä¸”æ¯ä¸ª item çš„å‘ˆç°å½¢å¼å‡ ä¹ä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è‡ªå¸¦çš„ <code>SliverGridDelegateWithFixedCrossAxisCount</code> æˆ– <code>SliverGridDelegateWithMaxCrossAxisExtent</code>ï¼Œæˆ‘ä»¬è¿™ä¸ª case ä¸­ï¼Œæ¯ä¸€è¡Œçš„åˆ—è¡¨ä¸éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨ï¼Œè¿™å°±éœ€è¦è¿›å…¥åˆ°é«˜çº§æ¨¡å¼äº†ï¼Œè‡ªå·±å®ç° <code>gridDelegate</code>ã€‚ <code>SliverGridDelegate</code> çš„æ ¸å¿ƒæ–¹æ³•æ˜¯ <code>SliverGridLayout getLayout(SliverConstraints constraints);</code> ä¹Ÿå°±æ˜¯è¿”å›ä¸€ä¸ª <code>SliverGridLayout</code>ï¼Œç³»ç»Ÿæ‹¿åˆ°è¿™ä¸ª layout ä¹‹åï¼Œå°±çŸ¥é“è¯¥æ€ä¹ˆå¸ƒå±€äº†ã€‚</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#8959a8;">abstract class </span><span style="color:#c99e00;">SliverGridLayout</span><span> {
</span><span>  </span><span style="color:#8e908c;">/// é’ˆå¯¹æŸä¸ª scroll çš„åç§»é‡ï¼Œæœ€å°çš„ index æ˜¯å¤šå°‘
</span><span>  </span><span style="color:#c99e00;">int </span><span style="color:#4271ae;">getMinChildIndexForScrollOffset</span><span>(</span><span style="color:#c99e00;">double</span><span> scrollOffset);
</span><span>
</span><span>  </span><span style="color:#8e908c;">/// é’ˆå¯¹æŸä¸ª scroll çš„åç§»é‡ï¼Œæœ€å¤§çš„ index æ˜¯å¤šå°‘
</span><span>  </span><span style="color:#c99e00;">int </span><span style="color:#4271ae;">getMaxChildIndexForScrollOffset</span><span>(</span><span style="color:#c99e00;">double</span><span> scrollOffset);
</span><span>
</span><span>  </span><span style="color:#8e908c;">/// ç»™ä¸€ä¸ª indexï¼Œå‘Šè¯‰æˆ‘å®ƒçš„ x,y,width,height
</span><span>  </span><span style="color:#c99e00;">SliverGridGeometry </span><span style="color:#4271ae;">getGeometryForChildIndex</span><span>(</span><span style="color:#c99e00;">int</span><span> index);
</span><span>
</span><span>  </span><span style="color:#8e908c;">/// è¿™äº› childcount ä¸€å…±èƒ½äº§ç”Ÿå¤šå¤§çš„åç§»é‡
</span><span>  </span><span style="color:#8e908c;">/// çŸ¥é“äº†è¿™ä¸ªä¿¡æ¯åï¼Œç³»ç»Ÿå°±å¯ä»¥å±•ç¤ºæ»šåŠ¨æ¡çš„é•¿çŸ­äº†
</span><span>  </span><span style="color:#c99e00;">double </span><span style="color:#4271ae;">computeMaxScrollOffset</span><span>(</span><span style="color:#c99e00;">int</span><span> childCount);
</span><span>}
</span></code></pre>
<p>å…·ä½“å®ç°è¿™é‡Œå°±ä¸è´´å‡ºæ¥äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥åœ¨æºç é‡Œçœ‹ã€‚è¿˜æ˜¯æœ‰ç‚¹å°å¤æ‚çš„ï¼Œå°¤å…¶æ˜¯åŠ ä¸Š loadmore çš„é€»è¾‘åï¼Œä¸è¿‡çŸ¥é“äº†ç³»ç»Ÿæƒ³è¦ä»€ä¹ˆï¼Œæƒ³å°½åŠæ³•æ»¡è¶³å®ƒå°±æ˜¯äº†ã€‚</p>
<h3 id="zai-ru-geng-duo">è½½å…¥æ›´å¤š</h3>
<p>ç¬¬ä¸€æ¬¡è¯·æ±‚çš„å¸ƒå±€æ˜¯å®Œæˆäº†ï¼Œå¦‚ä½•å®ç°è½½å…¥æ›´å¤šçš„æ•ˆæœå‘¢ï¼Ÿåœ¨ iOS ä¸­ä¼šé€šè¿‡åˆ¤æ–­æ˜¯å¦æ‹‰åˆ°äº†åº•éƒ¨æ¥è§¦å‘åŠ è½½æ›´å¤šçš„é€»è¾‘ï¼Œåœ¨ Flutter ä¸­æˆ‘ä»¬å¯ä»¥æ¢ä¸€ç§æ–¹å¼æ¥è¾¾åˆ°æ•ˆæœã€‚</p>
<p>ä»€ä¹ˆæ—¶å€™éœ€è¦åŠ è½½æ›´å¤šï¼Ÿå½“å‰è§†å›¾çš„ item éƒ½å±•ç¤ºå®Œäº†çš„æ—¶å€™ï¼Œè€Œåœ¨å±•ç¤º item æ—¶ï¼Œbuilder ä¼šä¼ å…¥ä¸€ä¸ª <code>index</code>ï¼Œç”¨æ¥å‘ŠçŸ¥å½“å‰ item å¤„äºå“ªä¸ª <code>index</code>ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªä¿¡æ¯å‘Šè¯‰ BLoCã€‚æ¯”å¦‚ç¬¬ä¸€é¡µä¸€å…±å±•ç¤º 20 éƒ¨ç”µå½±ï¼Œå½“ BLoC æ”¶åˆ° index 19 æ—¶ï¼Œå°±çŸ¥é“è¿™ 20 éƒ¨éƒ½å·²ç»è¢«å±•ç¤ºè¿‡äº†ï¼Œå°±å¯ä»¥é€šè¿‡ API å»æ‹¿æ›´å¤šçš„æ•°æ®ï¼Œç­‰æ‹¿åˆ°åï¼Œè·ŸåŸå…ˆçš„æ•°æ®è¿›è¡Œåˆå¹¶ï¼Œç„¶åä½œä¸ºæ–°çš„å€¼å‘Šè¯‰ widgetï¼Œwidget çš„ StreamBuilder å‘ç°æœ‰æ–°æ•°æ®åï¼Œè‡ªåŠ¨åˆ·æ–° widgetï¼Œè¿™æ ·æ–°çš„ç”µå½±å°±è¢«å±•ç¤ºå‡ºæ¥äº†ã€‚</p>
<p>ç¨å¾®å¤æ‚çš„ä¸€ç‚¹æ˜¯åŠ è½½æ›´å¤šæ—¶ï¼Œéœ€è¦å±•ç¤ºä¸€ä¸ª indicatorï¼Œå½“æ²¡æœ‰æ›´å¤šæ•°æ®æ—¶ï¼Œåˆæ˜¯å¦ä¸€ä¸ªæ ·å¼ï¼Œè¿™åˆè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿå¯ä»¥æ€è€ƒä¸‹ã€‚</p>
<h3 id="real-api-jie-ru">Real API æ¥å…¥</h3>
<p>å‰é¢è¿™å‡ æ­¥éƒ½èµ°å®Œåï¼Œåˆ—è¡¨çš„å¸ƒå±€åº”è¯¥æ²¡é—®é¢˜äº†ï¼Œæ¥ä¸‹æ¥å°±è¦æ¥å…¥çœŸå®çš„æ•°æ®äº†ã€‚è¿™ä¸ªæ¥å…¥è¿‡ç¨‹è¿˜æ˜¯æŒºç®€å•çš„ï¼Œæ–°å»ºä¸€ä¸ªå®ç°äº† <code>API</code> çš„ç±»ï¼Œç„¶ååœ¨ App å…¥å£å¤„ï¼Œç”¨å®ƒæ›¿æ¢æ‰ MockAPI</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#8959a8;">class </span><span style="color:#c99e00;">RealAPI </span><span style="color:#8959a8;">extends </span><span style="color:#c99e00;">API</span><span> {
</span><span>  </span><span style="color:#8959a8;">@override
</span><span>  </span><span style="color:#c99e00;">Future</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">MovieEnvelope</span><span style="color:#3e999f;">&gt; </span><span style="color:#4271ae;">getMovieList</span><span>(</span><span style="color:#c99e00;">int</span><span> start) </span><span style="color:#8959a8;">async</span><span> {
</span><span>    </span><span style="color:#8959a8;">var</span><span> client </span><span style="color:#3e999f;">= </span><span style="color:#c99e00;">HttpClient</span><span>();
</span><span>    </span><span style="color:#8959a8;">var</span><span> request </span><span style="color:#3e999f;">= </span><span style="color:#8959a8;">await</span><span> client.</span><span style="color:#4271ae;">getUrl</span><span>(</span><span style="color:#c99e00;">Uri</span><span>.</span><span style="color:#4271ae;">parse</span><span>(
</span><span>        </span><span style="color:#839c00;">&#39;https://api.douban.com/v2/movie/top250?start=$</span><span style="color:#f07219;">start</span><span style="color:#839c00;">&amp;count=40&#39;</span><span>));
</span><span>    </span><span style="color:#8959a8;">var</span><span> response </span><span style="color:#3e999f;">= </span><span style="color:#8959a8;">await</span><span> request.</span><span style="color:#4271ae;">close</span><span>();
</span><span>    </span><span style="color:#8959a8;">var</span><span> responseBody </span><span style="color:#3e999f;">= </span><span style="color:#8959a8;">await</span><span> response.</span><span style="color:#4271ae;">transform</span><span>(utf8.decoder).</span><span style="color:#4271ae;">join</span><span>();
</span><span>    </span><span style="color:#c99e00;">Map</span><span> data </span><span style="color:#3e999f;">=</span><span> json.</span><span style="color:#4271ae;">decode</span><span>(responseBody);
</span><span>    </span><span style="color:#8959a8;">return </span><span style="color:#c99e00;">MovieEnvelope</span><span>.</span><span style="color:#4271ae;">fromJSON</span><span>(data);
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#8959a8;">@override
</span><span>  </span><span style="color:#c99e00;">Future</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">Movie</span><span style="color:#3e999f;">&gt; </span><span style="color:#4271ae;">getMovie</span><span>(</span><span style="color:#c99e00;">String</span><span> movieID) </span><span style="color:#8959a8;">async</span><span> {
</span><span>    </span><span style="color:#8e908c;">// æš‚æ—¶è¿˜ç”¨ä¸åˆ°ï¼Œå…ˆå¿½ç•¥
</span><span>    </span><span style="color:#8959a8;">return </span><span style="color:#f07219;">null</span><span>;
</span><span>  }
</span><span>}
</span></code></pre>
<p>Dart å†…ç½®äº†å¯¹å¼‚æ­¥è¯·æ±‚çš„æ”¯æŒï¼Œåˆ†ä¸ºä¸¤å¤§å—ï¼Œ<code>async + await + Future</code> å’Œ <code>Stream + async* + yield</code>ï¼Œå‰è€…ç”¨æ¥å¤„ç†å•æ¬¡æˆ–å°‘é‡çš„å¼‚æ­¥è¯·æ±‚ï¼Œåè€…ç”¨æ¥å®ç°å¼‚æ­¥çš„ <code>iterator</code>ï¼Œä¹Ÿå°±æ˜¯æ•°æ®å¯èƒ½ä¼šæºæºä¸æ–­åœ°å†’å‡ºæ¥ã€‚</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡ await æ¥æ‹¿å¼‚æ­¥æ•°æ®å°±å¯ä»¥äº†ï¼Œæ‹¿åˆ°ä¹‹åæŠŠå®ƒè½¬æ¢ä¸º model(æ–¹ä¾¿èµ·è§ï¼Œé”™è¯¯å¤„ç†å°±å…ˆå¿½ç•¥)ã€‚ ç„¶ååœ¨å…¥å£å¤„è®¾ç½®</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#8959a8;">void </span><span style="color:#4271ae;">main</span><span>() {
</span><span>  </span><span style="color:#c99e00;">Env</span><span>.apiClient </span><span style="color:#3e999f;">= </span><span style="color:#c99e00;">RealAPI</span><span>();
</span><span>  </span><span style="color:#4271ae;">runApp</span><span>(</span><span style="color:#c99e00;">MyApp</span><span>());
</span><span>}
</span></code></pre>
<h3 id="item-de-nei-rong-zhan-shi">item çš„å†…å®¹å±•ç¤º</h3>
<p>è¿™å—æ˜¯ä¸ªç»†è‡´æ´»ï¼Œå¯¹äº Widget å…ƒç´ çš„ä½¿ç”¨å¯ä»¥å‚è€ƒå®˜æ–¹çš„<a href="https://flutter.io/docs/development/ui/layout">è¿™ä¸ªæ•™ç¨‹</a>ï¼Œéœ€è¦æä¸€ç‚¹çš„æ˜¯ <code>LayoutBuilder</code> è¿™ä¸ª widgetï¼Œé»˜è®¤ child widget æ˜¯æ‹¿ä¸åˆ° parent çš„å¸ƒå±€ä¿¡æ¯çš„ï¼Œä½†æœ‰æ—¶åˆéœ€è¦æ‹¿å®ƒæ¥è¿›è¡Œä¸€äº›è®¡ç®—ï¼Œè¿™æ—¶å°±å¯ä»¥åœ¨å¤–é¢å¥—ä¸€å±‚ <code>LayoutBuilder</code>ï¼Œå®ƒçš„ <code>builder</code> å±æ€§æ˜¯ä¸€ä¸ª functionï¼Œä¼šä¼ ä¸€ä¸ª <code>BoxConstraints</code> è¿›æ¥ï¼Œé€šè¿‡å®ƒå°±èƒ½æ‹¿åˆ° parent çš„å¸ƒå±€ä¿¡æ¯ã€‚</p>
<h3 id="shou-cang-ying-pian">æ”¶è—å½±ç‰‡</h3>
<p>ç‚¹å‡»å½±ç‰‡ title æ—è¾¹çš„ <code>...</code>ï¼Œ å¦‚æœæ˜¯ iOS å¹³å°ï¼Œåˆ™å¼¹å‡ºä¸€ä¸ª <code>ActionSheet</code>ï¼ŒAndroid åˆ™å¼¹å‡º <code>BottomSheet</code>ï¼Œé€‰æ‹©æ”¶è—çš„è¯ï¼Œè¿™ä¸ª <code>...</code> ä¼šå˜æˆçº¢è‰²ã€‚</p>
<p>å¦‚æœè¦é’ˆå¯¹ä¸åŒå¹³å°è¿›è¡Œä¸åŒçš„å±•ç¤ºï¼Œå¯ä»¥ä½¿ç”¨ <code>Platform.isIOS</code> æ¥åŒºåˆ†(è¿™ä¸ªç±»åœ¨ <code>dart:io</code> package ä¸‹)ï¼Œå…³äº <code>ActionSheet</code> å’Œ <code>BottomSheet</code> çš„ä½¿ç”¨ï¼ŒæŸ¥çœ‹ç›¸åº”çš„ API å³å¯ã€‚æ¯”è¾ƒéº»çƒ¦çš„æ˜¯ <code>...</code> çš„å˜è‰²å¤„ç†ï¼Œå€’ä¸æ˜¯å˜è‰²éº»çƒ¦ï¼Œè€Œæ˜¯è¦è®©è¿™ä¸ªçŠ¶æ€å¾—åˆ°ä¿æŒï¼Œä¸ç„¶ä¸‹æ¬¡å†æ»‘åˆ°è¯¥ item æ—¶ï¼Œåˆä¼šå›åˆ°åŸå…ˆçš„é¢œè‰²ã€‚</p>
<p>å¤§å¤šæ•°çš„æ•™ç¨‹é‡Œï¼Œå¯¹è¿™éƒ¨åˆ†çš„å¤„ç†éƒ½æ˜¯æ›´æ–° list ä¸­è¯¥ item å¯¹åº”çš„ modelï¼Œç„¶åè®©æ›´æ–°åçš„ list è§¦å‘ StreamBuilder é‡æ–°æ¸²æŸ“ widgetï¼Œæˆ‘è§‰å¾—è¿™æ ·å®åœ¨æœ‰ç‚¹å°é¢˜å¤§åšäº†ã€‚æˆ‘çš„åšæ³•æ˜¯ç»™æ¯ä¸ª item é…ä¸€ä¸ªå¯¹åº”çš„ blocï¼Œitem çš„ model å’ŒçŠ¶æ€éƒ½ä¿å­˜åœ¨è¿™ä¸ª bloc ä¸­ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“æŸä¸ª movie item widget éœ€è¦æ›´æ–°çŠ¶æ€æ—¶ï¼Œä»å®ƒå¯¹åº”çš„ bloc ä¸­æ‹¿å³å¯ã€‚</p>
<p>å¦‚æœè¿™æ—¶è¦æ–°åŠ ä¸€ä¸ª Featureï¼Œå½“æ”¶è—ç”µå½±æ—¶ï¼Œé¡¶éƒ¨ AppBar çš„å³è¾¹è¦æœ‰å¯¹åº”çš„æ•°å­—æ˜¾ç¤ºã€‚åœ¨ Google å®˜æ–¹çš„ <a href="https://www.youtube.com/watch?v=RS36gBEp8OI">Demo</a> é‡Œæ˜¯ç›´æ¥åœ¨ widget çš„ <code>onTap</code> callback é‡Œè°ƒç”¨å¦ä¸€ä¸ª bloc çš„æ–¹æ³•(<code>CartBloc.addition</code>)ï¼Œè¿™æ ·å…¶å®æŠŠä¸šåŠ¡é€»è¾‘ä¹Ÿè€¦åˆåˆ°äº† UI é‡Œé¢ï¼ˆå¦‚æœ CartBloc çš„ addition é€»è¾‘å˜äº†ï¼Œæˆ–è€…åœ¨æ·»åŠ åˆ° Cart çš„åŒæ—¶ï¼Œè¿˜è¦æ›´æ–°ç”¨æˆ·çŠ¶æ€ç­‰ï¼Œå°±éœ€è¦åœ¨è¿™ä¸ª callback é‡Œè°ƒæ•´è¿™äº›é€»è¾‘ï¼‰ï¼Œå› æ­¤æ›´å¥½çš„æ–¹æ³•æ˜¯è‡ªå·±çš„ bloc å¤„ç†å®Œåå‘ä¸ŠæŠ› Notificationï¼Œå¤–å±‚æ¥æ”¶åˆ° Notification åå†å»æ›´æ–°å…¶ä»– Blocã€‚å°±å¥½åƒè¦è¿›è¡Œè·¨éƒ¨é—¨æ²Ÿé€šæ—¶ï¼Œæœ€å¥½è®©å…±åŒçš„ä¸Šçº§çŸ¥é“è¿™ä»¶äº‹ï¼Œæˆ–è€…ç”±ä»–æ¥åè°ƒã€‚</p>
<p>è¿™é‡Œç®€å•è¯´ä¸‹ Flutter é‡Œçš„ Notification æœºåˆ¶ï¼Œå®ƒä¸åƒ iOS é‡Œçš„ <code>NotificationCenter</code> å¯ä»¥å…¨å±€æ¥æ”¶ï¼Œè€Œæ˜¯åªæœ‰åœ¨ widget ä¸Šå±‚è·¯å¾„ä¸­çš„ <code>NotificationListener</code> æ‰èƒ½æ”¶åˆ°é€šçŸ¥ï¼Œè¿™æ ·å¯ä»¥é¿å…é€šçŸ¥æ³›æ»¥çš„æƒ…å†µã€‚è€Œä¸”ä½¿ç”¨æ—¶ï¼Œå¿…é¡»ç»§æ‰¿ç³»ç»Ÿçš„ <code>Notification</code>ï¼Œè¿™æ ·æ¯ä¸€ä¸ªé€šçŸ¥å°±æ˜¯ä¸€ä¸ªç‰¹å®šç±»ï¼Œé˜…è¯»ä»£ç æˆ–æ’æŸ¥èµ·æ¥ä¹Ÿä¼šå¾ˆæ–¹ä¾¿ã€‚</p>
<p>è‡³æ­¤ï¼Œé¦–é¡µçš„ç”µå½±åˆ—è¡¨é¡µåŸºæœ¬å®Œæˆäº†ï¼Œè¯¥è¿›å…¥è¯¦æƒ…é¡µäº†ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€ä»¶äº‹æƒ…è¦åšï¼Œé‚£å°±æ˜¯ Router çš„æ³¨å†Œã€‚</p>
<h3 id="router-zhu-ce">Router æ³¨å†Œ</h3>
<p><code>MaterialApp</code> è‡ªå¸¦äº† Router æ³¨å†Œï¼Œä¹ä¸€çœ‹è¿˜æŒºæ–¹ä¾¿çš„ï¼Œä¸è¿‡æœ‰ä¸€ä¸ªå‘å°±æ˜¯ä¸æ”¯æŒé€šè¿‡ URL ä¼ é€’åŠ¨æ€å‚æ•°ï¼Œæ¯”å¦‚ <code>/movie/1024</code>ï¼Œå¿…é¡»å®Œå…¨åŒ¹é…æ‰å¯ä»¥ã€‚å¦‚æœçœŸè¦å®ç° pattern åŒ¹é…å°±è¦è®¾ç½® <code>onGenerateRoute</code> å‚æ•°ï¼Œå½“é€šè¿‡ Navigator è¿›è¡Œ push æ—¶ï¼Œè¿™ä¸ªå‚æ•°å¯¹åº”çš„æ–¹æ³•å°±ä¼šè¢«è§¦å‘ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢è¿›è¡Œ URL çš„è§£æã€‚</p>
<p>æˆ‘åœ¨è¿™é‡Œå®ç°äº†ä¸ªç®€å•çš„é€šè¿‡ URL æ³¨å†Œ Widget çš„æ–¹æ³•ï¼ŒURL æ”¯æŒ patternï¼Œæ¯”å¦‚ <code>/movie/{id}</code> å°±èƒ½åŒ¹é… <code>/movie/1024</code>ï¼Œä½¿ç”¨æ—¶ï¼Œé€šè¿‡ URL æ¥æ‹¿ widgetï¼Œå†æŠŠè¿™ä¸ª widget push å‡ºå»å³å¯ã€‚</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#8959a8;">class </span><span style="color:#c99e00;">Router</span><span> {
</span><span>  </span><span style="color:#8959a8;">static var</span><span> _routerEntry </span><span style="color:#3e999f;">= </span><span style="color:#c99e00;">_Router</span><span>(name</span><span style="color:#3e999f;">: </span><span style="color:#839c00;">&#39;&#39;</span><span>);
</span><span>
</span><span>  </span><span style="color:#8e908c;">// param should wrap with {}, eg: /movie/{id}
</span><span>  </span><span style="color:#8959a8;">static </span><span style="color:#4271ae;">register</span><span>(</span><span style="color:#c99e00;">String</span><span> pattern, </span><span style="color:#c99e00;">WidgetBuilder</span><span> widgetBuilder) {
</span><span>    </span><span style="color:#8959a8;">final</span><span> patternSections </span><span style="color:#3e999f;">=</span><span> pattern.</span><span style="color:#4271ae;">split</span><span>(</span><span style="color:#839c00;">&#39;/&#39;</span><span>);
</span><span>    </span><span style="color:#8959a8;">var</span><span> routerEntry </span><span style="color:#3e999f;">=</span><span> _routerEntry;
</span><span>    </span><span style="color:#8959a8;">for</span><span> (</span><span style="color:#c99e00;">int</span><span> i </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">0</span><span>; i </span><span style="color:#3e999f;">&lt;</span><span> patternSections.length; i</span><span style="color:#3e999f;">++</span><span>) {
</span><span>      </span><span style="color:#8959a8;">final</span><span> _pattern </span><span style="color:#3e999f;">=</span><span> patternSections[i];
</span><span>      </span><span style="color:#8959a8;">final</span><span> _router </span><span style="color:#3e999f;">= </span><span style="color:#c99e00;">_Router</span><span>(name</span><span style="color:#3e999f;">:</span><span> _pattern);
</span><span>      </span><span style="color:#8959a8;">if</span><span> (i </span><span style="color:#3e999f;">==</span><span> patternSections.length </span><span style="color:#3e999f;">- </span><span style="color:#f07219;">1</span><span>) {
</span><span>        _router.widgetBuilder </span><span style="color:#3e999f;">=</span><span> widgetBuilder;
</span><span>      }
</span><span>      routerEntry.</span><span style="color:#4271ae;">addChild</span><span>(_router);
</span><span>      routerEntry </span><span style="color:#3e999f;">=</span><span> _router;
</span><span>    }
</span><span>  }
</span><span>
</span><span>  </span><span style="color:#8959a8;">static </span><span style="color:#c99e00;">Widget </span><span style="color:#4271ae;">getWidget</span><span>(</span><span style="color:#c99e00;">String</span><span> url, </span><span style="color:#c99e00;">BuildContext</span><span> context, {</span><span style="color:#c99e00;">Map</span><span> params}) {
</span><span>    </span><span style="color:#8959a8;">final</span><span> urlSections </span><span style="color:#3e999f;">=</span><span> url.</span><span style="color:#4271ae;">split</span><span>(</span><span style="color:#839c00;">&#39;/&#39;</span><span>);
</span><span>    </span><span style="color:#8959a8;">var</span><span> routerEntry </span><span style="color:#3e999f;">=</span><span> _routerEntry;
</span><span>    </span><span style="color:#c99e00;">Widget</span><span> widget;
</span><span>    </span><span style="color:#c99e00;">Map</span><span> urlParams </span><span style="color:#3e999f;">=</span><span> {};
</span><span>
</span><span>    </span><span style="color:#8959a8;">for</span><span> (</span><span style="color:#c99e00;">int</span><span> i </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">0</span><span>; i </span><span style="color:#3e999f;">&lt;</span><span> urlSections.length; i</span><span style="color:#3e999f;">++</span><span>) {
</span><span>      </span><span style="color:#8959a8;">final</span><span> _urlSection </span><span style="color:#3e999f;">=</span><span> urlSections[i];
</span><span>      </span><span style="color:#8959a8;">var</span><span> found </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">false</span><span>;
</span><span>      </span><span style="color:#8959a8;">for</span><span> (</span><span style="color:#c99e00;">_Router</span><span> _router </span><span style="color:#8959a8;">in</span><span> routerEntry.children) {
</span><span>        </span><span style="color:#8959a8;">if</span><span> (_router.name </span><span style="color:#3e999f;">==</span><span> _urlSection </span><span style="color:#3e999f;">||</span><span> _router.name.</span><span style="color:#4271ae;">startsWith</span><span>(</span><span style="color:#839c00;">&#39;{&#39;</span><span>)) {
</span><span>          </span><span style="color:#8959a8;">if</span><span> (_router.name.</span><span style="color:#4271ae;">startsWith</span><span>(</span><span style="color:#839c00;">&#39;{&#39;</span><span>)) {
</span><span>            </span><span style="color:#8959a8;">final</span><span> param </span><span style="color:#3e999f;">=</span><span> _router.name.</span><span style="color:#4271ae;">substring</span><span>(</span><span style="color:#f07219;">1</span><span>, _router.name.length </span><span style="color:#3e999f;">- </span><span style="color:#f07219;">1</span><span>);
</span><span>            urlParams[param] </span><span style="color:#3e999f;">=</span><span> _urlSection;
</span><span>          }
</span><span>          found </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">true</span><span>;
</span><span>          routerEntry </span><span style="color:#3e999f;">=</span><span> _router;
</span><span>          </span><span style="color:#8959a8;">if</span><span> (i </span><span style="color:#3e999f;">==</span><span> urlSections.length </span><span style="color:#3e999f;">- </span><span style="color:#f07219;">1</span><span>) {
</span><span>            </span><span style="color:#8959a8;">if</span><span> (_router.widgetBuilder </span><span style="color:#3e999f;">!= </span><span style="color:#f07219;">null</span><span>) {
</span><span>              widget </span><span style="color:#3e999f;">=
</span><span>                  _router.</span><span style="color:#4271ae;">widgetBuilder</span><span>(context, urlParams, params</span><span style="color:#3e999f;">:</span><span> params);
</span><span>            }
</span><span>          }
</span><span>        }
</span><span>      }
</span><span>
</span><span>      </span><span style="color:#8959a8;">if</span><span> (</span><span style="color:#3e999f;">!</span><span>found) {
</span><span>        </span><span style="color:#8959a8;">break</span><span>;
</span><span>      }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#8959a8;">return</span><span> widget;
</span><span>  }
</span><span>}
</span></code></pre>
<p>è·¯ç”±çš„æ³¨å†Œ</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#8959a8;">class </span><span style="color:#c99e00;">Routes</span><span> {
</span><span>  </span><span style="color:#8959a8;">static </span><span style="color:#c99e00;">String</span><span> root </span><span style="color:#3e999f;">= </span><span style="color:#839c00;">&#39;/&#39;</span><span>;
</span><span>  </span><span style="color:#8959a8;">static </span><span style="color:#c99e00;">String</span><span> detail </span><span style="color:#3e999f;">= </span><span style="color:#839c00;">&#39;/movie/{id}&#39;</span><span>;
</span><span>
</span><span>  </span><span style="color:#8959a8;">static </span><span style="color:#4271ae;">configureRoutes</span><span>() {
</span><span>    </span><span style="color:#c99e00;">Router</span><span>.</span><span style="color:#4271ae;">register</span><span>(root, (</span><span style="color:#c99e00;">BuildContext</span><span> context, </span><span style="color:#c99e00;">Map</span><span> urlParams, {</span><span style="color:#c99e00;">Map</span><span> params}) {
</span><span>      </span><span style="color:#8959a8;">return </span><span style="color:#c99e00;">Home</span><span>();
</span><span>    });
</span><span>
</span><span>    </span><span style="color:#c99e00;">Router</span><span>.</span><span style="color:#4271ae;">register</span><span>(detail, (</span><span style="color:#c99e00;">BuildContext</span><span> context, </span><span style="color:#c99e00;">Map</span><span> urlParams,
</span><span>        {</span><span style="color:#c99e00;">Map</span><span> params}) {
</span><span>      </span><span style="color:#8959a8;">return </span><span style="color:#c99e00;">MoviePage</span><span>(
</span><span>        movieID</span><span style="color:#3e999f;">:</span><span> urlParams[</span><span style="color:#839c00;">&#39;id&#39;</span><span>],
</span><span>        movie</span><span style="color:#3e999f;">:
</span><span>            params </span><span style="color:#3e999f;">!= </span><span style="color:#f07219;">null </span><span style="color:#3e999f;">&amp;&amp;</span><span> params[</span><span style="color:#839c00;">&#39;movie&#39;</span><span>] </span><span style="color:#3e999f;">!= </span><span style="color:#f07219;">null </span><span style="color:#3e999f;">?</span><span> params[</span><span style="color:#839c00;">&#39;movie&#39;</span><span>] </span><span style="color:#3e999f;">: </span><span style="color:#f07219;">null</span><span>,
</span><span>      );
</span><span>    });
</span><span>  }
</span><span>}
</span></code></pre>
<h3 id="xiang-qing-ye-bu-ju-xuan-ze">è¯¦æƒ…é¡µ-å¸ƒå±€é€‰æ‹©</h3>
<p>è¯¦æƒ…é¡µä¸»è¦åˆ†ä¸º 4 ä¸ªéƒ¨åˆ†ï¼Œé¡¶éƒ¨çš„æµ·æŠ¥å›¾ï¼Œä¸­é—´çš„æ¦‚è¦ã€æ¨ªå‘å¯æ»šåŠ¨çš„å½±äººåˆ—è¡¨é¡µå’Œ Tab æ ‡ç­¾ï¼Œä»¥åŠæœ€ä¸‹é¢çš„åˆ—è¡¨é¡µã€‚æœ‰ä¸¤ä¸ªæ–¹æ¡ˆå¯ä»¥é€‰ï¼Œ<code>NestedScrollView</code> å’Œ <code>CustomScrollView</code>ï¼Œå‰è€…åˆ†ä¸º header å’Œ body ä¸¤éƒ¨åˆ†ï¼Œå¯ä»¥åœ¨é‡Œé¢å¥— scrollViewï¼Œæœ€å¼€å§‹é€‰æ‹©äº†è¿™ä¸ªæ–¹æ¡ˆï¼Œåæ¥å‘ç° <code>TabbarView</code> æ€ä¹ˆéƒ½å¤„ç†ä¸å¥½ï¼Œå¦‚æœæŠŠå®ƒå•ç‹¬æ”¾åˆ° body é‡Œï¼Œé‚£ä¹ˆæ‰€æœ‰å‰©ä¸‹çš„éƒ¨åˆ†å°±éƒ½è¦æ”¾åˆ° header é‡Œï¼Œè™½ç„¶å¯è¡Œï¼Œä½†è·‘èµ·æ¥ä¼šå‘ç°ï¼Œ<code>TabbarView</code> é‡Œçš„ scroll offset æ˜¯é”™çš„ï¼Œä¸€éƒ¨åˆ†å†…å®¹ä¼šã€Œé’»ã€è¿› Tabbar é‡Œï¼Œè€Œä¸”åº•éƒ¨ç©ºäº†å¾ˆå¤§ä¸€éƒ¨åˆ†ã€‚å¦‚æœæŠŠé™¤äº†æµ·æŠ¥å›¾ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†éƒ½æ”¾åˆ° body é‡Œï¼Œä¹Ÿä¸è¡Œï¼Œè¢«è¿«åªèƒ½é€‰æ‹© <code>CustomScrollView</code>ã€‚</p>
<p><code>CustomScrollView</code> æ–¹æ¡ˆçš„ä¸€ä¸ªéš¾ç‚¹æ˜¯å¤„ç† <code>TabbarView</code>ï¼Œå› ä¸ºä¸èƒ½ç›´æ¥æŠŠå®ƒæ”¾åˆ° <code>slivers</code> é‡Œï¼Œäºæ˜¯æ¢äº†ä¸ªæ€è·¯ï¼ŒæŠ›å¼ƒ <code>TabbarView</code> æ‰‹åŠ¨å®ç° tabbar ç‚¹å‡»ä¹‹åï¼Œä¸‹é¢çš„å†…å®¹åˆ‡æ¢æ•ˆæœã€‚</p>
<p>è¯¦æƒ…é¡µçš„æ ¸å¿ƒä»£ç å¤§æ¦‚åƒè¿™æ ·ï¼š</p>
<pre data-lang="dart" style="background-color:#f9f9f9;color:#111111;" class="language-dart "><code class="language-dart" data-lang="dart"><span style="color:#c99e00;">Widget </span><span style="color:#4271ae;">build</span><span>(</span><span style="color:#c99e00;">BuildContext</span><span> context) {
</span><span>  </span><span style="color:#8959a8;">return </span><span style="color:#c99e00;">Scaffold</span><span>(
</span><span>      backgroundColor</span><span style="color:#3e999f;">: </span><span style="color:#c99e00;">Color</span><span>(</span><span style="color:#f07219;">0xfff4f4f4</span><span>),
</span><span>      body</span><span style="color:#3e999f;">: </span><span style="color:#c99e00;">BlocProvider</span><span>(
</span><span>        bloc</span><span style="color:#3e999f;">:</span><span> bloc,
</span><span>        child</span><span style="color:#3e999f;">:</span><span> (() {
</span><span>          </span><span style="color:#8959a8;">if</span><span> (movie </span><span style="color:#3e999f;">== </span><span style="color:#f07219;">null</span><span>) {
</span><span>            </span><span style="color:#8959a8;">return </span><span style="color:#c99e00;">Center</span><span>(
</span><span>              child</span><span style="color:#3e999f;">: </span><span style="color:#c99e00;">Text</span><span>(</span><span style="color:#839c00;">&#39;loading&#39;</span><span>),
</span><span>            );
</span><span>          } </span><span style="color:#8959a8;">else</span><span> {
</span><span>            </span><span style="color:#8959a8;">return </span><span style="color:#c99e00;">NotificationListener</span><span style="color:#3e999f;">&lt;</span><span style="color:#c99e00;">TabSwitchNotification</span><span style="color:#3e999f;">&gt;</span><span>(
</span><span>              onNotification</span><span style="color:#3e999f;">:</span><span> (notification) {
</span><span>                </span><span style="color:#4271ae;">setState</span><span>(() {
</span><span>                  currentTabType </span><span style="color:#3e999f;">=</span><span> notification.tabContentType;
</span><span>                });
</span><span>              },
</span><span>              child</span><span style="color:#3e999f;">: </span><span style="color:#c99e00;">DefaultTabController</span><span>(
</span><span>                  length</span><span style="color:#3e999f;">: </span><span style="color:#f07219;">2</span><span>,
</span><span>                  child</span><span style="color:#3e999f;">: </span><span style="color:#c99e00;">SafeArea</span><span>(
</span><span>                      top</span><span style="color:#3e999f;">: </span><span style="color:#f07219;">false</span><span>,
</span><span>                      child</span><span style="color:#3e999f;">: </span><span style="color:#c99e00;">CustomScrollView</span><span>(
</span><span>                        slivers</span><span style="color:#3e999f;">: &lt;</span><span style="color:#c99e00;">Widget</span><span style="color:#3e999f;">&gt;</span><span>[
</span><span>                          </span><span style="color:#c99e00;">MovieHero</span><span>(),
</span><span>                          </span><span style="color:#c99e00;">SliverToBoxAdapter</span><span>(
</span><span>                            child</span><span style="color:#3e999f;">: </span><span style="color:#c99e00;">MovieSummary</span><span>(),
</span><span>                          ),
</span><span>                          </span><span style="color:#c99e00;">SliverToBoxAdapter</span><span>(
</span><span>                            child</span><span style="color:#3e999f;">: </span><span style="color:#c99e00;">MovieActors</span><span>(),
</span><span>                          ),
</span><span>                          </span><span style="color:#c99e00;">SliverPadding</span><span>(
</span><span>                            padding</span><span style="color:#3e999f;">: </span><span style="color:#c99e00;">EdgeInsets</span><span>.</span><span style="color:#4271ae;">all</span><span>(</span><span style="color:#f07219;">7.0</span><span>),
</span><span>                          ),
</span><span>                          </span><span style="color:#c99e00;">MovieReviewTabbar</span><span>(),
</span><span>                          </span><span style="color:#c99e00;">MovieReviewTabbarContent</span><span>(
</span><span>                            tabContentType</span><span style="color:#3e999f;">:</span><span> currentTabType,
</span><span>                          ),
</span><span>                        ],
</span><span>                      ))),
</span><span>            );
</span><span>          }
</span><span>        }()),
</span><span>      ));
</span><span>}
</span></code></pre>
<p>å¯¹äº tabbar æ¥è¯´ï¼Œéœ€è¦æä¾›ä¸€ä¸ª controllerï¼Œè¦ä¹ˆé€šè¿‡å±æ€§è®¾ç½®ï¼Œè¦ä¹ˆå¤–é¢åŒ…ä¸€å±‚ï¼Œè¿™é‡Œé€‰æ‹©äº†åè€…ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°æœ€å¤–é¢æ˜¯ <code>DefaultTabController</code>ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨é‡Œé¢é€šè¿‡ <code>DefaultTabController.of(context)</code> æ¥æ‹¿åˆ°è¿™ä¸ª controllerï¼Œè¿›è€Œäº†è§£å½“å‰é€‰ä¸­çš„ tabï¼Œä»¥åŠæ§åˆ¶ tab çš„é€‰ä¸­æƒ…å†µã€‚</p>
<p>æ™®é€šçš„ Widget è¦é€šè¿‡ <code>SliverToBoxAdapter</code> è½¬æ¢æ‰èƒ½è¢«æ”¾åˆ° slivers é‡Œé¢ï¼Œslivers å…¶å®å°±æ˜¯ <code>CustomScrollView</code> çš„ç»„æˆéƒ¨åˆ†ã€‚é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™ä¸ª scrollview æ˜¯ç”±å“ªå‡ éƒ¨åˆ†ç»„æˆçš„ï¼Œéå¸¸æ¸…æ™°ã€‚</p>
<h3 id="xiang-qing-ye-ding-bu-hai-bao-xiao-guo">è¯¦æƒ…é¡µ-é¡¶éƒ¨æµ·æŠ¥æ•ˆæœ</h3>
<p>è¿™ä¸ªæ•ˆæœçœ‹ä¸Šå»æ»¡å¤æ‚çš„ï¼Œå®ç°èµ·æ¥å¾ˆç®€å•ï¼Œåªè¦ä½¿ç”¨ <a href="https://docs.flutter.io/flutter/material/SliverAppBar-class.html">SliverAppBar</a> è¿™ä¸ª Widget å³å¯ã€‚<a href="https://medium.com/@diegoveloper/flutter-collapsing-toolbar-sliver-app-bar-14b858e87abe">è¿™é‡Œ</a> æœ‰æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ã€‚</p>
<h3 id="xiang-qing-ye-ying-pian-jie-shao">è¯¦æƒ…é¡µ-å½±ç‰‡ä»‹ç»</h3>
<p>è¿™é‡Œä¸»è¦æ˜¯ä½¿ç”¨ Text Widgetï¼Œä¸€ä¸ªéš¾ç‚¹æ˜¯é»˜è®¤å†…å®¹æ˜¯æˆªæ–­å’Œæ”¶èµ·çš„ï¼Œå½“ç‚¹å‡»æŒ‰é’®åï¼Œå±•å¼€ã€‚å¦‚æœæ˜¯åœ¨ iOS é‡Œï¼Œéœ€è¦åˆ†åˆ«è®¡ç®—ä¸¤è€…çš„é«˜åº¦ï¼Œç„¶åè°ƒç”¨ <code>reloadRowsAtIndexPaths</code> æ–¹æ³•ï¼Œæœ‰ç‚¹éº»çƒ¦ï¼ŒFlutter é‡Œå¾ˆç®€å•ï¼Œwidget è‡ªå·±æ›´æ–°å†…å®¹å³å¯ï¼Œä¸éœ€è¦è€ƒè™‘é«˜åº¦çš„è®¡ç®—ï¼Œä¹Ÿä¸è¦æ˜¾å¼åœ°è°ƒç”¨ reload æ–¹æ³•ã€‚</p>
<h3 id="xiang-qing-ye-ying-ren-lie-biao">è¯¦æƒ…é¡µ-å½±äººåˆ—è¡¨</h3>
<p>è¿™æ˜¯ä¸€ä¸ªæ¨ªå‘æ»‘åŠ¨åˆ—è¡¨ï¼ŒæŠŠ <code>ListView</code> çš„ <code>scrollDirection</code> è®¾ç½®ä¸º <code>horizontal</code> å³å¯</p>
<h3 id="xiang-qing-ye-tabbar">è¯¦æƒ…é¡µ-Tabbar</h3>
<p>Tabbar éœ€è¦æœ‰ä¸€ä¸ª controllerï¼Œæˆ‘ä»¬åœ¨å¤–é¢åŒ…äº†ä¸€å±‚ <code>DefaultTabController</code>ï¼Œè¿™é‡Œå°±ä¸éœ€è¦æ“å¿ƒäº†ã€‚æ¯”è¾ƒå‘çš„ä¸€ç‚¹æ˜¯ï¼Œ<code>TabBar</code> è¿™ä¸ª Widget æ²¡æœ‰æä¾› <code>onTap</code> æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡ç›‘å¬ controller æ¥è·å– tab çš„å˜åŒ–ï¼Œä¸è¿‡è¿™æ ·ä¹Ÿå¥½ï¼Œç®¡ç†èµ·æ¥æ›´æ–¹ä¾¿ã€‚</p>
<p>PS: è¿™é‡Œçš„ Tabbar æ˜¯éœ€è¦å¸é¡¶çš„ï¼Œå› æ­¤è¦ç”¨ <code>SliverPersistentHeader</code> åŒ…ä¸€ä¸‹ã€‚</p>
<h3 id="xiang-qing-ye-dian-ping-lie-biao">è¯¦æƒ…é¡µ-ç‚¹è¯„åˆ—è¡¨</h3>
<p>ç‚¹è¯„åˆ—è¡¨æ˜¯ä¸€ä¸ª <code>SliverList</code>ï¼Œé…ç½®èµ·æ¥è¿˜ç®—ç®€å•ï¼Œé‚£ä¹ˆç‚¹å‡» tab åˆ‡æ¢å†…å®¹è¿™ä¸ªè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿå¯ä»¥æ€è€ƒä¸‹ã€‚</p>
<h3 id="xiao-jie">å°ç»“</h3>
<p>æˆ‘ä¸ªäººå¾ˆå–œæ¬¢ Flutterï¼Œ ç”¨å®ƒæ¥å†™ GUI æ„Ÿè§‰éå¸¸è‡ªç„¶å’Œèˆ’æœã€‚ä¸éœ€è¦å€ŸåŠ© JSX æˆ– XMLï¼Œç”¨ç¼–ç¨‹è¯­è¨€å°±èƒ½æå®šï¼Œæ–¹ä¾¿ Local Reasoningï¼Œä¸éœ€è¦åœ¨ JSX / XML å’Œ Code ä¹‹é—´æ¥å›åˆ‡æ¢ã€‚åŒæ—¶é€šè¿‡ Widget æ¥é…ç½®è§†å›¾çš„æ–¹å¼ä¹Ÿå¾ˆæ–¹ä¾¿ï¼ŒGUI éå¸¸é€‚åˆè¿™ç§å£°æ˜å¼ç¼–ç¨‹ã€‚</p>
<p>åˆšå¼€å§‹æ¥è§¦ Flutter æ—¶ï¼Œå®¹æ˜“è¢«é‚£ä¸€å¤§å †çš„ç±»ææ™•ï¼Œå…¶å®äº†è§£äº†æ ¸å¿ƒç†å¿µåï¼Œå•ƒé€å‡ ä¸ª Demoï¼Œå°±ä¼šæ…¢æ…¢æ‰¾åˆ°æ„Ÿè§‰ã€‚è‡ªå·±å†å¤šå†™å†™ï¼Œè¸©è¸©å‘ï¼Œå°±ç†Ÿç»ƒäº†ã€‚</p>
<p>è‡³äºæ€§èƒ½æ–¹é¢ï¼Œdebug è·Ÿ release æ¨¡å¼è¿˜æ˜¯ä¼šæœ‰äº›å·®è·ï¼Œå› æ­¤å¦‚æœåœ¨ debug æ¨¡å¼ä¸‹å‘ç°ä¸å¤Ÿæµç•…ï¼Œå¯ä»¥åˆ‡æ¢åˆ° release æ¨¡å¼å†è¯•ä¸‹ã€‚</p>
<p>æˆ‘ä¹Ÿæ˜¯æ¥è§¦ Flutter ä¸ä¹…ï¼Œå¦‚æœæœ‰ä¸å¯¹çš„åœ°æ–¹æ¬¢è¿æŒ‡æ­£ï¼Œå¦‚æœèƒ½ç»™ä½ å¸¦æ¥äº›å¸®åŠ©ï¼Œå¤‡æ„Ÿè£å¹¸ã€‚</p>

  </div>


  <ul class="tags flex flex-wrap justify-center items-center gap-4 mt-5 mb-8 text-lg">
    
    
    <li
      class="px-4 pb-[2px] leading-8 rounded-full border text-gray-700 border-gray-700 hover:text-gray-100 hover:border-gray-900 hover:bg-gray-900 transition-all">
      <a class="inline-block" href="https://limboy.me/tags/programming/">programming</a>
    </li>
    
    <li
      class="px-4 pb-[2px] leading-8 rounded-full border text-gray-700 border-gray-700 hover:text-gray-100 hover:border-gray-900 hover:bg-gray-900 transition-all">
      <a class="inline-block" href="https://limboy.me/tags/flutter/">flutter</a>
    </li>
    
    
  </ul>

  
  <script src="https://giscus.app/client.js" data-repo="limboy/telescope"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzODEwOTA2MTg=" data-category="General"
    data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMzMDY2MTQy" data-mapping="title" data-reactions-enabled="1"
    data-emit-metadata="0" data-theme="light" data-lang="en" crossorigin="anonymous" async>
    </script>
  

  

</div>

      </div>
    </div>
    
    <footer
      class="flex border-t border-gray-300 text-gray-600 bg-gray-50 items-center justify-center h-12 text-sm mt-2">
      <div class="flex inner justify-center gap-4">
        <a class="hover:underline" href="https://github.com/limboy" target="_blank">GitHub</a>
        <a class="hover:underline" href="https://twitter.com/_limboy" target="_blank">Twitter</a>
        <a class="hover:underline" href="https://limboy.me/index.xml">RSS</a>
      </div>
    </footer>
    
  </div>

  
  

  <script>
    // éƒ½æ˜¯ä¸ºäº† iOS...
    document.querySelector("#wrapper").style.minHeight = `calc(${window.innerHeight}px - 6.5rem)`
    window.addEventListener('resize', () => {
      document.querySelector("#wrapper").style.minHeight = `calc(${window.innerHeight}px - 6.5rem)`
    })
  </script>
</body>

</html>