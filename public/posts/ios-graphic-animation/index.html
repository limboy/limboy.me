<!DOCTYPE html>
<html>

<head>
  <meta content="width=device-width,initial-scale=1" name="viewport" />
  <meta charset="UTF-8">
  <link rel="icon" href="https://fav.farm/ğŸ‘»" />
  <title>
ç®€å•è¯´è¯´iOSçš„å›¾å½¢å’ŒåŠ¨ç”»
</title>
  <link rel="stylesheet" href="/assets/main.css?gkCPK9ibGk2PIXzFp9c+CG7gIjpFY2pNyZ+E7aXMGlU=" />
  <script async defer data-domain="limboy.me" src="https://analytics.limboy.me/js/plausible.js"></script>
  
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@_limboy">
<meta name="twitter:site" content="@_limboy">
<meta property="og:url" content="https://limboy.me/posts/ios-graphic-animation/">

<meta name="twitter:title" content="ç®€å•è¯´è¯´iOSçš„å›¾å½¢å’ŒåŠ¨ç”»">
<meta property="og:title" content="ç®€å•è¯´è¯´iOSçš„å›¾å½¢å’ŒåŠ¨ç”»">

<meta property="og:description" content="">
<meta name="twitter:description" content="">



</head>

<body class="  ">
  <nav class="flex justify-center items-center opacity-80 bg-black h-12 py-0 ">
    <div class="inner flex justify-between flex-row mx-1">
      <ul class="color-white flex flex-row justify-start gap-4">
        <li><a class="nav-link opacity-90 text-2xl" href="/">Limboy</a></li>
        <!--<li><a class="nav-link" href="/coodle">Coodle</a></li>-->
      </ul>
      <ul class="color-white flex flex-row gap-4 items-center text-base">
        <!--<li> <a class="nav-link" href="/books" class="decoration-0"> Books </a> </li>-->
        <li> <a class="nav-link" href="/highlights" class="decoration-0"> Highlights </a> </li>
        <li> <a class="nav-link" href="/projects" class="decoration-0"> Projects </a> </li>
        <li> <a class="nav-link" href="/about" class="decoration-0"> About </a> </li>
      </ul>
    </div>
  </nav>

  <div class="flex flex-col">
    <div id="wrapper" class="flex justify-center" style="min-height: calc(100vh - 6.5rem);">
      <div class="inner mb-2">
        
<div class="mt-4 lg:mt-6">
  

  <h1 class="title font-medium text-3xl"><a href="https:&#x2F;&#x2F;limboy.me&#x2F;posts&#x2F;ios-graphic-animation&#x2F;">ç®€å•è¯´è¯´iOSçš„å›¾å½¢å’ŒåŠ¨ç”»</a></h1>
  <div class="flex gap-4 items-center my-1">
    <time class="text-gray-500">2013-06-08</time>

  </div>
  <hr class="border-t-[3px]" />

  <div class="prose lg:prose-xl max-w-full my-6">
    <h3 id="core-graphics">Core Graphics</h3>
<p>Core Graphics æ˜¯ä¸€ç»„ç”¨æ¥ç»˜åˆ¶ 2D å›¾å½¢çš„ APIï¼Œä½¿ç”¨ CPU è¿›è¡Œè®¡ç®—ã€‚ æ–°å»ºä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œæ¨¡æ¿å·²ç»è‡ªåŠ¨è½½å…¥äº† CoreGraphics.framworkã€‚</p>
<h3 id="core-animation">Core Animation</h3>
<p>Core Animation åŒ…å«äº QuartzCore.framwork ä¸­ï¼Œæ˜¯ä¸€ç»„è‡ªç”±åº¦æ›´å¤§çš„å›¾å½¢ç»˜åˆ¶å’ŒåŠ¨ç”» APIï¼Œä½†å®ç°èµ·æ¥ä¹Ÿä¼šæ¯” Core Graphics éº»çƒ¦ä¸€ç‚¹ã€‚iOS ä¸Šçš„ UIKit å’ŒåŠ¨ç”»æ•ˆæœå¤§éƒ¨åˆ†éƒ½æ˜¯é€šè¿‡ Core Animation å®ç°çš„ã€‚</p>
<h3 id="core-image">Core Image</h3>
<p>Core Image æ˜¯ä¸€ç»„ç”¨äºå›¾åƒã€è§†é¢‘å¤„ç†çš„ APIï¼Œå¦‚æ·»åŠ æ»¤é•œä¹‹ç±»çš„ã€‚</p>
<h3 id="opengl-opengl-es">OpenGL / OpenGL ES</h3>
<p>åº•å±‚çš„å›¾å½¢ç»˜åˆ¶ APIï¼Œè‡ªç”±åº¦æœ€å¤§ï¼Œä½†å­¦ä¹ æˆæœ¬ä¹Ÿå¾ˆé«˜ã€‚å¦‚æœä¸æ˜¯åšå¤§å‹æ¸¸æˆï¼Œæ¨èä½¿ç”¨æ›´é«˜å±‚çš„ APIã€‚</p>
<h3 id="ying-jian-jia-su">ç¡¬ä»¶åŠ é€Ÿ</h3>
<p>ç¡¬ä»¶åŠ é€Ÿæ˜¯æŒ‡ç”¨åˆ°äº† GPU çš„ APIï¼Œä»¥ä¸‹è¿™äº›æƒ…å†µä¸ä¼šç”¨åˆ°ç¡¬ä»¶åŠ é€Ÿ</p>
<ul>
<li>æ‰€æœ‰åœ¨ drawRect ä¸­å®Œæˆçš„å›¾å½¢ç»˜åˆ¶ã€‚</li>
<li>shouldRasterize å±æ€§ä¸º YES çš„ CALayerã€‚</li>
<li>ç”¨åˆ°äº† mask æˆ– drop shadow çš„ CALayerã€‚</li>
<li>Text (åŒ…æ‹¬ UILabels, CATextLayers, Core Text, ç­‰ç­‰)ã€‚</li>
<li>ä½¿ç”¨ CGContexts ç»˜åˆ¶çš„å›¾å½¢</li>
</ul>
<h2 id="core-animation-1">Core Animation</h2>
<p>è™½ç„¶æ˜¯ Animationï¼Œä½†å®é™…ä¸Šå®ƒä¹Ÿå¹² Drawing çš„æ´»ï¼Œè¿™å°±éœ€è¦ CALayer çš„å¸®åŠ©ã€‚iOS ä¸­ï¼Œæ‰€æœ‰çš„ UIView éƒ½è‡ªå¸¦äº†ä¸€ä¸ª CALayerï¼ˆå¯ä»¥é€šè¿‡ UIView.layer è®¿é—®ï¼‰ï¼ŒUIView çš„æ¸²æŸ“å’ŒåŠ¨ç”»æœ€ç»ˆä¹Ÿæ˜¯é€šè¿‡ layer æ¥å®ç°çš„ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼ŒUIView å°±æ˜¯ç®€å•çš„ä¸€å±‚å£³ï¼ŒæŠŠå›¾å½¢ç»˜åˆ¶éœ€è¦çš„ä¿¡æ¯ä¼ é€’ç»™ layerã€‚å½“ç„¶ UIView è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½å°±æ˜¯å¤„ç†äº‹ä»¶ï¼Œå¦‚ç‚¹å‡»æŒ‰é’®ï¼Œæ»‘åŠ¨ç­‰ç­‰ã€‚</p>
<p>äº‹å®ä¸Š layer ä¹Ÿæ˜¯ä¸€å±‚å£³(Model Tree)ï¼ŒèƒŒåè¿˜æœ‰å‘ˆç°æ ‘(Presenting Tree)å’Œæ¸²æŸ“æ ‘(Render Tree)ï¼Œæ¸²æŸ“æ ‘å¯¹å‘ˆç°æ ‘çš„æ•°æ®è¿›è¡Œæ¸²æŸ“ã€‚</p>
<p>è·Ÿ view ä¸€æ ·ï¼Œlayer ä¹Ÿå­˜åœ¨ç€ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ã€‚å¯ä»¥ç›´æ¥åˆ›å»ºï¼Œæˆ–é€šè¿‡ view.layer è·å–ã€‚</p>
<p>layer æœ‰å¾ˆå¤šçš„åŠ¨ç”»å±æ€§ï¼Œå¦‚ anchorPoint(view æ²¡æœ‰è¿™ä¸ªå±æ€§)ã€frameã€transform ç­‰ç­‰ï¼Œè¯¦ç»†çš„å±æ€§åˆ—è¡¨<a href="http://developer.apple.com/library/ios/#documentation/Cocoa/Conceptual/CoreAnimation_guide/AnimatableProperties/AnimatableProperties.html#//apple_ref/doc/uid/TP40004514-CH11-SW1">è§æ­¤</a>ã€‚é…åˆ Core Animation çš„ API å¯ä»¥å®ç°å¾ˆå¤š UIView Animation æ— æ³•å®ç°çš„æ•ˆæœï¼Œæ¯”å¦‚ 3D åŠ¨ç”»ã€‚</p>
<h2 id="uiview-animation">UIView Animation</h2>
<p>è¿™ä¸ªæ˜¯æˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°çš„ï¼Œå®ƒå¯¹ Core Animation åšäº†æ›´é«˜å±‚çš„å°è£…ï¼Œæ–¹ä¾¿ä½¿ç”¨ï¼Œå½“ç„¶è‡ªç”±åº¦ä¹Ÿé™ä½äº†ã€‚</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">+ </span><span>(</span><span style="color:#8959a8;">void</span><span>)animateWithDuration</span><span style="color:#3e999f;">:</span><span>(</span><span style="color:#c99e00;">NSTimeInterval</span><span>)duration delay</span><span style="color:#3e999f;">:</span><span>(</span><span style="color:#c99e00;">NSTimeInterval</span><span>)delay options</span><span style="color:#3e999f;">:</span><span>(UIViewAnimationOptions)options animations</span><span style="color:#3e999f;">:</span><span>(</span><span style="color:#8959a8;">void </span><span>(</span><span style="color:#3e999f;">^</span><span>)(</span><span style="color:#8959a8;">void</span><span>))animations completion</span><span style="color:#3e999f;">:</span><span>(</span><span style="color:#8959a8;">void </span><span>(</span><span style="color:#3e999f;">^</span><span>)(</span><span style="color:#8959a8;">BOOL</span><span> finished))completion
</span></code></pre>
<p>animation block é‡Œå¯ä»¥è®¾ç½® view çš„åŠ¨ç”»å±æ€§çš„ç»ˆæ­¢å€¼ï¼Œå¦‚ frame, rotation ç­‰ã€‚options å¯ä»¥è®¾ç½®åŠ¨ç”»çš„ç›¸å…³é€‰é¡¹ï¼Œå¦‚ä¸‹ï¼š</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#8959a8;">enum </span><span>{
</span><span>    UIViewAnimationOptionLayoutSubviews            </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">1 </span><span style="color:#3e999f;">&lt;&lt;  </span><span style="color:#f07219;">0</span><span>,
</span><span>    UIViewAnimationOptionAllowUserInteraction      </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">1 </span><span style="color:#3e999f;">&lt;&lt;  </span><span style="color:#f07219;">1</span><span>,
</span><span>    UIViewAnimationOptionBeginFromCurrentState     </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">1 </span><span style="color:#3e999f;">&lt;&lt;  </span><span style="color:#f07219;">2</span><span>,
</span><span>    UIViewAnimationOptionRepeat                    </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">1 </span><span style="color:#3e999f;">&lt;&lt;  </span><span style="color:#f07219;">3</span><span>,
</span><span>    UIViewAnimationOptionAutoreverse               </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">1 </span><span style="color:#3e999f;">&lt;&lt;  </span><span style="color:#f07219;">4</span><span>,
</span><span>    UIViewAnimationOptionOverrideInheritedDuration </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">1 </span><span style="color:#3e999f;">&lt;&lt;  </span><span style="color:#f07219;">5</span><span>,
</span><span>    UIViewAnimationOptionOverrideInheritedCurve    </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">1 </span><span style="color:#3e999f;">&lt;&lt;  </span><span style="color:#f07219;">6</span><span>,
</span><span>    UIViewAnimationOptionAllowAnimatedContent      </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">1 </span><span style="color:#3e999f;">&lt;&lt;  </span><span style="color:#f07219;">7</span><span>,
</span><span>    UIViewAnimationOptionShowHideTransitionViews   </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">1 </span><span style="color:#3e999f;">&lt;&lt;  </span><span style="color:#f07219;">8</span><span>,
</span><span>
</span><span>    UIViewAnimationOptionCurveEaseInOut            </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">0 </span><span style="color:#3e999f;">&lt;&lt; </span><span style="color:#f07219;">16</span><span>,
</span><span>    UIViewAnimationOptionCurveEaseIn               </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">1 </span><span style="color:#3e999f;">&lt;&lt; </span><span style="color:#f07219;">16</span><span>,
</span><span>    UIViewAnimationOptionCurveEaseOut              </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">2 </span><span style="color:#3e999f;">&lt;&lt; </span><span style="color:#f07219;">16</span><span>,
</span><span>    UIViewAnimationOptionCurveLinear               </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">3 </span><span style="color:#3e999f;">&lt;&lt; </span><span style="color:#f07219;">16</span><span>,
</span><span>
</span><span>    UIViewAnimationOptionTransitionNone            </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">0 </span><span style="color:#3e999f;">&lt;&lt; </span><span style="color:#f07219;">20</span><span>,
</span><span>    UIViewAnimationOptionTransitionFlipFromLeft    </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">1 </span><span style="color:#3e999f;">&lt;&lt; </span><span style="color:#f07219;">20</span><span>,
</span><span>    UIViewAnimationOptionTransitionFlipFromRight   </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">2 </span><span style="color:#3e999f;">&lt;&lt; </span><span style="color:#f07219;">20</span><span>,
</span><span>    UIViewAnimationOptionTransitionCurlUp          </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">3 </span><span style="color:#3e999f;">&lt;&lt; </span><span style="color:#f07219;">20</span><span>,
</span><span>    UIViewAnimationOptionTransitionCurlDown        </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">4 </span><span style="color:#3e999f;">&lt;&lt; </span><span style="color:#f07219;">20</span><span>,
</span><span>    UIViewAnimationOptionTransitionCrossDissolve   </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">5 </span><span style="color:#3e999f;">&lt;&lt; </span><span style="color:#f07219;">20</span><span>,
</span><span>    UIViewAnimationOptionTransitionFlipFromTop     </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">6 </span><span style="color:#3e999f;">&lt;&lt; </span><span style="color:#f07219;">20</span><span>,
</span><span>    UIViewAnimationOptionTransitionFlipFromBottom  </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">7 </span><span style="color:#3e999f;">&lt;&lt; </span><span style="color:#f07219;">20</span><span>,
</span><span>};
</span><span style="color:#8959a8;">typedef </span><span style="color:#c99e00;">NSUInteger </span><span>UIViewAnimationOptions;
</span></code></pre>
<p>æ‰€ä»¥ä¸€èˆ¬çš„åŠ¨ç”» view animation éƒ½å¯ä»¥åº”ä»˜ã€‚</p>
<h2 id="tableview-you-hua">TableView ä¼˜åŒ–</h2>
<p>TableView æ˜¯ iOS ä¸­éå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œå¦‚æœå¤„ç†ä¸å½“ï¼Œå°±å¾ˆå®¹æ˜“å‡ºç°ä¸æµç•…çš„ç°è±¡ã€‚æ¯”å¦‚ä¸€ä¸ª TableViewCell ä¸­æœ‰å¤šä¸ª subviewã€‚ä¸Šé¢è¯´è¿‡ä¸€ä¸ª view å¯¹åº”äº†ä¸€ä¸ª layerï¼Œå¤šä¸ª view è‡ªç„¶ä¹Ÿå°±å¯¹åº”å¤šä¸ª layerï¼Œå¥½æ¯” photoshop çš„å›¾å±‚ã€‚æ»‘åŠ¨æ—¶ GPU éœ€è¦åˆ†åˆ«å¯¹æ¯ä¸€ä¸ª layer è¿›è¡Œå¤„ç†ï¼Œå¦‚æœä¸èƒ½åœ¨çŸ­æ—¶é—´å†…å®Œæˆï¼Œå°±å®¹æ˜“æ‰å¸§ã€‚</p>
<p>è¦ä¿è¯ TableView çš„æµç•…ï¼Œé¦–å…ˆ TableViewCell çš„ç”Ÿæˆæ—¶é—´è¦çŸ­ï¼ˆå°‘äº 1/60 ç§’ï¼‰ï¼Œå…¶æ¬¡ç§»åŠ¨æ—¶å¸§é¢‘å°½é‡ä¿æŒåœ¨ 60ï¼ˆä¹Ÿå°±æ˜¯æ¯ç§’ 60 å¸§ï¼‰ã€‚å‰è€…å–å†³äº CPUï¼Œåè€…å–å†³äº GPUã€‚</p>
<p>ä»¥ twitter ä¸ºä¾‹ï¼Œå¯ä»¥é€šè¿‡ subviews æ¥å®ç°ï¼Œä¸è¿‡æ€§èƒ½ä¼šæœ‰ç‚¹å½±å“ï¼Œä½†å®ç°èµ·æ¥ç®€å•ã€‚</p>

<p  style="text-align:center" ><img src="&#x2F;posts&#x2F;ios-graphic-animation&#x2F;twitter_tvc_subviews.jpg"
        width="400" /></p>
<p>å› ä¸º cell åœ¨å½¢æ€ä¸Šä¸ä¼šç»å¸¸æ”¹å˜ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥é€šè¿‡ drawRect ç›´æ¥ç»˜åˆ¶ï¼Œåªè¦è¿™ä¸ªæ—¶é—´è¶³å¤ŸçŸ­å°±å¯ä»¥ã€‚å¥½å¤„æ˜¯ layer ä¸ç”¨å¤„ç†å¤šä¸ªå­ layer çš„ç»„åˆå’Œå åŠ ï¼Œå°±åƒä¸€å¼  jpg å›¾ç‰‡ä¸€æ ·ï¼Œæ»‘åŠ¨ä¼šæ›´æµç•…ã€‚</p>

<p  style="text-align:center" ><img src="&#x2F;posts&#x2F;ios-graphic-animation&#x2F;twitter_tvc_drawrect.png"
        width="400" /></p><h3 id="can-kao">å‚è€ƒ</h3>
<ul>
<li><a href="http://geeklu.com/2012/09/animation-in-ios/">http://geeklu.com/2012/09/animation-in-ios/</a></li>
<li><a href="http://robots.thoughtbot.com/post/33427366406/designing-for-ios-taming-uibutton">http://robots.thoughtbot.com/post/33427366406/designing-for-ios-taming-uibutton</a></li>
<li><a href="https://news.ycombinator.com/item?id=4645585">https://news.ycombinator.com/item?id=4645585</a></li>
<li><a href="http://stackoverflow.com/q/6731545/94962">http://stackoverflow.com/q/6731545/94962</a></li>
<li><a href="http://giorgiocalderolla.com/blog.html#customizing-uitableviewcells-a-better-way">http://giorgiocalderolla.com/blog.html#customizing-uitableviewcells-a-better-way</a></li>
<li><a href="https://blog.twitter.com/2012/simple-strategies-smooth-animation-iphone">https://blog.twitter.com/2012/simple-strategies-smooth-animation-iphone</a></li>
<li><a href="http://floriankugler.com/blog/2013/5/24/layer-trees-vs-flat-drawing-graphics-performance-across-ios-device-generations">layer trees vs flat drawing graphics performance across ios device generations</a></li>
</ul>

  </div>


  <ul class="tags flex flex-wrap justify-center items-center gap-4 mt-5 mb-8 text-lg">
    
    
    <li
      class="px-4 pb-[2px] leading-8 rounded-full border text-gray-700 border-gray-700 hover:text-gray-100 hover:border-gray-900 hover:bg-gray-900 transition-all">
      <a class="inline-block" href="https://limboy.me/tags/programming/">programming</a>
    </li>
    
    <li
      class="px-4 pb-[2px] leading-8 rounded-full border text-gray-700 border-gray-700 hover:text-gray-100 hover:border-gray-900 hover:bg-gray-900 transition-all">
      <a class="inline-block" href="https://limboy.me/tags/ios/">iOS</a>
    </li>
    
    
  </ul>

  
  <script src="https://giscus.app/client.js" data-repo="limboy/telescope"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzODEwOTA2MTg=" data-category="General"
    data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMzMDY2MTQy" data-mapping="title" data-reactions-enabled="1"
    data-emit-metadata="0" data-theme="light" data-lang="en" crossorigin="anonymous" async>
    </script>
  

  

</div>

      </div>
    </div>
    
    <footer
      class="flex border-t border-gray-300 text-gray-600 bg-gray-50 items-center justify-center h-12 text-sm mt-2">
      <div class="flex inner justify-center gap-4">
        <a class="hover:underline" href="https://github.com/limboy" target="_blank">GitHub</a>
        <a class="hover:underline" href="https://twitter.com/_limboy" target="_blank">Twitter</a>
        <a class="hover:underline" href="https://limboy.me/index.xml">RSS</a>
      </div>
    </footer>
    
  </div>

  
  

  <script>
    // éƒ½æ˜¯ä¸ºäº† iOS...
    document.querySelector("#wrapper").style.minHeight = `calc(${window.innerHeight}px - 6.5rem)`
    window.addEventListener('resize', () => {
      document.querySelector("#wrapper").style.minHeight = `calc(${window.innerHeight}px - 6.5rem)`
    })
  </script>
</body>

</html>