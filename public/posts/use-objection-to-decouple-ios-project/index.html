<!DOCTYPE html>
<html>

<head>
  <meta content="width=device-width,initial-scale=1" name="viewport" />
  <meta charset="UTF-8">
  <link rel="icon" href="https://fav.farm/ğŸ‘»" />
  <title>
ä½¿ç”¨objectionæ¥æ¨¡å—åŒ–å¼€å‘iOSé¡¹ç›®
</title>
  <link rel="stylesheet" href="/assets/main.css?6&#x2F;2ShUT3RYeReiJdlrDhZN+03rWSUD7DPccwza9UdPM=" />
  <script async defer data-domain="limboy.me" src="https://analytics.limboy.me/js/plausible.js"></script>
  
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@_limboy">
<meta name="twitter:site" content="@_limboy">
<meta property="og:url" content="https://limboy.me/posts/use-objection-to-decouple-ios-project/">

<meta name="twitter:title" content="ä½¿ç”¨objectionæ¥æ¨¡å—åŒ–å¼€å‘iOSé¡¹ç›®">
<meta property="og:title" content="ä½¿ç”¨objectionæ¥æ¨¡å—åŒ–å¼€å‘iOSé¡¹ç›®">

<meta property="og:description" content="">
<meta name="twitter:description" content="">



</head>

<body class="  ">
  <nav class="flex justify-center items-center opacity-80 bg-black h-12 py-0 ">
    <div class="inner flex justify-between flex-row mx-1">
      <ul class="color-white flex flex-row justify-start gap-4">
        <li><a class="nav-link opacity-90 text-2xl" href="/">Limboy</a></li>
        <!--<li><a class="nav-link" href="/coodle">Coodle</a></li>-->
      </ul>
      <ul class="color-white flex flex-row gap-4 items-center text-base">
        <!--<li> <a class="nav-link" href="/books" class="decoration-0"> Books </a> </li>-->
        <li> <a class="nav-link" href="/highlights" class="decoration-0"> Highlights </a> </li>
        <li> <a class="nav-link" href="/projects" class="decoration-0"> Projects </a> </li>
        <li> <a class="nav-link" href="/about" class="decoration-0"> About </a> </li>
      </ul>
    </div>
  </nav>

  <div class="flex flex-col">
    <div id="wrapper" class="flex justify-center" style="min-height: calc(100vh - 6.5rem);">
      <div class="inner mb-2">
        
<div class="mt-4 lg:mt-6">
  

  <h1 class="title font-medium text-3xl"><a href="https:&#x2F;&#x2F;limboy.me&#x2F;posts&#x2F;use-objection-to-decouple-ios-project&#x2F;">ä½¿ç”¨objectionæ¥æ¨¡å—åŒ–å¼€å‘iOSé¡¹ç›®</a></h1>
  <div class="flex gap-4 items-center my-1">
    <time class="text-gray-500">2014-04-15</time>

  </div>
  <hr class="border-t-[3px]" />

  <div class="prose lg:prose-xl max-w-full my-6">
    <p><a href="https://github.com/atomicobject/objection">objection</a> æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå—<a href="https://code.google.com/p/google-guice/">Guice</a>çš„å¯å‘ï¼Œ<a href="http://www.google.com/wallet/">Google Wallet</a> ä¹Ÿæ˜¯ä½¿ç”¨çš„è¯¥é¡¹ç›®ã€‚ã€Œä¾èµ–æ³¨å…¥ã€æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç”¨æ¥å‡å°‘ä»£ç ä¹‹é—´çš„è€¦åˆåº¦ã€‚é€šå¸¸åŸºäºæ¥å£æ¥å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸éœ€è¦ new ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ç›¸å…³çš„æ§åˆ¶å™¨æ¥è·å–å¯¹è±¡ã€‚2013 å¹´æœ€ç«çš„ PHP æ¡†æ¶ <a href="http://laravel.com">laravel</a> å°±æ˜¯å…¶ä¸­çš„å…¸å‹ã€‚</p>
<p>å‡è®¾æœ‰ä»¥ä¸‹åœºæ™¯ï¼šViewControllerA.view é‡Œæœ‰ä¸€ä¸ª buttonï¼Œç‚¹å‡»ä¹‹å push ä¸€ä¸ª ViewControllerBï¼Œæœ€ç®€å•çš„å†™æ³•ç±»ä¼¼è¿™æ ·ï¼š</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">- </span><span>(</span><span style="color:#8959a8;">void</span><span>)viewDidLoad
</span><span>{
</span><span>    [</span><span style="color:#c82728;">super </span><span style="color:#4271ae;">viewDidLoad</span><span>];
</span><span>    UIButton </span><span style="color:#3e999f;">*</span><span>button </span><span style="color:#3e999f;">= </span><span>[UIButton </span><span style="color:#4271ae;">buttonWithType:UIButtonTypeSystem</span><span>];
</span><span>    button.</span><span style="color:#c82728;">frame </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">CGRectMake</span><span style="color:#4271ae;">(</span><span style="color:#f07219;">100</span><span style="color:#4271ae;">, </span><span style="color:#f07219;">100</span><span style="color:#4271ae;">, </span><span style="color:#f07219;">100</span><span style="color:#4271ae;">, </span><span style="color:#f07219;">30</span><span style="color:#4271ae;">)</span><span>;
</span><span>    [button </span><span style="color:#4271ae;">setTitle:</span><span style="color:#839c00;">@&quot;Button&quot; </span><span style="color:#4271ae;">forState:UIControlStateNormal</span><span>];
</span><span>    [button </span><span style="color:#4271ae;">addTarget:</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">action:</span><span style="color:#8959a8;">@selector</span><span style="color:#4271ae;">(buttonTapped) forControlEvents:UIControlEventTouchUpInside</span><span>];
</span><span>    [</span><span style="color:#c82728;">self</span><span>.</span><span style="color:#c82728;">view</span><span> addSubview</span><span style="color:#3e999f;">:</span><span>button];
</span><span>}
</span><span>
</span><span style="color:#3e999f;">- </span><span>(</span><span style="color:#8959a8;">void</span><span>)buttonTapped
</span><span>{
</span><span>	ViewControllerB </span><span style="color:#3e999f;">*</span><span>vc </span><span style="color:#3e999f;">= </span><span>[[ViewControllerB </span><span style="color:#4271ae;">alloc</span><span>] init];
</span><span>    [</span><span style="color:#c82728;">self</span><span>.</span><span style="color:#c82728;">navigationController</span><span> pushViewController</span><span style="color:#3e999f;">:</span><span>vc animated</span><span style="color:#3e999f;">:</span><span style="color:#f07219;">YES</span><span>];
</span><span>}
</span></code></pre>
<p>è¿™æ ·å†™çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼ŒViewControllerA éœ€è¦ import ViewControllerBï¼Œä¹Ÿå°±æ˜¯å¯¹ ViewControllerB äº§ç”Ÿäº†ä¾èµ–ã€‚ä¾èµ–çš„ä¸œè¥¿è¶Šå¤šï¼Œç»´æŠ¤èµ·æ¥å°±è¶Šéº»çƒ¦ï¼Œä¹Ÿå®¹æ˜“å‡ºç°å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼Œè€Œ objection æ­£å¥½å¯ä»¥å¤„ç†è¿™äº›é—®é¢˜ã€‚</p>
<p>å®ç°æ–¹æ³•æ˜¯ï¼šå…ˆå®šä¹‰ä¸€ä¸ªåè®®(protocol)ï¼Œç„¶åé€šè¿‡ objection æ¥æ³¨å†Œè¿™ä¸ªåè®®å¯¹åº”çš„ classï¼Œéœ€è¦çš„æ—¶å€™ï¼Œå¯ä»¥è·å–è¯¥åè®®å¯¹åº”çš„ objectã€‚å¯¹äºä½¿ç”¨æ–¹æ— éœ€å…³å¿ƒåˆ°åº•ä½¿ç”¨çš„æ˜¯å“ªä¸ª Classï¼Œåæ­£è¯¥æœ‰çš„æ–¹æ³•ã€å±æ€§éƒ½æœ‰äº†(åœ¨åè®®ä¸­æŒ‡å®š)ã€‚è¿™æ ·å°±å»é™¤äº†å¯¹æŸä¸ªç‰¹å®š Class çš„ä¾èµ–ã€‚ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ã€Œé¢å‘æ¥å£ç¼–ç¨‹ã€ã€‚</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span>JSObjectionInjector </span><span style="color:#3e999f;">*</span><span>injector </span><span style="color:#3e999f;">= </span><span>[JSObjection </span><span style="color:#4271ae;">defaultInjector</span><span>]; </span><span style="color:#8e908c;">// [1]
</span><span>UIViewController </span><span style="color:#3e999f;">&lt;</span><span>ViewControllerAProtocol</span><span style="color:#3e999f;">&gt; *</span><span>vc </span><span style="color:#3e999f;">= </span><span>[injector </span><span style="color:#4271ae;">getObject:</span><span style="color:#8959a8;">@protocol</span><span style="color:#4271ae;">(ViewControllerAProtocol)</span><span>]; </span><span style="color:#8e908c;">// [2]
</span><span>vc.</span><span style="color:#c82728;">backgroundColor </span><span style="color:#3e999f;">= </span><span>[UIColor </span><span style="color:#4271ae;">lightGrayColor</span><span>]; </span><span style="color:#8e908c;">// [3]
</span><span>UINavigationController </span><span style="color:#3e999f;">*</span><span>nc </span><span style="color:#3e999f;">= </span><span>[[UINavigationController </span><span style="color:#4271ae;">alloc</span><span>] initWithRootViewController</span><span style="color:#3e999f;">:</span><span>vc];
</span><span style="color:#c82728;">self</span><span>.</span><span style="color:#c82728;">window</span><span>.</span><span style="color:#c82728;">rootViewController </span><span style="color:#3e999f;">=</span><span> nc;
</span></code></pre>
<ul>
<li>[1] è·å–é»˜è®¤çš„ injectorï¼Œè¿™ä¸ª injector å·²ç»æ³¨å†Œè¿‡<code>ViewControllerAProtocol</code>äº†ã€‚</li>
<li>[2] è·å–<code>ViewControllerAProtocol</code>å¯¹åº”çš„ Objectã€‚</li>
<li>[3] æ‹¿åˆ° VC åï¼Œè®¾ç½®å®ƒçš„æŸäº›å±æ€§ï¼Œæ¯”å¦‚è¿™é‡Œçš„ backgroundColorï¼Œå› ä¸ºåœ¨<code>ViewControllerAProtocol</code>é‡Œæœ‰å®šä¹‰è¿™ä¸ªå±æ€§ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ warningã€‚</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ²¡æœ‰å¼•ç”¨ ViewControllerAã€‚å†æ¥çœ‹çœ‹è¿™ä¸ª<code>ViewControllerAProtocol</code>æ˜¯å¦‚ä½•æ³¨å†Œåˆ° injector ä¸­çš„ï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº†<code>Module</code>ï¼Œå¯¹ Protocol çš„æ³¨å†Œéƒ½æ˜¯åœ¨ Module ä¸­å®Œæˆçš„ã€‚Module åªè¦ç»§æ‰¿<code>JSObjectionModule</code>è¿™ä¸ª Class å³å¯ã€‚</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#8959a8;">@interface </span><span>ViewControllerAModule : </span><span style="color:#839c00;">JSObjectionModule
</span><span style="color:#8959a8;">@end
</span><span>
</span><span style="color:#8959a8;">@implementation </span><span>ViewControllerAModule
</span><span>- (</span><span style="color:#8959a8;">void</span><span>)</span><span style="color:#4271ae;">configure
</span><span>{
</span><span>    [</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">bindClass:[ViewControllerA class] toProtocol:</span><span style="color:#8959a8;">@protocol</span><span style="color:#4271ae;">(ViewControllerAProtocol)</span><span>];
</span><span>}
</span><span style="color:#8959a8;">@end
</span></code></pre>
<p>ç»‘å®šæ“ä½œæ˜¯åœ¨<code>configure</code>æ–¹æ³•é‡Œè¿›è¡Œçš„ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨è¢«æ·»åŠ åˆ° injector é‡Œæ—¶ä¼šè¢«è‡ªåŠ¨è§¦å‘ã€‚</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span>JSObjectionInjector </span><span style="color:#3e999f;">*</span><span>injector </span><span style="color:#3e999f;">= </span><span>[JSObjection </span><span style="color:#4271ae;">defaultInjector</span><span>]; </span><span style="color:#8e908c;">// [1]
</span><span>injector </span><span style="color:#3e999f;">=</span><span> injector </span><span style="color:#3e999f;">? : </span><span>[JSObjection </span><span style="color:#4271ae;">createInjector</span><span>]; </span><span style="color:#8e908c;">// [2]
</span><span>injector </span><span style="color:#3e999f;">= </span><span>[injector </span><span style="color:#4271ae;">withModule:[[ViewControllerAModule alloc] init]</span><span>]; </span><span style="color:#8e908c;">// [3]
</span><span>[JSObjection </span><span style="color:#4271ae;">setDefaultInjector:injector</span><span>]; </span><span style="color:#8e908c;">// [4]
</span></code></pre>
<ul>
<li>[1] è·å–é»˜è®¤çš„ injector</li>
<li>[2] å¦‚æœé»˜è®¤çš„ injector ä¸å­˜åœ¨ï¼Œå°±æ–°å»ºä¸€ä¸ª</li>
<li>[3] å¾€è¿™ä¸ª injector é‡Œæ³¨å†Œæˆ‘ä»¬çš„ Module</li>
<li>[4] è®¾ç½®è¯¥ injector ä¸ºé»˜è®¤çš„ injector</li>
</ul>
<p>è¿™æ®µä»£ç å¯ä»¥ç›´æ¥æ”¾åˆ° <code>+ (void)load</code>é‡Œæ‰§è¡Œï¼Œè¿™æ ·å°±å¯ä»¥é¿å…åœ¨ AppDelegate é‡Œ import å„ç§ Moduleã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬æ— æ³•ç›´æ¥è·å¾—å¯¹åº”çš„ Classï¼Œæ‰€ä»¥å¿…é¡»è¦åœ¨åè®®é‡Œå®šä¹‰å¥½å¯¹å¤–æš´éœ²çš„æ–¹æ³•å’Œå±æ€§ï¼Œç„¶åè¯¥ Class ä¹Ÿè¦å®ç°è¯¥åè®®ã€‚</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#8959a8;">@protocol </span><span>ViewControllerAProtocol &lt;NSObject&gt;
</span><span style="color:#8959a8;">@property </span><span>(</span><span style="color:#8959a8;">nonatomic</span><span>) </span><span style="color:#c99e00;">NSUInteger</span><span> currentIndex;
</span><span style="color:#8959a8;">@property </span><span>(</span><span style="color:#8959a8;">nonatomic</span><span>) UIColor </span><span style="color:#3e999f;">*</span><span>backgroundColor;
</span><span style="color:#8959a8;">@end
</span><span>
</span><span style="color:#8959a8;">@interface </span><span>ViewControllerA : </span><span style="color:#839c00;">UIViewController </span><span>&lt;ViewControllerAProtocol&gt;
</span><span style="color:#8959a8;">@end
</span></code></pre>
<p>é€šè¿‡ objection å®ç°ä¾èµ–æ³¨å…¥åï¼Œå°±èƒ½æ›´å¥½åœ°å®ç° SRP(Single Responsibility Principle)ï¼Œä»£ç æ›´ç®€æ´ï¼Œå¿ƒæƒ…æ›´èˆ’ç•…ï¼Œç”Ÿæ´»æ›´ç¾å¥½ã€‚æ‹¿ Pinterest æ¥è¯´ï¼Œä¸‹é¢çš„é¡µé¢å°±å¯ä»¥åˆ’åˆ†ä¸º 3 ä¸ª Sectionã€‚</p>

<p  style="text-align:center" ><img src="&#x2F;posts&#x2F;use-objection-to-decouple-ios-project&#x2F;demo_4_objection.png"
        width="320" /></p>
<p>å„ä¸ª Section å¯ä»¥ç”±ä¸åŒçš„äººè´Ÿè´£ï¼Œç„¶åä¸²åˆ°ä¸€èµ·å°±è¡Œï¼Œä¹Ÿèƒ½ä¸€å®šç¨‹åº¦åœ°é¿å… MVC(Mess View Controller)çš„å‡ºç°ã€‚</p>
<p>æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ª lib è¿˜æ˜¯æŒºé è°±çš„ï¼Œå·²ç»ç»´æŠ¤äº†ä¸¤å¹´å¤šï¼Œä¹Ÿæœ‰ä¸€äº›é¡¹ç›®åœ¨ç”¨ï¼Œå¯¹äºæé«˜å¼€å‘æˆå‘˜çš„æ•ˆç‡ä¹Ÿä¼šæœ‰ä¸å°‘çš„å¸®åŠ©ï¼Œå¯ä»¥è€ƒè™‘å°è¯•ä¸‹ã€‚</p>
<p>---- update (2014-04-30) ----</p>
<p>å†™äº†ä¸ªå£çº¸çš„ demoï¼Œ<a href="https://github.com/limboy/bizhi">https://github.com/limboy/bizhi</a></p>

  </div>


  <ul class="tags flex flex-wrap justify-center items-center gap-4 mt-5 mb-8 text-lg">
    
    
    <li
      class="px-4 pb-[2px] leading-8 rounded-full border text-gray-700 border-gray-700 hover:text-gray-100 hover:border-gray-900 hover:bg-gray-900 transition-all">
      <a class="inline-block" href="https://limboy.me/tags/programming/">programming</a>
    </li>
    
    <li
      class="px-4 pb-[2px] leading-8 rounded-full border text-gray-700 border-gray-700 hover:text-gray-100 hover:border-gray-900 hover:bg-gray-900 transition-all">
      <a class="inline-block" href="https://limboy.me/tags/ios/">iOS</a>
    </li>
    
    
  </ul>

  
  <script src="https://giscus.app/client.js" data-repo="limboy/telescope"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzODEwOTA2MTg=" data-category="General"
    data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMzMDY2MTQy" data-mapping="title" data-reactions-enabled="1"
    data-emit-metadata="0" data-theme="light" data-lang="en" crossorigin="anonymous" async>
    </script>
  

  

</div>

      </div>
    </div>
    
    <footer
      class="flex border-t border-gray-300 text-gray-600 bg-gray-50 items-center justify-center h-12 text-sm mt-2">
      <div class="flex inner justify-center gap-4">
        <a class="hover:underline" href="https://github.com/limboy" target="_blank">GitHub</a>
        <a class="hover:underline" href="https://twitter.com/_limboy" target="_blank">Twitter</a>
        <a class="hover:underline" href="https://limboy.me/index.xml">RSS</a>
      </div>
    </footer>
    
  </div>

  
  

  <script>
    // éƒ½æ˜¯ä¸ºäº† iOS...
    document.querySelector("#wrapper").style.minHeight = `calc(${window.innerHeight}px - 6.5rem)`
    window.addEventListener('resize', () => {
      document.querySelector("#wrapper").style.minHeight = `calc(${window.innerHeight}px - 6.5rem)`
    })
  </script>
</body>

</html>