<!DOCTYPE html>
<html>

<head>
  <meta content="width=device-width,initial-scale=1" name="viewport" />
  <meta charset="UTF-8">
  <link rel="icon" href="https://fav.farm/ğŸ‘»" />
  <title>
é˜…è¯»æºç çš„ä¹è¶£
</title>
  <link rel="stylesheet" href="/assets/main.css?9zs&#x2F;BXhW+t7PNacyPraNbWdNoN&#x2F;V7G9VhdTj5z3mo8A=" />
  <script async defer data-domain="limboy.me" src="https://analytics.limboy.me/js/plausible.js"></script>
  
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@_limboy">
<meta name="twitter:site" content="@_limboy">
<meta property="og:url" content="https://limboy.me/posts/the-pleasure-of-reading-source/">

<meta name="twitter:title" content="é˜…è¯»æºç çš„ä¹è¶£">
<meta property="og:title" content="é˜…è¯»æºç çš„ä¹è¶£">

<meta property="og:description" content="">
<meta name="twitter:description" content="">



</head>

<body class="  ">
  <nav class="flex justify-center items-center bg-zinc-700 h-12 py-0 ">
    <div class="inner flex justify-between flex-row mx-1">
      <ul class="color-white flex flex-row justify-start gap-4">
        <li><a class="nav-link opacity-90 text-2xl" href="/">Limboy</a></li>
        <!--<li><a class="nav-link" href="/coodle">Coodle</a></li>-->
      </ul>
      <ul class="color-white flex flex-row gap-4 items-center text-base">
        <!--<li> <a class="nav-link" href="/books" class="decoration-0"> Books </a> </li>-->
        <li> <a class="nav-link" href="/highlights" class="decoration-0"> Highlights </a> </li>
        <li> <a class="nav-link" href="/projects" class="decoration-0"> Projects </a> </li>
        <li> <a class="nav-link" href="/about" class="decoration-0"> About </a> </li>
      </ul>
    </div>
  </nav>

  <div class="flex flex-col">
    <div id="wrapper" class="flex justify-center" style="min-height: calc(100vh - 6.5rem);">
      <div class="inner mb-2">
        
<div class="mt-4 lg:mt-6">
  

  <h1 class="title font-medium text-3xl"><a href="https:&#x2F;&#x2F;limboy.me&#x2F;posts&#x2F;the-pleasure-of-reading-source&#x2F;">é˜…è¯»æºç çš„ä¹è¶£</a></h1>
  <div class="flex gap-4 items-center my-1">
    <time class="text-gray-500">2014-12-17</time>

  </div>
  <hr class="border-t-[3px]" />

  <div class="prose lg:prose-xl max-w-full my-6">
    <p>é˜…è¯»æºç å°¤å…¶æ˜¯ä¼˜ç§€çš„æºç æ˜¯ä¸€ä»¶å¾ˆæœ‰ä¹è¶£çš„äº‹æƒ…ï¼Œå¯ä»¥æ‹“å®½è§†é‡ï¼Œæé«˜å“ä½ï¼Œé”»ç‚¼æ€ç»´ï¼Œå°±åƒé—´æ¥åœ°åœ¨è·Ÿä½œè€…æ²Ÿé€šä¸€æ ·ã€‚Quora ä¸Šæœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼š<a href="http://www.quora.com/How-did-TJ-Holowaychuk-learn-to-program">TJ-Holowaychunk æ˜¯å¦‚ä½•å­¦ä¹ ç¼–ç¨‹çš„</a>ï¼Œä»–çš„å›ç­”æ˜¯</p>
<blockquote>
<blockquote>
<blockquote>
<p>I don't read books, never went to school, I just read other people's code and always wonder how things work</p>
</blockquote>
</blockquote>
</blockquote>
<p>å¦‚æœæœ‰è¶³å¤Ÿçš„å¥½å¥‡å¿ƒï¼Œå¹¶ä¸”æ€»æƒ³çŸ¥é“ã€ŒHow Things Workã€ï¼Œé‚£ä¹ˆé˜…è¯»æºç å°±æ˜¯ä¸ªä¸é”™çš„é€”å¾„ã€‚</p>
<p>æºç çš„å¤æ‚åº¦ä¸åŒï¼Œéœ€è¦æŠ•å…¥çš„æ—¶é—´ã€ä½¿ç”¨çš„æ–¹æ³•ä¹Ÿä¸åŒï¼Œä»¥ä¸€ä¸ªä¸­ç­‰å¤æ‚åº¦çš„é¡¹ç›®ä¸ºä¾‹ï¼Œç®€å•åˆ†äº«ä¸‹æˆ‘é˜…è¯»æºç çš„ä¸€äº›ç»éªŒã€‚</p>
<p>WWDC 2014ï¼Œæœ‰ä¸€ä¸ª Session æ˜¯è®²<a href="https://developer.apple.com/videos/wwdc/2014/#232">ã€ŒAdvanced User Interfaces with Collection Viewsã€</a>ï¼Œä¹‹æ‰€ä»¥é€‰æ‹©è¿™ä¸ªï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯æˆ‘ä»¬è¿˜ç®—ç†Ÿæ‚‰çš„å¯¹è±¡ï¼ˆCollection Viewï¼‰ï¼Œä½†è‹¹æœç”¨äº†ä¸€äº›ã€Œç‰¹æ®Šã€çš„æ¶æ„æ¥åšåˆ°ä»£ç å¤ç”¨ï¼Œå¹¶ä¸”å‡å°‘ VC çš„ä½“ç§¯ï¼Œè€Œä¸”ä½¿ç”¨äº†éƒ¨åˆ† iTunes Connect çš„æºç ï¼Œè€Œä¸æ˜¯ç®€å•çš„æ¼”ç¤ºä»£ç ã€‚æ‰€ä»¥å†³å®šä¸€çª¥ç©¶ç«Ÿã€‚</p>
<p>ä¸ºäº†æœ‰ä¸€ä¸ªå¤§æ¦‚çš„æ„Ÿå—ï¼Œå…ˆçœ‹ä¸€éè§†é¢‘ï¼Œä¸éœ€è¦é¢†ä¼šæ¯ä¸ªè¦ç‚¹ï¼Œå…ˆè®°å½•ä¸€äº›å…³é”®ä¿¡æ¯ï¼Œæ–¹ä¾¿åˆ°æ—¶ç¿»æºç ã€‚</p>
<ul>
<li>è¿™å¥—ç»“æ„å¯ä»¥å¤„ç†å¤æ‚çš„ DataSource</li>
<li>å¯ä»¥åŒæ—¶é€‚é… iPhone / iPad</li>
<li>æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ loading indicator</li>
<li>å¯ä»¥è®¾ç½®æŸä¸ª Header æ˜¯å¦ç½®é¡¶</li>
<li>å¯ä»¥æœ‰ä¸€ä¸ªå…¨å±€çš„ Header</li>
<li>é€šè¿‡èšåˆ DataSource çš„æ–¹æ³•æ¥è¾¾åˆ°ä»£ç å¤ç”¨ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ª VC</li>
<li>å¯ä»¥è®¾ç½®èšåˆå½¢å¼ä¸º Segmented / Composed</li>
<li>layout ä¿¡æ¯å¯ä»¥é…ç½®ï¼Œä¸”å¯ä»¥è¦†ç›–</li>
<li>ä½¿ç”¨äº†æœ‰é™çŠ¶æ€æœº</li>
<li>å­ DataSource åœ¨æ•°æ®è½½å…¥å®Œæˆåä¼šæœ‰ä¸€ä¸ª blockï¼Œæ‰€éœ€çš„ DataSource éƒ½è½½å…¥å®Œæˆæ—¶ï¼Œè¿™äº› block ä¼šè¢«ç»Ÿä¸€æ‰§è¡Œ</li>
<li>Section Metrics å¯ä»¥è®¾ç½® Section çš„å…·ä½“è¡¨ç°</li>
<li>layout çš„ä¿¡æ¯ä¼šåœ¨å†…éƒ¨è¢«ä¿å­˜ï¼Œé¿å…é‡å¤è®¡ç®— (Snapshot Metrics)</li>
<li>Optional Layout Methods ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„å¥½æ•ˆæœ</li>
</ul>
<p>äº§ç”Ÿäº†ä¸€äº›ç–‘é—®ï¼Œæ¯”å¦‚</p>
<ul>
<li>å¤šä¸ªå­ DataSource è¢«ç»„åˆæˆä¸€ä¸ª Composed DataSource æ—¶ï¼Œå¦‚ä½•é€šè¿‡ IndexPath æ‰¾åˆ°å¯¹åº”çš„ DataSourceï¼Ÿ</li>
<li>æ‰¾åˆ°ä¹‹åå¦‚ä½•å¤„ç†ï¼Ÿ</li>
<li>æ˜¯å¦ç½®é¡¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</li>
<li>å¦‚ä½•é€šè¿‡æœ‰é™çŠ¶æ€æœºæ¥ç®¡ç† Loading çŠ¶æ€ï¼Ÿ</li>
<li>å¦‚æœæœ‰æŒ‰é’®ï¼Œé‚£ä¹ˆæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶å¦‚ä½•å¤„ç†ï¼Ÿ</li>
<li>Collection View æ²¡æœ‰ headerViewï¼Œè¿™åˆæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</li>
<li>æ•°æ®æ˜¯æ€ä¹ˆè½½å…¥çš„ï¼Ÿ</li>
</ul>
<p>å¤§æ¦‚æœ‰äº†äº›æ¦‚å¿µå’Œç–‘é—®ä¹‹åï¼Œå°±å¯ä»¥æ‰“å¼€æºç ç—›å¿«çœ‹äº†ï¼Œå…ˆæ¥çœ‹çœ‹ç›®å½•ç»“æ„ (å¯ä»¥åœ¨è¿™é‡Œ<a href="https://github.com/zwaldowski/AAPLAdvancedCollectionView">åœ¨çº¿æµè§ˆ</a>)</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">|-</span><span> Framework
</span><span>	</span><span style="color:#3e999f;">|-</span><span> Categories
</span><span>	</span><span style="color:#3e999f;">|-</span><span> DataSources
</span><span>	</span><span style="color:#3e999f;">|-</span><span> Layouts
</span><span>	</span><span style="color:#3e999f;">|-</span><span> ViewControllers
</span><span>	</span><span style="color:#3e999f;">|-</span><span> Views
</span><span style="color:#3e999f;">|-</span><span> Application
</span></code></pre>
<p>çœ‹æ¥å…³é”®çš„ä¿¡æ¯éƒ½åœ¨ Framework é‡Œäº†ï¼Œé‚£å¦‚ä½•åˆ‡å…¥å‘¢ï¼Ÿåå…¶é“è€Œè¡Œä¹‹ï¼Œå…ˆæ¥çœ‹çœ‹è¿™äº› Framework æ˜¯æ€ä¹ˆç”¨çš„ï¼Œæœ€ç›´æ¥çš„å°±ä» ViewController å…¥æ‰‹ã€‚é‚£å°±å…ˆæ¥çœ‹çœ‹ AAPLCatListViewController è¿™ä¸ªç±»å§ï¼Œå¦‚æœæ²¡çŒœé”™çš„è¯ï¼Œåº”è¯¥æ˜¯å±•ç¤ºå–µå’ªåˆ—è¡¨ï¼ˆç›´è§‚çš„åå­—å¾ˆé‡è¦ï¼‰ã€‚</p>
<p>æœç„¶å¾ˆå°ï¼Œå±…ç„¶åªæœ‰ 140 è¡Œï¼Œå¦‚æœä¸åˆ†ç¦»çš„è¯ï¼Œ1400 è¡Œä¹Ÿæ˜¯å¯ä»¥è½»æ¾è¾¾åˆ°çš„ã€‚çœ‹åˆ°å®šä¹‰äº†ä¸€ä¸ª AAPLSegmentedDataSourceï¼Œè„‘æµ·é‡Œå¤§æ¦‚å¯ä»¥æƒ³è±¡å‡ºæ˜¯ä¸€ä¸ªå¯ä»¥åˆ‡æ¢ Tag çš„é¡µé¢ï¼Œæ¥ç€åˆçœ‹åˆ°äº†ä¸¤ä¸ª DataSourceï¼Œé‚£è¿™ä¸¤ä¸ªé¡µé¢çš„æ•°æ®æºåº”è¯¥å°±æ˜¯å®ƒä»¬äº†ã€‚</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#8959a8;">@interface </span><span>APPLCatListViewController ()
</span><span style="color:#8959a8;">@property </span><span>(</span><span style="color:#8959a8;">nonatomic</span><span>, </span><span style="color:#8959a8;">strong</span><span>) AAPLSegmentedDataSource </span><span style="color:#3e999f;">*</span><span>segmentedDataSource;
</span><span style="color:#8959a8;">@property </span><span>(</span><span style="color:#8959a8;">nonatomic</span><span>, </span><span style="color:#8959a8;">strong</span><span>) AAPLCatListDataSource </span><span style="color:#3e999f;">*</span><span>catsDataSource;
</span><span style="color:#8959a8;">@property </span><span>(</span><span style="color:#8959a8;">nonatomic</span><span>, </span><span style="color:#8959a8;">strong</span><span>) AAPLCatListDataSource </span><span style="color:#3e999f;">*</span><span>favoriteCatsDataSource;
</span><span style="color:#8959a8;">@property </span><span>(</span><span style="color:#8959a8;">nonatomic</span><span>, </span><span style="color:#8959a8;">strong</span><span>) </span><span style="color:#c99e00;">NSIndexPath </span><span style="color:#3e999f;">*</span><span>selectedIndexPath;
</span><span style="color:#8959a8;">@property </span><span>(</span><span style="color:#8959a8;">nonatomic</span><span>, </span><span style="color:#8959a8;">strong</span><span>) </span><span style="color:#8959a8;">id </span><span>selectedDataSourceObserver;
</span><span style="color:#8959a8;">@end
</span></code></pre>
<p>ç„¶ååˆçœ‹åˆ°è¿™ä¹ˆä¸€è¡Œ</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">- </span><span>(</span><span style="color:#8959a8;">void</span><span>)dealloc
</span><span>{
</span><span>    [</span><span style="color:#c82728;">self</span><span>.</span><span style="color:#c82728;">segmentedDataSource</span><span> aapl_removeObserver</span><span style="color:#3e999f;">:</span><span style="color:#c82728;">self</span><span>.</span><span style="color:#c82728;">selectedDataSourceObserver</span><span>];
</span><span>}
</span></code></pre>
<p>çœ‹èµ·æ¥æ˜¯è‹¹æœè‡ªå·±å®ç°äº†ä¸€ä¸ª KVO Wrapperï¼Œæœç„¶ä»–ä»¬è‡ªå·±ä¹Ÿæ— æ³•å¿å—åŸç”Ÿçš„ KVOï¼Œå“ˆå“ˆã€‚æ¥ç€åˆ°äº† ViewDidLoadï¼Œæ–°å»ºäº†ä¸¤ä¸ª DataSourceï¼Œé‚£æ–°å»ºçš„æ—¶å€™éƒ½å¹²äº†äº›ä»€ä¹ˆï¼Ÿ</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">- </span><span>(AAPLCatListDataSource </span><span style="color:#3e999f;">*</span><span>)newAllCatsDataSource
</span><span>{
</span><span>    AAPLCatListDataSource </span><span style="color:#3e999f;">*</span><span>dataSource </span><span style="color:#3e999f;">= </span><span>[[AAPLCatListDataSource </span><span style="color:#4271ae;">alloc</span><span>] init];
</span><span>    dataSource.</span><span style="color:#c82728;">showingFavorites </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">NO</span><span>;
</span><span>
</span><span>    dataSource.</span><span style="color:#c82728;">title </span><span style="color:#3e999f;">=</span><span> NSLocalizedString(</span><span style="color:#839c00;">@&quot;All&quot;</span><span>, </span><span style="color:#839c00;">@&quot;Title for available cats list&quot;</span><span>);
</span><span>    dataSource.</span><span style="color:#c82728;">noContentMessage </span><span style="color:#3e999f;">=</span><span> NSLocalizedString(</span><span style="color:#839c00;">@&quot;All the big ...&quot;</span><span>, </span><span style="color:#839c00;">@&quot;The message to show when no cats are available&quot;</span><span>);
</span><span>    dataSource.</span><span style="color:#c82728;">noContentTitle </span><span style="color:#3e999f;">=</span><span> NSLocalizedString(</span><span style="color:#839c00;">@&quot;No Cats&quot;</span><span>, </span><span style="color:#839c00;">@&quot;The title to show when no cats are available&quot;</span><span>);
</span><span>    dataSource.</span><span style="color:#c82728;">errorMessage </span><span style="color:#3e999f;">=</span><span> NSLocalizedString(</span><span style="color:#839c00;">@&quot;A problem with the network ....&quot;</span><span>, </span><span style="color:#839c00;">@&quot;Message to show when unable to load cats&quot;</span><span>);
</span><span>    dataSource.</span><span style="color:#c82728;">errorTitle </span><span style="color:#3e999f;">=</span><span> NSLocalizedString(</span><span style="color:#839c00;">@&quot;Unable To Load Cats&quot;</span><span>, </span><span style="color:#839c00;">@&quot;Title of message to show when unable to load cats&quot;</span><span>);
</span><span>
</span><span>    </span><span style="color:#8959a8;">return</span><span> dataSource;
</span><span>}
</span></code></pre>
<p>æ‰€ä»¥åªæ˜¯åˆå§‹åŒ–ï¼Œç„¶åè®¾ç½®ä¸€äº›ä¿¡æ¯ï¼ŒNothing Specialã€‚ç„¶åçœ‹åˆ°äº† AAPLLayoutSectionMetrics ï¼Œçœ‹èµ·æ¥æ˜¯è®¾ç½® Layout çš„ä¸€äº›æ˜¾ç¤ºä¿¡æ¯ï¼Œå¦‚ height / backgroundColor ä¹‹ç±»çš„ã€‚</p>
<p>æœ€ååˆ›å»ºäº†ä¸€ä¸ª KVO æ¥ç›‘æµ‹ selectedDataSource çš„å˜åŒ–ï¼Œç•Œé¢ä¸Šåšç›¸åº”çš„è°ƒæ•´ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹çœ‹ AAPLCatListDataSource çš„å®ç°ï¼Œä¸€è¿›å»å‘ç°</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#8959a8;">@interface </span><span>AAPLCatListDataSource : </span><span style="color:#839c00;">AAPLBasicDataSource
</span><span style="color:#8e908c;">/// Is this list showing the favorites or all available cats?
</span><span style="color:#8959a8;">@property </span><span>(</span><span style="color:#8959a8;">nonatomic</span><span>) </span><span style="color:#8959a8;">BOOL</span><span> showingFavorites;
</span><span style="color:#8959a8;">@end
</span></code></pre>
<p>çœ‹æ¥ AAPLBasicDataSource ä¸€å®šåšäº†å¾ˆå¤šäº‹ï¼Œè¿›å…¥åˆ° AAPLBasicDataSource.m æ–‡ä»¶ï¼Œçœ‹åˆ°è¿™ä¸ªæ–¹æ³•</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">- </span><span>(</span><span style="color:#8959a8;">void</span><span>)setShowingFavorites</span><span style="color:#3e999f;">:</span><span>(</span><span style="color:#8959a8;">BOOL</span><span>)showingFavorites
</span><span>{
</span><span>    </span><span style="color:#8959a8;">if </span><span>(showingFavorites </span><span style="color:#3e999f;">==</span><span> _showingFavorites)
</span><span>        </span><span style="color:#8959a8;">return</span><span>;
</span><span>
</span><span>    _showingFavorites </span><span style="color:#3e999f;">=</span><span> showingFavorites;
</span><span>    [</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">resetContent</span><span>];
</span><span>    [</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">setNeedsLoadContent</span><span>];
</span><span>
</span><span>    </span><span style="color:#8959a8;">if </span><span>(showingFavorites)
</span><span>        [[</span><span style="color:#c99e00;">NSNotificationCenter </span><span style="color:#4271ae;">defaultCenter</span><span>] addObserver</span><span style="color:#3e999f;">:</span><span style="color:#c82728;">self</span><span> selector</span><span style="color:#3e999f;">:</span><span style="color:#8959a8;">@selector</span><span>(</span><span style="color:#4271ae;">observeFavoriteToggledNotification:</span><span>) name</span><span style="color:#3e999f;">:</span><span>AAPLCatFavoriteToggledNotificationName object</span><span style="color:#3e999f;">:</span><span style="color:#f07219;">nil</span><span>];
</span><span>}
</span></code></pre>
<p>æ³¨æ„åˆ°æœ‰ä¸€ä¸ª <code>setNeedsLoadContent</code> æ–¹æ³•ï¼Œçœ‹èµ·æ¥æ•°æ®çš„è½½å…¥åº”è¯¥æ˜¯é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è§¦å‘çš„ï¼Œè¿›å»çœ‹çœ‹</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">- </span><span>(</span><span style="color:#8959a8;">void</span><span>)setNeedsLoadContent
</span><span>{
</span><span>    [</span><span style="color:#c99e00;">NSObject </span><span style="color:#4271ae;">cancelPreviousPerformRequestsWithTarget:</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">selector:</span><span style="color:#8959a8;">@selector</span><span style="color:#4271ae;">(loadContent) object:</span><span style="color:#f07219;">nil</span><span>];
</span><span>    [</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">performSelector:</span><span style="color:#8959a8;">@selector</span><span style="color:#4271ae;">(loadContent) withObject:</span><span style="color:#f07219;">nil </span><span style="color:#4271ae;">afterDelay:</span><span style="color:#f07219;">0</span><span>];
</span><span>}
</span></code></pre>
<p>ç¬¬ä¸€ä¸ªæ–¹æ³•æ²¡æ€ä¹ˆæ¥è§¦è¿‡ï¼ŒæŸ¥ä¸€ä¸‹æ–‡æ¡£å…ˆï¼ŒåŸæ¥æ˜¯å¯ä»¥å–æ¶ˆä¹‹å‰é€šè¿‡ <code>performSelector:withObject:afterDelay:</code> è§¦å‘çš„æ–¹æ³•ï¼Œä¸ºäº†åŠ æ·±å°è±¡ï¼Œé¡ºä¾¿ Google ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼ŒåŸæ¥ <code>performSelector:withObject:afterDelay</code> åœ¨æ–¹æ³•è¢«æ‰§è¡Œå‰ï¼Œä¼šæŒæœ‰ Objectï¼Œæ–¹æ³•æ‰§è¡Œååœ¨è§£é™¤å¯¹ Object çš„æŒæœ‰ï¼Œå¦‚æœä¸å°å¿ƒå¤šæ¬¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•å°±æœ‰å¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨æ­¤æ–¹æ³•å‰å…ˆ cancel ä¸€ä¸‹æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚</p>
<p>å†æ¥çœ‹çœ‹è¿™ä¸ª <code>loadContent</code> éƒ½åšäº†ä»€ä¹ˆ</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">- </span><span>(</span><span style="color:#8959a8;">void</span><span>)loadContent
</span><span>{
</span><span>    </span><span style="color:#8e908c;">// To be implemented by subclassesâ€¦
</span><span>}
</span></code></pre>
<p>çœ‹æ¥éœ€è¦åœ¨å­ç±»å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œé‚£å°±åˆ° AAPLCatListDataSource é‡Œçœ‹çœ‹è¿™ä¸ªæ–¹æ³•éƒ½åšäº†ä»€ä¹ˆ</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">- </span><span>(</span><span style="color:#8959a8;">void</span><span>)loadContent
</span><span>{
</span><span>    [</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">loadContentWithBlock:</span><span style="color:#3e999f;">^</span><span style="color:#4271ae;">(AAPLLoading </span><span style="color:#3e999f;">*</span><span style="color:#4271ae;">loading) {
</span><span style="color:#4271ae;">        </span><span style="color:#8959a8;">void </span><span style="color:#4271ae;">(</span><span style="color:#3e999f;">^</span><span style="color:#4271ae;">handler)(</span><span style="color:#c99e00;">NSArray </span><span style="color:#3e999f;">*</span><span style="color:#4271ae;">cats, </span><span style="color:#c99e00;">NSError </span><span style="color:#3e999f;">*</span><span style="color:#4271ae;">error) </span><span style="color:#3e999f;">= ^</span><span style="color:#4271ae;">(</span><span style="color:#c99e00;">NSArray </span><span style="color:#3e999f;">*</span><span style="color:#4271ae;">cats, </span><span style="color:#c99e00;">NSError </span><span style="color:#3e999f;">*</span><span style="color:#4271ae;">error) {
</span><span style="color:#4271ae;">            </span><span style="color:#8e908c;">// Check to make certain a more recent call to load content hasn&#39;t superceded this oneâ€¦
</span><span style="color:#4271ae;">            </span><span style="color:#8959a8;">if </span><span style="color:#4271ae;">(</span><span style="color:#3e999f;">!</span><span style="color:#4271ae;">loading.</span><span style="color:#c82728;">current</span><span style="color:#4271ae;">) {
</span><span style="color:#4271ae;">                [loading ignore];
</span><span style="color:#4271ae;">                </span><span style="color:#8959a8;">return</span><span style="color:#4271ae;">;
</span><span style="color:#4271ae;">            }
</span><span style="color:#4271ae;">
</span><span style="color:#4271ae;">            </span><span style="color:#8959a8;">if </span><span style="color:#4271ae;">(error) {
</span><span style="color:#4271ae;">                [loading doneWithError:error];
</span><span style="color:#4271ae;">                </span><span style="color:#8959a8;">return</span><span style="color:#4271ae;">;
</span><span style="color:#4271ae;">            }
</span><span style="color:#4271ae;">
</span><span style="color:#4271ae;">            </span><span style="color:#8959a8;">if </span><span style="color:#4271ae;">(cats.</span><span style="color:#c82728;">count</span><span style="color:#4271ae;">)
</span><span style="color:#4271ae;">                [loading updateWithContent:</span><span style="color:#3e999f;">^</span><span style="color:#4271ae;">(AAPLCatListDataSource </span><span style="color:#3e999f;">*</span><span style="color:#4271ae;">me) {
</span><span style="color:#4271ae;">                    me.</span><span style="color:#c82728;">items </span><span style="color:#3e999f;">=</span><span style="color:#4271ae;"> cats;
</span><span style="color:#4271ae;">                }];
</span><span style="color:#4271ae;">            </span><span style="color:#8959a8;">else
</span><span style="color:#4271ae;">                [loading updateWithNoContent:</span><span style="color:#3e999f;">^</span><span style="color:#4271ae;">(AAPLCatListDataSource </span><span style="color:#3e999f;">*</span><span style="color:#4271ae;">me) {
</span><span style="color:#4271ae;">                    me.</span><span style="color:#c82728;">items </span><span style="color:#3e999f;">=</span><span style="color:#4271ae;"> @[];
</span><span style="color:#4271ae;">                }];
</span><span style="color:#4271ae;">        };
</span><span style="color:#4271ae;">
</span><span style="color:#4271ae;">        </span><span style="color:#8959a8;">if </span><span style="color:#4271ae;">(</span><span style="color:#c82728;">self</span><span style="color:#4271ae;">.</span><span style="color:#c82728;">showingFavorites</span><span style="color:#4271ae;">)
</span><span style="color:#4271ae;">            [[AAPLDataAccessManager manager] fetchFavoriteCatListWithCompletionHandler</span><span style="color:#3e999f;">:</span><span style="color:#4271ae;">handler];
</span><span style="color:#4271ae;">        </span><span style="color:#8959a8;">else
</span><span style="color:#4271ae;">            [[AAPLDataAccessManager manager] fetchCatListWithCompletionHandler</span><span style="color:#3e999f;">:</span><span style="color:#4271ae;">handler];
</span><span style="color:#4271ae;">    }</span><span>];
</span><span>}
</span></code></pre>
<p>ä½¿ç”¨äº† <code>loadContentWithBlock:</code> æ–¹æ³•ï¼Œè¿›å»çœ‹çœ‹ï¼Œè¿™ä¸ªæ–¹æ³•åšäº†ä»€ä¹ˆ</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">- </span><span>(</span><span style="color:#8959a8;">void</span><span>)loadContentWithBlock</span><span style="color:#3e999f;">:</span><span>(AAPLLoadingBlock)block
</span><span>{
</span><span>    [</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">beginLoading</span><span>];
</span><span>
</span><span>    __weak </span><span style="color:#c82728;">typeof</span><span style="color:#4271ae;">(</span><span style="color:#3e999f;">&amp;*</span><span style="color:#c82728;">self</span><span style="color:#4271ae;">)</span><span> weakself </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">self</span><span>;
</span><span>
</span><span>    AAPLLoading </span><span style="color:#3e999f;">*</span><span>loading </span><span style="color:#3e999f;">= </span><span>[AAPLLoading </span><span style="color:#4271ae;">loadingWithCompletionHandler:</span><span style="color:#3e999f;">^</span><span style="color:#4271ae;">(</span><span style="color:#c99e00;">NSString </span><span style="color:#3e999f;">*</span><span style="color:#4271ae;">newState, </span><span style="color:#c99e00;">NSError </span><span style="color:#3e999f;">*</span><span style="color:#4271ae;">error, AAPLLoadingUpdateBlock update){
</span><span style="color:#4271ae;">        </span><span style="color:#8959a8;">if </span><span style="color:#4271ae;">(</span><span style="color:#3e999f;">!</span><span style="color:#4271ae;">newState)
</span><span style="color:#4271ae;">            </span><span style="color:#8959a8;">return</span><span style="color:#4271ae;">;
</span><span style="color:#4271ae;">
</span><span style="color:#4271ae;">        [</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">endLoadingWithState:newState error:error update:</span><span style="color:#3e999f;">^</span><span style="color:#4271ae;">{
</span><span style="color:#4271ae;">            AAPLDataSource </span><span style="color:#3e999f;">*</span><span style="color:#4271ae;">me </span><span style="color:#3e999f;">=</span><span style="color:#4271ae;"> weakself;
</span><span style="color:#4271ae;">            </span><span style="color:#8959a8;">if </span><span style="color:#4271ae;">(update </span><span style="color:#3e999f;">&amp;&amp;</span><span style="color:#4271ae;"> me)
</span><span style="color:#4271ae;">                </span><span style="color:#c82728;">update</span><span style="color:#4271ae;">(me);
</span><span style="color:#4271ae;">        }];
</span><span style="color:#4271ae;">    }</span><span>];
</span><span>
</span><span>    </span><span style="color:#8e908c;">// Tell previous loading instance it&#39;s no longer current and remember this loading instance
</span><span>    </span><span style="color:#c82728;">self</span><span>.</span><span style="color:#c82728;">loadingInstance</span><span>.</span><span style="color:#c82728;">current </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">NO</span><span>;
</span><span>    </span><span style="color:#c82728;">self</span><span>.</span><span style="color:#c82728;">loadingInstance </span><span style="color:#3e999f;">=</span><span> loading;
</span><span>
</span><span>    </span><span style="color:#8e908c;">// Call the provided block to actually do the load
</span><span>    </span><span style="color:#c82728;">block</span><span style="color:#4271ae;">(loading)</span><span>;
</span><span>}
</span></code></pre>
<p>ç®€å•è¯´æ¥å°±æ˜¯ç”Ÿæˆäº†ä¸€ä¸ª loadingï¼Œç„¶åæŠŠ loading ä¼ ç»™ blockï¼Œé‚£ <code>loadingWithCompletionHandler:</code> è¿™ä¸ªæ–¹æ³•åˆåšäº†ä»€ä¹ˆ</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">+ </span><span>(instancetype)loadingWithCompletionHandler</span><span style="color:#3e999f;">:</span><span>(</span><span style="color:#8959a8;">void</span><span>(</span><span style="color:#3e999f;">^</span><span>)(</span><span style="color:#c99e00;">NSString </span><span style="color:#3e999f;">*</span><span>state, </span><span style="color:#c99e00;">NSError </span><span style="color:#3e999f;">*</span><span>error, AAPLLoadingUpdateBlock update))handler
</span><span>{
</span><span>    NSParameterAssert(handler </span><span style="color:#3e999f;">!= </span><span style="color:#f07219;">nil</span><span>);
</span><span>    AAPLLoading </span><span style="color:#3e999f;">*</span><span>loading </span><span style="color:#3e999f;">= </span><span>[[</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">alloc</span><span>] init];
</span><span>    loading.</span><span style="color:#c82728;">block </span><span style="color:#3e999f;">=</span><span> handler;
</span><span>    loading.</span><span style="color:#c82728;">current </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">YES</span><span>;
</span><span>    </span><span style="color:#8959a8;">return</span><span> loading;
</span><span>}
</span></code></pre>
<p>æ‰€ä»¥å°±æ˜¯ç”Ÿæˆä¸€ä¸ª loading å®ä¾‹ï¼Œç„¶åæŠŠ handler å­˜åˆ° block å±æ€§é‡Œã€‚æ—¢ç„¶å­˜äº†ï¼Œé‚£å°†æ¥æŸä¸ªæ—¶å€™ä¸€å®šä¼šç”¨åˆ°ï¼Œä»åå­—ä¸Šæ¥çœ‹ï¼Œåº”è¯¥æ˜¯ loading å®Œæˆæ—¶ä¼šè¢«è°ƒç”¨ï¼Œæœç´¢ block å…³é”®å­—ï¼Œå‘ç°åªæœ‰åœ¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ä¸­ block æ‰ä¼šè¢«è°ƒç”¨</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">- </span><span>(</span><span style="color:#8959a8;">void</span><span>)_doneWithNewState</span><span style="color:#3e999f;">:</span><span>(</span><span style="color:#c99e00;">NSString </span><span style="color:#3e999f;">*</span><span>)newState error</span><span style="color:#3e999f;">:</span><span>(</span><span style="color:#c99e00;">NSError </span><span style="color:#3e999f;">*</span><span>)error update</span><span style="color:#3e999f;">:</span><span>(AAPLLoadingUpdateBlock)update
</span><span>{
</span><span style="color:#8959a8;">#if</span><span> DEBUG
</span><span>    </span><span style="color:#8959a8;">if </span><span>(</span><span style="color:#3e999f;">!</span><span style="color:#c82728;">OSAtomicCompareAndSwap32</span><span style="color:#4271ae;">(</span><span style="color:#f07219;">0</span><span style="color:#4271ae;">, </span><span style="color:#f07219;">1</span><span style="color:#4271ae;">, </span><span style="color:#3e999f;">&amp;</span><span style="color:#4271ae;">_complete)</span><span>)
</span><span>        </span><span style="color:#c82728;">NSAssert</span><span style="color:#4271ae;">(</span><span style="color:#f07219;">false</span><span style="color:#4271ae;">, </span><span style="color:#839c00;">@&quot;completion method called more than once&quot;</span><span style="color:#4271ae;">)</span><span>;
</span><span style="color:#8959a8;">#endif
</span><span>
</span><span>    </span><span style="color:#8959a8;">void </span><span>(</span><span style="color:#3e999f;">^</span><span>block)(</span><span style="color:#c99e00;">NSString </span><span style="color:#3e999f;">*</span><span>state, </span><span style="color:#c99e00;">NSError </span><span style="color:#3e999f;">*</span><span>error, AAPLLoadingUpdateBlock update) </span><span style="color:#3e999f;">=</span><span> _block;
</span><span>
</span><span>    </span><span style="color:#c82728;">dispatch_async</span><span style="color:#4271ae;">(</span><span style="color:#c82728;">dispatch_get_main_queue</span><span style="color:#4271ae;">(), </span><span style="color:#3e999f;">^</span><span style="color:#4271ae;">{
</span><span style="color:#4271ae;">        </span><span style="color:#c82728;">block</span><span style="color:#4271ae;">(newState, error, update);
</span><span style="color:#4271ae;">    })</span><span>;
</span><span>
</span><span>    _block </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">nil</span><span>;
</span><span>}
</span></code></pre>
<p>æ—¢ç„¶æ˜¯ _ å¼€å¤´ï¼Œé‚£åº”è¯¥æ˜¯å†…éƒ¨æ–¹æ³•ï¼Œå¯¹å¤–å°è£…äº†å‡ ç§çŠ¶æ€ï¼Œå¦‚ <code>ignore</code>, <code>done</code>, <code>updateWithContent:</code> ç­‰ã€‚</p>
<p>å’¦ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆè¦å…ˆæŠŠ _block èµ‹ç»™ä¸€ä¸ªä¸´æ—¶å˜é‡ blockï¼Œç„¶åå†æŠŠ _block è®¾ä¸º nil å‘¢ï¼Ÿçœ‹èµ·æ¥åƒæ˜¯ä¸ºäº†è§£å†³æŸç§å†…å­˜é—®é¢˜ã€‚å¦‚æœç›´æ¥ <code>_block(newState, error, update)</code> ä¼šæ€æ ·ï¼Ÿå“¦ï¼Œè™½ç„¶è¿™é‡Œæ²¡æœ‰å‡ºç° selfï¼Œä½† _block æ˜¯ä¸€ä¸ª instance å˜é‡ï¼Œæ‰€ä»¥åœ¨ ^{} é‡Œä¼šå¯¹ self è¿›è¡Œå¼ºå¼•ç”¨ã€‚è€Œå¦‚æœèµ‹ç»™ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œé‚£ä¹ˆåªä¼šå¯¹è¿™ä¸ªä¸´æ—¶å˜é‡å¼ºå¼•ç”¨ï¼Œå°±ä¸ä¼šå‡ºç°å¾ªç¯å¼•ç”¨çš„æƒ…å†µã€‚</p>
<p>AAPLLoading çœ‹çš„å·®ä¸å¤šäº†ï¼Œå†å‡ºæ¥çœ‹ <code>loadContentWithBlock:</code> ï¼Œæ³¨æ„åˆ°åœ¨ CompletionHandler é‡Œï¼Œæœ‰è¿™ä¹ˆä¸€æ®µ</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span>[</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">endLoadingWithState:newState error:error update:</span><span style="color:#3e999f;">^</span><span style="color:#4271ae;">{
</span><span style="color:#4271ae;">	AAPLDataSource </span><span style="color:#3e999f;">*</span><span style="color:#4271ae;">me </span><span style="color:#3e999f;">=</span><span style="color:#4271ae;"> weakself;
</span><span style="color:#4271ae;">	</span><span style="color:#8959a8;">if </span><span style="color:#4271ae;">(update </span><span style="color:#3e999f;">&amp;&amp;</span><span style="color:#4271ae;"> me)
</span><span style="color:#4271ae;">		</span><span style="color:#c82728;">update</span><span style="color:#4271ae;">(me);
</span><span style="color:#4271ae;">}</span><span>];
</span></code></pre>
<p>è¿™é‡Œçš„ self æ˜¯ AAPLDataSource ï¼ˆBlock åµŒå¥—å¤šäº†ï¼Œè¿˜çœŸæ˜¯å®¹æ˜“æ™•å•Šï¼‰ï¼Œæ¥çœ‹çœ‹ <code>endLoadingWithState:error:update</code> è¿™ä¸ªæ–¹æ³•éƒ½åšäº†ä»€ä¹ˆ</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#3e999f;">- </span><span>(</span><span style="color:#8959a8;">void</span><span>)endLoadingWithState</span><span style="color:#3e999f;">:</span><span>(</span><span style="color:#c99e00;">NSString </span><span style="color:#3e999f;">*</span><span>)state error</span><span style="color:#3e999f;">:</span><span>(</span><span style="color:#c99e00;">NSError </span><span style="color:#3e999f;">*</span><span>)error update</span><span style="color:#3e999f;">:</span><span>(dispatch_block_t)update
</span><span>{
</span><span>    </span><span style="color:#c82728;">self</span><span>.</span><span style="color:#c82728;">loadingError </span><span style="color:#3e999f;">=</span><span> error;
</span><span>    </span><span style="color:#c82728;">self</span><span>.</span><span style="color:#c82728;">loadingState </span><span style="color:#3e999f;">=</span><span> state;
</span><span>
</span><span>    </span><span style="color:#8959a8;">if </span><span>(</span><span style="color:#c82728;">self</span><span>.</span><span style="color:#c82728;">shouldDisplayPlaceholder</span><span>) {
</span><span>        </span><span style="color:#8959a8;">if </span><span>(update)
</span><span>            [</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">enqueuePendingUpdateBlock:update</span><span>];
</span><span>    }
</span><span>    </span><span style="color:#8959a8;">else </span><span>{
</span><span>        [</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">notifyBatchUpdate:</span><span style="color:#3e999f;">^</span><span style="color:#4271ae;">{
</span><span style="color:#4271ae;">            </span><span style="color:#8e908c;">// Run pending updates
</span><span style="color:#4271ae;">            [</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">executePendingUpdates];
</span><span style="color:#4271ae;">            </span><span style="color:#8959a8;">if </span><span style="color:#4271ae;">(update)
</span><span style="color:#4271ae;">                </span><span style="color:#c82728;">update</span><span style="color:#4271ae;">();
</span><span style="color:#4271ae;">        }</span><span>];
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#c82728;">self</span><span>.</span><span style="color:#c82728;">loadingComplete </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">YES</span><span>;
</span><span>    [</span><span style="color:#c82728;">self </span><span style="color:#4271ae;">notifyContentLoadedWithError:error</span><span>];
</span><span>}
</span></code></pre>
<p>è®¾ç½®ä¸€äº›çŠ¶æ€ï¼Œç„¶ååœ¨æ°å½“çš„æ—¶æœºè°ƒç”¨ update blockï¼Œå’¦ï¼Œè¿™é‡Œæœ‰ä¸ª dispatch_block_t æ²¡æ€ä¹ˆè§è¿‡ï¼ŒæŸ¥äº†ä¸€ä¸‹åŸæ¥æ˜¯ä¸€ä¸ªå†…ç½®çš„ç©ºä¼ å€¼å’Œç©ºè¿”å›çš„ blockã€‚</p>
<p>çœ‹äº†ä¸‹ <code>enqueuePendingUpdateBlock</code>ï¼Œä¼šæŠŠç°åœ¨çš„è¿™ä¸ª update ç»“åˆä¹‹å‰çš„ updateBlockï¼Œå½¢æˆä¸€ä¸ªæ–°çš„ updateBlockï¼Œåº”è¯¥å°±æ˜¯è§†é¢‘é‡Œæåˆ°çš„å½“æ‰€æœ‰çš„ DataSource éƒ½è½½å…¥å®Œæ—¶ï¼Œç»Ÿä¸€æ‰§è¡Œä¹‹å‰çš„ update block</p>
<p><code>notifyBatchUpdate:</code> æ‰€åšçš„æ˜¯çœ‹ä¸€ä¸‹ Delegate æ˜¯å¦å“åº” <code>dataSource:performBatchUpdate:complete:</code> å¦‚æœå“åº”åˆ™èµ°ä½ ï¼Œä¸ç„¶æŒ¨ä¸ªæ‰§è¡Œ update / completeã€‚</p>
<p>çœ‹å®Œäº† <code>loadContentWithBlock</code> å†æ¥çœ‹çœ‹è¿™ä¸ª Block é‡Œé¢éƒ½åšäº†ä»€ä¹ˆï¼Œå¤§æ„æ˜¯æ ¹æ® self.showingFavorites æ¥åˆ‡æ¢ä¸åŒçš„æ•°æ®æºï¼Œè¿™é‡Œçœ‹åˆ°äº†ä¸€ä¸ªæ–°çš„ç±» AAPLDataAccessManagerï¼Œçœ‹èµ·æ¥åƒæ˜¯ç»Ÿä¸€çš„æ•°æ®å±‚ï¼Œç„ä¸€çœ¼</p>
<pre data-lang="m" style="background-color:#f9f9f9;color:#111111;" class="language-m "><code class="language-m" data-lang="m"><span style="color:#8959a8;">@class</span><span> AAPLCat;
</span><span>
</span><span style="color:#8959a8;">@interface </span><span>AAPLDataAccessManager : </span><span style="color:#839c00;">NSObject
</span><span>
</span><span>+ (AAPLDataAccessManager </span><span style="color:#3e999f;">*</span><span>)</span><span style="color:#4271ae;">manager</span><span>;
</span><span>
</span><span>- (</span><span style="color:#8959a8;">void</span><span>)</span><span style="color:#4271ae;">fetchCatListWithCompletionHandler:</span><span>(</span><span style="color:#8959a8;">void</span><span>(</span><span style="color:#3e999f;">^</span><span>)(</span><span style="color:#c99e00;">NSArray </span><span style="color:#3e999f;">*</span><span>cats, </span><span style="color:#c99e00;">NSError </span><span style="color:#3e999f;">*</span><span>error))</span><span style="color:#f07219;">handler</span><span>;
</span><span>- (</span><span style="color:#8959a8;">void</span><span>)</span><span style="color:#4271ae;">fetchFavoriteCatListWithCompletionHandler:</span><span>(</span><span style="color:#8959a8;">void</span><span>(</span><span style="color:#3e999f;">^</span><span>)(</span><span style="color:#c99e00;">NSArray </span><span style="color:#3e999f;">*</span><span>cats, </span><span style="color:#c99e00;">NSError </span><span style="color:#3e999f;">*</span><span>error))</span><span style="color:#f07219;">handler</span><span>;
</span><span>- (</span><span style="color:#8959a8;">void</span><span>)</span><span style="color:#4271ae;">fetchDetailForCat:</span><span>(AAPLCat </span><span style="color:#3e999f;">*</span><span>)</span><span style="color:#f07219;">cat </span><span style="color:#4271ae;">completionHandler:</span><span>(</span><span style="color:#8959a8;">void</span><span>(</span><span style="color:#3e999f;">^</span><span>)(AAPLCat </span><span style="color:#3e999f;">*</span><span>cat, </span><span style="color:#c99e00;">NSError </span><span style="color:#3e999f;">*</span><span>error))</span><span style="color:#f07219;">handler</span><span>;
</span><span>- (</span><span style="color:#8959a8;">void</span><span>)</span><span style="color:#4271ae;">fetchSightingsForCat:</span><span>(AAPLCat </span><span style="color:#3e999f;">*</span><span>)</span><span style="color:#f07219;">cat </span><span style="color:#4271ae;">completionHandler:</span><span>(</span><span style="color:#8959a8;">void</span><span>(</span><span style="color:#3e999f;">^</span><span>)(</span><span style="color:#c99e00;">NSArray </span><span style="color:#3e999f;">*</span><span>sightings, </span><span style="color:#c99e00;">NSError </span><span style="color:#3e999f;">*</span><span>error))</span><span style="color:#f07219;">handler</span><span>;
</span><span>
</span><span style="color:#8959a8;">@end
</span></code></pre>
<p>æœç„¶å¦‚æ­¤ï¼Œå°†æ¥æ•°æ®çš„è½½å…¥å½¢å¼æœ‰å˜åŒ–ï¼Œæˆ–éœ€è¦åšç¼“å­˜å•¥çš„ï¼Œéƒ½å¯ä»¥åœ¨è¿™ä¸€å±‚å¤„ç†ï¼Œå…¶ä»–éƒ¨åˆ†ä¸ä¼šæ„Ÿè§‰åˆ°å˜åŒ–ã€‚</p>
<p>è¿™ä¸€è½®çœ‹ä¸‹æ¥å·²ç»æœ‰ä¸å°‘ä¿¡æ¯é‡äº†ï¼Œæ¥ç®€å•æ‹ä¸€ä¸‹ï¼š</p>
<pre data-lang="bash" style="background-color:#f9f9f9;color:#111111;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#c82728;">[SegmentedDataSource</span><span style="color:#4271ae;"> setNeedsLoadContent]
</span><span style="color:#c82728;">â†“
</span><span style="color:#c82728;">[CatListDataSource</span><span style="color:#4271ae;"> loadContent]
</span><span style="color:#c82728;">â†“
</span><span style="color:#c82728;">[DataSource</span><span style="color:#4271ae;"> loadContentWithBlock:]
</span><span style="color:#c82728;">â†“
</span><span style="color:#c82728;">åˆ›å»º</span><span style="color:#4271ae;"> loadingï¼Œè®¾ç½® loading å®Œæˆåè¦åšçš„äº‹ â†’ æ‹¿åˆ°æ•°æ®åæ”¾åˆ° updateQueue é‡Œï¼Œç­‰å…¨éƒ¨æ‹¿åˆ°å†æ‰§è¡Œ batchUpdate
</span><span style="color:#c82728;">â†“
</span><span style="color:#c82728;">æ‰§è¡Œ</span><span style="color:#4271ae;"> loadContentBlock â†’ ä½¿ç”¨ DataAccessManager å»è·å–æ•°æ®ï¼Œæ‹¿åˆ°åäº¤ç»™ loading
</span><span>
</span></code></pre>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è¿è¡Œ Project çœ‹æ•ˆæœï¼Œå› ä¸ºæˆ‘è§‰å¾—ä»£ç åŒ…å«çš„ä¿¡æ¯ä¼šæ›´ä¸°å¯Œï¼Œè€Œä¸”è¿™ä¹ˆçœ‹ä¸‹æ¥åï¼Œå¯¹äºç•Œé¢ä¼šé•¿å•¥æ ·ä¹Ÿæœ‰ä¸ªå¤§æ¦‚çš„äº†è§£ã€‚</p>
<p>è¿™åªæ˜¯å¼€å§‹ï¼Œç»§ç»­æŒ–æ˜ä¸‹å»è¿˜ä¼šæœ‰ä¸å°‘å¥½ä¸œè¥¿ï¼Œæ¯”å¦‚ Favorite æŒ‰é’®çš„å¤„ç†ï¼Œå®ƒæ˜¯é€šè¿‡ Responder Chain è€Œä¸æ˜¯ Delegate æ¥å®ç°çš„ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ€è·¯ã€‚é€šè¿‡æœ‰é™çŠ¶æ€æœºæ¥ç®¡ç† loading çŠ¶æ€ä¹Ÿæ˜¯å¾ˆæœ‰æ„æ€çš„å®ç°ã€‚</p>
<p>å¦‚æœæœ‰å…´è¶£ï¼Œå¯ä»¥çœ‹ä¸‹ ComposedDataSourceï¼Œå…ˆä¸çœ‹å®ç°ï¼Œå¦‚æœè¦è‡ªå·±å†™å¤§æ¦‚ä¼šæ˜¯ä»€ä¹ˆæ€è·¯ï¼Œæ¯”å¦‚å½“è°ƒç”¨ <code>[UICollectionView cellForItemAtIndexPath:]</code> æ—¶ï¼Œå¦‚ä½•æ‰¾åˆ°å¯¹åº”çš„ DataSourceï¼Œæ‰¾åˆ°ä¹‹åå¦‚ä½•æ¸²æŸ“å¯¹åº”çš„ Cell ç­‰ã€‚</p>
<p>æ‰€ä»¥çœ‹æºç çœŸçš„æ˜¯ä¸€ä»¶å¾ˆæœ‰æ„æ€çš„äº‹æƒ…ï¼Œåƒä¸€åœºå†’é™©ï¼Œæ€»æ˜¯ä¼šæœ‰æ„å¤–æ”¶è·ï¼Œå¯èƒ½åœ¨ä¸çŸ¥ä¸è§‰ä¸­ï¼Œèƒ½åŠ›å°±å¾—åˆ°äº†æå‡ã€‚</p>

  </div>


  <ul class="tags flex flex-wrap justify-center items-center gap-4 mt-5 mb-8 text-lg">
    
    
    <li
      class="px-4 pb-[2px] leading-8 rounded-full border text-gray-700 border-gray-700 hover:text-gray-100 hover:border-gray-900 hover:bg-gray-900 transition-all">
      <a class="inline-block" href="https://limboy.me/tags/programming/">programming</a>
    </li>
    
    <li
      class="px-4 pb-[2px] leading-8 rounded-full border text-gray-700 border-gray-700 hover:text-gray-100 hover:border-gray-900 hover:bg-gray-900 transition-all">
      <a class="inline-block" href="https://limboy.me/tags/essay/">essay</a>
    </li>
    
    
  </ul>

  
  <script src="https://giscus.app/client.js" data-repo="limboy/telescope"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzODEwOTA2MTg=" data-category="General"
    data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMzMDY2MTQy" data-mapping="title" data-reactions-enabled="1"
    data-emit-metadata="0" data-theme="light" data-lang="en" crossorigin="anonymous" async>
    </script>
  

  

</div>

      </div>
    </div>
    
    <footer
      class="flex border-t border-gray-300 text-gray-600 bg-gray-50 items-center justify-center h-12 text-sm mt-2">
      <div class="flex inner justify-center gap-4">
        <a class="hover:underline" href="https://github.com/limboy" target="_blank">GitHub</a>
        <a class="hover:underline" href="https://twitter.com/_limboy" target="_blank">Twitter</a>
        <a class="hover:underline" href="https://limboy.me/index.xml">RSS</a>
      </div>
    </footer>
    
  </div>

  
  

  <script>
    // éƒ½æ˜¯ä¸ºäº† iOS...
    document.querySelector("#wrapper").style.minHeight = `calc(${window.innerHeight}px - 6.5rem)`
    window.addEventListener('resize', () => {
      document.querySelector("#wrapper").style.minHeight = `calc(${window.innerHeight}px - 6.5rem)`
    })
  </script>
</body>

</html>