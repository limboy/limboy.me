<!DOCTYPE html>
<html>

<head>
  <meta content="width=device-width,initial-scale=1" name="viewport" />
  <meta charset="UTF-8">
  <link rel="icon" href="https://fav.farm/ğŸ‘»" />
  <title>
phpå®ç°å®æ—¶é€šä¿¡
</title>
  <link rel="stylesheet" href="/assets/main.css?6&#x2F;2ShUT3RYeReiJdlrDhZN+03rWSUD7DPccwza9UdPM=" />
  <script async defer data-domain="limboy.me" src="https://analytics.limboy.me/js/plausible.js"></script>
  
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@_limboy">
<meta name="twitter:site" content="@_limboy">
<meta property="og:url" content="https://limboy.me/posts/php-comet/">

<meta name="twitter:title" content="phpå®ç°å®æ—¶é€šä¿¡">
<meta property="og:title" content="phpå®ç°å®æ—¶é€šä¿¡">

<meta property="og:description" content="">
<meta name="twitter:description" content="">



</head>

<body class="  ">
  <nav class="flex justify-center items-center opacity-80 bg-black h-12 py-0 ">
    <div class="inner flex justify-between flex-row mx-1">
      <ul class="color-white flex flex-row justify-start gap-4">
        <li><a class="nav-link opacity-90 text-2xl" href="/">Limboy</a></li>
        <!--<li><a class="nav-link" href="/coodle">Coodle</a></li>-->
      </ul>
      <ul class="color-white flex flex-row gap-4 items-center text-base">
        <!--<li> <a class="nav-link" href="/books" class="decoration-0"> Books </a> </li>-->
        <li> <a class="nav-link" href="/highlights" class="decoration-0"> Highlights </a> </li>
        <li> <a class="nav-link" href="/projects" class="decoration-0"> Projects </a> </li>
        <li> <a class="nav-link" href="/about" class="decoration-0"> About </a> </li>
      </ul>
    </div>
  </nav>

  <div class="flex flex-col">
    <div id="wrapper" class="flex justify-center" style="min-height: calc(100vh - 6.5rem);">
      <div class="inner mb-2">
        
<div class="mt-4 lg:mt-6">
  

  <h1 class="title font-medium text-3xl"><a href="https:&#x2F;&#x2F;limboy.me&#x2F;posts&#x2F;php-comet&#x2F;">phpå®ç°å®æ—¶é€šä¿¡</a></h1>
  <div class="flex gap-4 items-center my-1">
    <time class="text-gray-500">2011-03-21</time>

  </div>
  <hr class="border-t-[3px]" />

  <div class="prose lg:prose-xl max-w-full my-6">
    <p>å¦‚æœè‹±æ–‡ ok çš„è¯ï¼Œå¯ä»¥ç›´æ¥çœ‹<a href="http://gonzalo123.wordpress.com/2011/03/14/real-time-notifications-with-php/">è¿™ç¯‡æ–‡ç« </a></p>
<p>å®ç°å®æ—¶é€šä¿¡ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼:
socket æˆ– cometã€‚socket æ˜¯æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œé—®é¢˜åœ¨äºä¸æ˜¯æ‰€æœ‰çš„æµè§ˆå™¨éƒ½å…¼å®¹ï¼ŒæœåŠ¡å™¨ç«¯å®ç°èµ·æ¥ä¹Ÿç¨å¾®æœ‰ç‚¹éº»çƒ¦ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œcomet(åŸºäº HTTP é•¿è¿æ¥çš„&quot;æœåŠ¡å™¨æ¨&quot;)å®ç°èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼Œè€Œä¸”å…¼å®¹æ‰€æœ‰çš„æµè§ˆå™¨ã€‚æ‰€ä»¥è¿™æ¬¡å°±æ¥è¯´è¯´ comet çš„ php å®ç°ã€‚</p>
<p>comet ä¹Ÿæœ‰å¥½å‡ ç§å®ç°æ–¹å¼ï¼Œå¦‚ iframe, http long requestï¼ŒäºŒè€…çš„åŒºåˆ«å¯ä»¥å‚è€ƒ<a href="http://www.ibm.com/developerworks/cn/web/wa-lo-comet/">è¿™ç¯‡æ–‡ç« </a>ã€‚æœ¬æ–‡ä¸»è¦æ¢è®¨ http long request å®ç°å®æ—¶é€šä¿¡ã€‚</p>
<p>å…ˆè¯´è¯´ http é•¿é“¾æ¥æ˜¯æ€ä¹ˆå›äº‹ï¼Œé€šä¿—ç‚¹è®²å°±æ˜¯æœåŠ¡å™¨ä¸æ˜¯ä¸€æ”¶åˆ°è¯·æ±‚å°±ç›´æ¥åæ•°æ®ï¼Œè€Œæ˜¯åœ¨é‚£æ†‹å•Šæ†‹ï¼Œä¸€ç›´æ†‹åˆ°æ†‹ä¸ä½äº†ï¼Œæ‰å‘Šè¯‰ä½ æ‰§è¡Œç»“æœã€‚</p>
<pre data-lang="php" style="background-color:#f9f9f9;color:#111111;" class="language-php "><code class="language-php" data-lang="php"><span style="color:#f07219;">&lt;?php
</span><span>
</span><span style="color:#c82728;">$count </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">10</span><span>;
</span><span>
</span><span style="color:#8959a8;">for</span><span>(</span><span style="color:#c82728;">$i</span><span style="color:#3e999f;">=</span><span style="color:#f07219;">0</span><span>; </span><span style="color:#c82728;">$i</span><span style="color:#3e999f;">&lt;</span><span style="color:#c82728;">$count</span><span>; </span><span style="color:#c82728;">$i</span><span style="color:#3e999f;">++</span><span>)
</span><span>{
</span><span>	</span><span style="color:#8e908c;">// do something ...
</span><span>	</span><span style="color:#4271ae;">sleep(</span><span style="color:#f07219;">2</span><span style="color:#4271ae;">)</span><span>;
</span><span>}
</span><span>
</span><span style="color:#4271ae;">echo </span><span style="color:#839c00;">&#39;æ†‹æ­»æˆ‘äº†&#39;</span><span>;
</span></code></pre>
<p>è‡³äºæ†‹å¤šé•¿æ—¶é—´ï¼Œå°±çœ‹å…·ä½“åº”ç”¨äº†ï¼Œå¦‚æœæ†‹å¤ªä¹…çš„è¯ï¼ŒæœåŠ¡å™¨èµ„æºçš„å ç”¨ä¹Ÿä¼šæ˜¯ä¸ªé—®é¢˜ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å°±è¦é€šè¿‡è¿™ç§æ–¹æ³•æ¥å®ç°å®æ—¶é€šä¿¡(å…¶å®æ˜¯å‡†å®æ—¶)ï¼Œå…ˆè¯´ä¸€ä¸‹åŸç†ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ª ajax é•¿é“¾æ¥æŸ¥è¯¢ï¼Œç„¶åæœåŠ¡ç«¯å°±å¼€å§‹æ‰§è¡Œä»£ç ï¼Œä¸»è¦æ˜¯æ£€æŸ¥æŸä¸ªæ–‡ä»¶æ˜¯å¦è¢«æ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰ï¼Œç¡ä¸€ä¼š(sleep)ï¼Œé†’æ¥æ¥ç€æ£€æŸ¥</li>
<li>å¦‚æœå®¢æˆ·ç«¯åˆå‘èµ·äº†ä¸€ä¸ªæŸ¥è¯¢é“¾æ¥(æ­£å¸¸è¯·æ±‚)ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åï¼Œå¤„ç†è¯·æ±‚ï¼Œå¤„ç†å®Œæ¯•åæ›´æ–°æŸä¸ªç‰¹å®šæ–‡ä»¶çš„ modify time</li>
<li>è¿™æ—¶ç¬¬ä¸€æ¬¡ ajax æŸ¥è¯¢çš„åå°ä»£ç è¿˜åœ¨æ‰§è¡Œï¼Œå‘ç°æŸä¸ªæ–‡ä»¶è¢«æ›´æ–°ï¼Œè¯´æ˜æ¥äº†æ–°è¯·æ±‚ï¼Œè¾“å‡ºå¯¹åº”çš„ç»“æœ</li>
<li>ç¬¬ä¸€æ¬¡ ajax æŸ¥è¯¢çš„ callback è¢«è§¦å‘ï¼Œæ›´æ–°é¡µé¢ï¼Œç„¶åå†å‘èµ·ä¸€ä¸ªæ–°çš„ ajax é•¿é“¾æ¥</li>
</ol>
<h3 id="shi-zhan">å®æˆ˜</h3>
<h4 id="ke-hu-duan">å®¢æˆ·ç«¯</h4>
<pre data-lang="html" style="background-color:#f9f9f9;color:#111111;" class="language-html "><code class="language-html" data-lang="html"><span style="color:#5d9be5;">&lt;</span><span style="color:#c82728;">html</span><span style="color:#5d9be5;">&gt;
</span><span>  </span><span style="color:#5d9be5;">&lt;</span><span style="color:#c82728;">head</span><span style="color:#5d9be5;">&gt;
</span><span>    </span><span style="color:#5d9be5;">&lt;</span><span style="color:#c82728;">meta http-equiv</span><span style="color:#5d9ae5;">=</span><span style="color:#839c00;">&quot;Content-Type&quot; </span><span style="color:#c82728;">content</span><span style="color:#5d9ae5;">=</span><span style="color:#839c00;">&quot;text/html; charset=utf-8&quot; </span><span style="color:#5d9be5;">/&gt;
</span><span>    </span><span style="color:#5d9be5;">&lt;</span><span style="color:#c82728;">title</span><span style="color:#5d9be5;">&gt;</span><span>Comet Test</span><span style="color:#5d9be5;">&lt;/</span><span style="color:#c82728;">title</span><span style="color:#5d9be5;">&gt;
</span><span>  </span><span style="color:#5d9be5;">&lt;/</span><span style="color:#c82728;">head</span><span style="color:#5d9be5;">&gt;
</span><span>  </span><span style="color:#5d9be5;">&lt;</span><span style="color:#c82728;">body</span><span style="color:#5d9be5;">&gt;
</span><span>    </span><span style="color:#5d9be5;">&lt;</span><span style="color:#c82728;">p</span><span style="color:#5d9be5;">&gt;&lt;</span><span style="color:#c82728;">a class=</span><span style="color:#839c00;">&quot;customAlert&quot; </span><span style="color:#c82728;">href=</span><span style="color:#839c00;">&quot;#&quot;</span><span style="color:#5d9be5;">&gt;</span><span>publish customAlert</span><span style="color:#5d9be5;">&lt;/</span><span style="color:#c82728;">a</span><span style="color:#5d9be5;">&gt;&lt;/</span><span style="color:#c82728;">p</span><span style="color:#5d9be5;">&gt;
</span><span>    </span><span style="color:#5d9be5;">&lt;</span><span style="color:#c82728;">p</span><span style="color:#5d9be5;">&gt;&lt;</span><span style="color:#c82728;">a class=</span><span style="color:#839c00;">&quot;customAlert2&quot; </span><span style="color:#c82728;">href=</span><span style="color:#839c00;">&quot;#&quot;</span><span style="color:#5d9be5;">&gt;</span><span>publish customAlert2</span><span style="color:#5d9be5;">&lt;/</span><span style="color:#c82728;">a</span><span style="color:#5d9be5;">&gt;&lt;/</span><span style="color:#c82728;">p</span><span style="color:#5d9be5;">&gt;
</span><span>    </span><span style="color:#5d9be5;">&lt;</span><span style="color:#c82728;">script
</span><span style="color:#c82728;">      src=</span><span style="color:#839c00;">&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js&quot;
</span><span style="color:#c82728;">      type=</span><span style="color:#839c00;">&quot;text/javascript&quot;
</span><span style="color:#c82728;">    </span><span style="color:#5d9be5;">&gt;&lt;/</span><span style="color:#c82728;">script</span><span style="color:#5d9be5;">&gt;
</span><span>    </span><span style="color:#5d9be5;">&lt;</span><span style="color:#c82728;">script src=</span><span style="color:#839c00;">&quot;NovComet.js&quot; </span><span style="color:#c82728;">type=</span><span style="color:#839c00;">&quot;text/javascript&quot;</span><span style="color:#5d9be5;">&gt;&lt;/</span><span style="color:#c82728;">script</span><span style="color:#5d9be5;">&gt;
</span><span>    </span><span style="color:#5d9be5;">&lt;</span><span style="color:#c82728;">script type=</span><span style="color:#839c00;">&quot;text/javascript&quot;</span><span style="color:#5d9be5;">&gt;
</span><span>      </span><span style="color:#c99e00;">NovComet</span><span style="color:#4271ae;">.</span><span style="color:#c82728;">subscribe</span><span style="color:#4271ae;">(</span><span style="color:#839c00;">&#39;customAlert&#39;</span><span style="color:#4271ae;">, </span><span style="color:#8959a8;">function </span><span style="color:#4271ae;">(</span><span style="color:#f07219;">data</span><span style="color:#4271ae;">) {
</span><span style="color:#4271ae;">        </span><span style="color:#c99e00;">console</span><span style="color:#4271ae;">.log(</span><span style="color:#839c00;">&#39;customAlert&#39;</span><span style="color:#4271ae;">);
</span><span style="color:#4271ae;">        </span><span style="color:#8e908c;">//console.log(data);
</span><span style="color:#4271ae;">      })</span><span>.</span><span style="color:#c82728;">subscribe</span><span style="color:#4271ae;">(</span><span style="color:#839c00;">&#39;customAlert2&#39;</span><span style="color:#4271ae;">, </span><span style="color:#8959a8;">function </span><span style="color:#4271ae;">(</span><span style="color:#f07219;">data</span><span style="color:#4271ae;">) {
</span><span style="color:#4271ae;">        </span><span style="color:#c99e00;">console</span><span style="color:#4271ae;">.log(</span><span style="color:#839c00;">&#39;customAlert2&#39;</span><span style="color:#4271ae;">);
</span><span style="color:#4271ae;">        </span><span style="color:#8e908c;">//console.log(data);
</span><span style="color:#4271ae;">      })</span><span>;
</span><span>
</span><span>      </span><span style="color:#c82728;">$</span><span style="color:#4271ae;">(</span><span style="color:#c99e00;">document</span><span style="color:#4271ae;">)</span><span>.</span><span style="color:#c82728;">ready</span><span style="color:#4271ae;">(</span><span style="color:#8959a8;">function </span><span style="color:#4271ae;">() {
</span><span style="color:#4271ae;">        </span><span style="color:#c82728;">$</span><span style="color:#4271ae;">(</span><span style="color:#839c00;">&#39;a.customAlert&#39;</span><span style="color:#4271ae;">).</span><span style="color:#c82728;">click</span><span style="color:#4271ae;">(</span><span style="color:#8959a8;">function </span><span style="color:#4271ae;">(</span><span style="color:#f07219;">event</span><span style="color:#4271ae;">) {
</span><span style="color:#4271ae;">          </span><span style="color:#c99e00;">NovComet</span><span style="color:#4271ae;">.</span><span style="color:#c82728;">publish</span><span style="color:#4271ae;">(</span><span style="color:#839c00;">&#39;customAlert&#39;</span><span style="color:#4271ae;">);
</span><span style="color:#4271ae;">        });
</span><span style="color:#4271ae;">
</span><span style="color:#4271ae;">        </span><span style="color:#c82728;">$</span><span style="color:#4271ae;">(</span><span style="color:#839c00;">&#39;a.customAlert2&#39;</span><span style="color:#4271ae;">).</span><span style="color:#c82728;">click</span><span style="color:#4271ae;">(</span><span style="color:#8959a8;">function </span><span style="color:#4271ae;">(</span><span style="color:#f07219;">event</span><span style="color:#4271ae;">) {
</span><span style="color:#4271ae;">          </span><span style="color:#c99e00;">NovComet</span><span style="color:#4271ae;">.</span><span style="color:#c82728;">publish</span><span style="color:#4271ae;">(</span><span style="color:#839c00;">&#39;customAlert2&#39;</span><span style="color:#4271ae;">);
</span><span style="color:#4271ae;">        });
</span><span style="color:#4271ae;">        </span><span style="color:#c99e00;">NovComet</span><span style="color:#4271ae;">.</span><span style="color:#c82728;">run</span><span style="color:#4271ae;">();
</span><span style="color:#4271ae;">      })</span><span>;
</span><span>    </span><span style="color:#5d9be5;">&lt;/</span><span style="color:#c82728;">script</span><span style="color:#5d9be5;">&gt;
</span><span>  </span><span style="color:#5d9be5;">&lt;/</span><span style="color:#c82728;">body</span><span style="color:#5d9be5;">&gt;
</span><span style="color:#5d9be5;">&lt;/</span><span style="color:#c82728;">html</span><span style="color:#5d9be5;">&gt;
</span></code></pre>
<p>è¿™æ®µä»£ç è¯´çš„æ˜¯ï¼Œæœ‰ä¸ª NovComet çš„ Objectï¼Œæ³¨å†Œäº† customAlert å’Œ customAlert2 äº‹ä»¶ï¼Œå½“é¡µé¢è½½å…¥å®Œæˆæ—¶ï¼Œå¯¹ä¸¤ä¸ªæŒ‰é’®åˆåŠ äº†ç›‘å¬äº‹ä»¶ï¼Œå½“ç‚¹å‡»æ—¶ NovComet ä¼šå‘å¸ƒ customAlert æˆ– customAlert2 äº‹ä»¶ï¼Œç„¶å NovComet æ‰§è¡Œäº† run æ–¹æ³•ã€‚</p>
<h4 id="novcomet">NovComet</h4>
<pre data-lang="js" style="background-color:#f9f9f9;color:#111111;" class="language-js "><code class="language-js" data-lang="js"><span style="color:#8e908c;">//NovComet.js
</span><span style="color:#c82728;">NovComet </span><span style="color:#3e999f;">= </span><span>{
</span><span>  sleepTime: </span><span style="color:#f07219;">1000</span><span>,
</span><span>  _subscribed: {},
</span><span>  _timeout: </span><span style="color:#f07219;">undefined</span><span>,
</span><span>  _baseurl: </span><span style="color:#839c00;">&#39;comet.php&#39;</span><span>,
</span><span>  _args: </span><span style="color:#839c00;">&#39;&#39;</span><span>,
</span><span>  _urlParam: </span><span style="color:#839c00;">&#39;subscribed&#39;</span><span>,
</span><span>
</span><span>  </span><span style="color:#4271ae;">subscribe</span><span>: </span><span style="color:#8959a8;">function </span><span>(</span><span style="color:#f07219;">id</span><span>, </span><span style="color:#f07219;">callback</span><span>) {
</span><span>    </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">_subscribed</span><span>[</span><span style="color:#c82728;">id</span><span>] </span><span style="color:#3e999f;">= </span><span>{
</span><span>      cbk: </span><span style="color:#c82728;">callback</span><span>,
</span><span>      timestamp: </span><span style="color:#c82728;">NovComet</span><span style="color:#4271ae;">._getCurrentTimestamp</span><span>(),
</span><span>    };
</span><span>    </span><span style="color:#8959a8;">return </span><span style="color:#c82728;">NovComet</span><span>;
</span><span>  },
</span><span>
</span><span>  </span><span style="color:#4271ae;">_refresh</span><span>: </span><span style="color:#8959a8;">function </span><span>() {
</span><span>    </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">_timeout </span><span style="color:#3e999f;">= </span><span style="color:#4271ae;">setTimeout</span><span>(</span><span style="color:#8959a8;">function </span><span>() {
</span><span>      </span><span style="color:#c82728;">NovComet</span><span style="color:#4271ae;">.run</span><span>();
</span><span>    }, </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">sleepTime</span><span>);
</span><span>  },
</span><span>
</span><span>  </span><span style="color:#4271ae;">init</span><span>: </span><span style="color:#8959a8;">function </span><span>(</span><span style="color:#f07219;">baseurl</span><span>) {
</span><span>    </span><span style="color:#8959a8;">if </span><span>(</span><span style="color:#c82728;">baseurl </span><span style="color:#3e999f;">!= </span><span style="color:#f07219;">undefined</span><span>) {
</span><span>      </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">_baseurl </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">baseurl</span><span>;
</span><span>    }
</span><span>  },
</span><span>
</span><span>  </span><span style="color:#4271ae;">_getCurrentTimestamp</span><span>: </span><span style="color:#8959a8;">function </span><span>() {
</span><span>    </span><span style="color:#8959a8;">return </span><span style="color:#f07219;">Math</span><span style="color:#4271ae;">.round</span><span>(</span><span style="color:#3e999f;">new </span><span>Date()</span><span style="color:#4271ae;">.getTime</span><span>() </span><span style="color:#3e999f;">/ </span><span style="color:#f07219;">1000</span><span>);
</span><span>  },
</span><span>
</span><span>  </span><span style="color:#4271ae;">run</span><span>: </span><span style="color:#8959a8;">function </span><span>() {
</span><span>    </span><span style="color:#8959a8;">var </span><span style="color:#c82728;">cometCheckUrl </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">_baseurl </span><span style="color:#3e999f;">+ </span><span style="color:#839c00;">&#39;?&#39; </span><span style="color:#3e999f;">+ </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">_args</span><span>;
</span><span>    </span><span style="color:#8959a8;">for </span><span>(</span><span style="color:#8959a8;">var </span><span style="color:#c82728;">id </span><span style="color:#3e999f;">in </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">_subscribed</span><span>) {
</span><span>      </span><span style="color:#8959a8;">var </span><span style="color:#c82728;">currentTimestamp </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">_subscribed</span><span>[</span><span style="color:#c82728;">id</span><span>][</span><span style="color:#839c00;">&#39;timestamp&#39;</span><span>];
</span><span>
</span><span>      </span><span style="color:#c82728;">cometCheckUrl </span><span style="color:#3e999f;">+=
</span><span>        </span><span style="color:#839c00;">&#39;&amp;&#39; </span><span style="color:#3e999f;">+ </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">_urlParam </span><span style="color:#3e999f;">+ </span><span style="color:#839c00;">&#39;[&#39; </span><span style="color:#3e999f;">+ </span><span style="color:#c82728;">id </span><span style="color:#3e999f;">+ </span><span style="color:#839c00;">&#39;]=&#39; </span><span style="color:#3e999f;">+ </span><span style="color:#c82728;">currentTimestamp</span><span>;
</span><span>    }
</span><span>    </span><span style="color:#c82728;">cometCheckUrl </span><span style="color:#3e999f;">+= </span><span style="color:#839c00;">&#39;&amp;&#39; </span><span style="color:#3e999f;">+ </span><span style="color:#c82728;">NovComet</span><span style="color:#4271ae;">._getCurrentTimestamp</span><span>();
</span><span>    </span><span style="color:#c82728;">$</span><span style="color:#4271ae;">.getJSON</span><span>(</span><span style="color:#c82728;">cometCheckUrl</span><span>, </span><span style="color:#8959a8;">function </span><span>(</span><span style="color:#f07219;">data</span><span>) {
</span><span>      </span><span style="color:#8959a8;">switch </span><span>(</span><span style="color:#c82728;">data</span><span>.</span><span style="color:#c82728;">s</span><span>) {
</span><span>        </span><span style="color:#8959a8;">case </span><span style="color:#f07219;">0</span><span>: </span><span style="color:#8e908c;">// sin cambios
</span><span>          </span><span style="color:#c82728;">NovComet</span><span style="color:#4271ae;">._refresh</span><span>();
</span><span>          </span><span style="color:#8959a8;">break</span><span>;
</span><span>        </span><span style="color:#8959a8;">case </span><span style="color:#f07219;">1</span><span>: </span><span style="color:#8e908c;">// trigger
</span><span>          </span><span style="color:#8959a8;">for </span><span>(</span><span style="color:#8959a8;">var </span><span style="color:#c82728;">id </span><span style="color:#3e999f;">in </span><span style="color:#c82728;">data</span><span>[</span><span style="color:#839c00;">&#39;k&#39;</span><span>]) {
</span><span>            </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">_subscribed</span><span>[</span><span style="color:#c82728;">id</span><span>][</span><span style="color:#839c00;">&#39;timestamp&#39;</span><span>] </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">data</span><span>[</span><span style="color:#839c00;">&#39;k&#39;</span><span>][</span><span style="color:#c82728;">id</span><span>];
</span><span>            </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">_subscribed</span><span>[</span><span style="color:#c82728;">id</span><span>]</span><span style="color:#4271ae;">.cbk</span><span>(</span><span style="color:#c82728;">data</span><span>.</span><span style="color:#c82728;">k</span><span>);
</span><span>          }
</span><span>          </span><span style="color:#c82728;">NovComet</span><span style="color:#4271ae;">._refresh</span><span>();
</span><span>          </span><span style="color:#8959a8;">break</span><span>;
</span><span>      }
</span><span>    });
</span><span>  },
</span><span>
</span><span>  </span><span style="color:#4271ae;">publish</span><span>: </span><span style="color:#8959a8;">function </span><span>(</span><span style="color:#f07219;">id</span><span>) {
</span><span>    </span><span style="color:#8959a8;">var </span><span style="color:#c82728;">cometPublishUrl </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">_baseurl </span><span style="color:#3e999f;">+ </span><span style="color:#839c00;">&#39;?&#39; </span><span style="color:#3e999f;">+ </span><span style="color:#c82728;">NovComet</span><span>.</span><span style="color:#c82728;">_args</span><span>;
</span><span>    </span><span style="color:#c82728;">cometPublishUrl </span><span style="color:#3e999f;">+= </span><span style="color:#839c00;">&#39;&amp;publish=&#39; </span><span style="color:#3e999f;">+ </span><span style="color:#c82728;">id</span><span>;
</span><span>    </span><span style="color:#c82728;">$</span><span style="color:#4271ae;">.getJSON</span><span>(</span><span style="color:#c82728;">cometPublishUrl</span><span>);
</span><span>  },
</span><span>};
</span></code></pre>
<p>NovComet çš„ run æ–¹æ³•é¦–å…ˆæŠŠä¹‹å‰æ³¨å†Œçš„å‡ ä¸ªäº‹ä»¶ä¸²æˆä¸€ä¸ª urlï¼Œå¹¶ä¸”å¾ˆç‹¡çŒ¾åœ°ä½¿ç”¨äº†&quot;[]&quot;ï¼Œç±»ä¼¼:
?subscribed[customAlert]=1300016814&amp;subscribed[customAlert2]=1300016814&amp;1300016825ï¼Œè¿™æ · php æ”¶åˆ°åï¼Œå°±ä¼šå¾—åˆ°$_GET[subscribed]æ•°ç»„ï¼Œæœ€åé‚£ä¸ªæ—¶é—´æˆ³æ˜¯ä¸ºäº†é¿å…è¯·æ±‚è¢«ç¼“å­˜ã€‚å¦‚æœæ”¶åˆ°åå°ä¼ è¿‡æ¥çš„æ•°æ® data çš„ s å€¼ä¸º 0ï¼Œè¯´æ˜ä»€ä¹ˆä¹Ÿæ²¡å‘ç”Ÿï¼Œéš” 1 ç§’åç»§ç»­æ‰§è¡Œï¼›å¦‚æœ data.s çš„å€¼ä¸º 1ï¼Œè¯´æ˜ NovComet çš„ publish äº‹ä»¶è¢«è§¦å‘ï¼Œåˆ™è°ƒç”¨å¯¹åº”çš„ callbackã€‚</p>
<p>publish æ–¹æ³•æ‰§è¡Œåï¼Œä¼šæ„é€ ä¸€ä¸ªç±»ä¼¼: ?publish=customAlert è¿™æ ·ä¸€ä¸ª url å‘é€åˆ°åå°ã€‚åå°æ£€æµ‹åˆ° pubish å‚æ•°ï¼Œåˆ™è·å–è¯¥å‚æ•°çš„å€¼ï¼Œå¹¶æ›´æ–°å¯¹åº”æ–‡ä»¶çš„ mtimeã€‚</p>
<h4 id="fu-wu-duan">æœåŠ¡ç«¯</h4>
<pre data-lang="php" style="background-color:#f9f9f9;color:#111111;" class="language-php "><code class="language-php" data-lang="php"><span style="color:#f07219;">&lt;?php
</span><span style="color:#8e908c;">// comet.php
</span><span style="color:#8959a8;">include</span><span>(</span><span style="color:#839c00;">&#39;NovComet.php&#39;</span><span>);
</span><span>
</span><span style="color:#c82728;">$comet </span><span style="color:#3e999f;">= </span><span style="color:#8959a8;">new </span><span style="color:#c99e00;">NovComet</span><span>();
</span><span style="color:#c82728;">$publish </span><span style="color:#3e999f;">= </span><span style="color:#4271ae;">filter_input(</span><span style="color:#f07219;">INPUT_GET</span><span style="color:#4271ae;">, </span><span style="color:#839c00;">&#39;publish&#39;</span><span style="color:#4271ae;">, </span><span style="color:#f07219;">FILTER_SANITIZE_STRING</span><span style="color:#4271ae;">)</span><span>;
</span><span style="color:#8959a8;">if </span><span>(</span><span style="color:#c82728;">$publish </span><span style="color:#3e999f;">!= </span><span style="color:#839c00;">&#39;&#39;</span><span>) {
</span><span>    </span><span style="color:#4271ae;">echo </span><span style="color:#c82728;">$comet</span><span style="color:#4271ae;">-&gt;</span><span style="color:#c82728;">publish</span><span style="color:#4271ae;">(</span><span style="color:#c82728;">$publish</span><span style="color:#4271ae;">)</span><span>;
</span><span>} </span><span style="color:#8959a8;">else </span><span>{
</span><span>    </span><span style="color:#8959a8;">foreach </span><span>(</span><span style="color:#4271ae;">filter_var_array(</span><span style="color:#c82728;">$_GET</span><span style="color:#4271ae;">[</span><span style="color:#839c00;">&#39;subscribed&#39;</span><span style="color:#4271ae;">], </span><span style="color:#f07219;">FILTER_SANITIZE_NUMBER_INT</span><span style="color:#4271ae;">) </span><span style="color:#3e999f;">as </span><span style="color:#c82728;">$key </span><span style="color:#3e999f;">=&gt; </span><span style="color:#c82728;">$value</span><span>) {
</span><span>        </span><span style="color:#c82728;">$comet</span><span style="color:#4271ae;">-&gt;</span><span style="color:#c82728;">setVar</span><span style="color:#4271ae;">(</span><span style="color:#c82728;">$key</span><span style="color:#4271ae;">, </span><span style="color:#c82728;">$value</span><span style="color:#4271ae;">)</span><span>;
</span><span>    }
</span><span>    </span><span style="color:#4271ae;">echo </span><span style="color:#c82728;">$comet</span><span style="color:#4271ae;">-&gt;</span><span style="color:#c82728;">run</span><span style="color:#4271ae;">()</span><span>;
</span><span>}
</span></code></pre>
<p>å¦‚æœæ”¶åˆ° publish å‚æ•°ï¼Œç›´æ¥è¾“å‡ºï¼Œå¦åˆ™æ‰§è¡Œ run æ–¹æ³•ï¼Œè‡³äº run æ˜¯æ€ä¹ˆå›äº‹ï¼Œä¸”çœ‹ä¸‹ç ã€‚</p>
<pre data-lang="php" style="background-color:#f9f9f9;color:#111111;" class="language-php "><code class="language-php" data-lang="php"><span style="color:#f07219;">&lt;?php
</span><span style="color:#8e908c;">// NovComet.php
</span><span style="color:#8959a8;">class </span><span style="color:#c99e00;">NovComet </span><span>{
</span><span>    </span><span style="color:#8959a8;">const </span><span>COMET_OK </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">0</span><span>;
</span><span>    </span><span style="color:#8959a8;">const </span><span>COMET_CHANGED </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">1</span><span>;
</span><span>
</span><span>    </span><span style="color:#8959a8;">private </span><span style="color:#c82728;">$_tries</span><span>;
</span><span>    </span><span style="color:#8959a8;">private </span><span style="color:#c82728;">$_var</span><span>;
</span><span>    </span><span style="color:#8959a8;">private </span><span style="color:#c82728;">$_sleep</span><span>;
</span><span>    </span><span style="color:#8959a8;">private </span><span style="color:#c82728;">$_ids </span><span style="color:#3e999f;">= </span><span style="color:#4271ae;">array</span><span>();
</span><span>    </span><span style="color:#8959a8;">private </span><span style="color:#c82728;">$_callback </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">null</span><span>;
</span><span>
</span><span>    </span><span style="color:#8959a8;">public function  </span><span style="color:#4271ae;">__construct</span><span>(</span><span style="color:#f07219;">$tries </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">20</span><span>, </span><span style="color:#f07219;">$sleep </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">2</span><span>)
</span><span>    {
</span><span>        </span><span style="color:#c82728;">$this</span><span>-&gt;</span><span style="color:#c82728;">_tries </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">$tries</span><span>;
</span><span>        </span><span style="color:#c82728;">$this</span><span>-&gt;</span><span style="color:#c82728;">_sleep </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">$sleep</span><span>;
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#8959a8;">public function </span><span style="color:#4271ae;">setVar</span><span>(</span><span style="color:#f07219;">$key</span><span>, </span><span style="color:#f07219;">$value</span><span>)
</span><span>    {
</span><span>        </span><span style="color:#c82728;">$this</span><span>-&gt;</span><span style="color:#c82728;">_vars</span><span>[</span><span style="color:#c82728;">$key</span><span>] </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">$value</span><span>;
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#8959a8;">public function </span><span style="color:#4271ae;">setTries</span><span>(</span><span style="color:#f07219;">$tries</span><span>)
</span><span>    {
</span><span>        </span><span style="color:#c82728;">$this</span><span>-&gt;</span><span style="color:#c82728;">_tries </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">$tries</span><span>;
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#8959a8;">public function </span><span style="color:#4271ae;">setSleepTime</span><span>(</span><span style="color:#f07219;">$sleep</span><span>)
</span><span>    {
</span><span>        </span><span style="color:#c82728;">$this</span><span>-&gt;</span><span style="color:#c82728;">_sleep </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">$sleep</span><span>;
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#8959a8;">public function </span><span style="color:#4271ae;">setCallbackCheck</span><span>(</span><span style="color:#f07219;">$callback</span><span>)
</span><span>    {
</span><span>        </span><span style="color:#c82728;">$this</span><span>-&gt;</span><span style="color:#c82728;">_callback </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">$callback</span><span>;
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#8959a8;">const </span><span>DEFAULT_COMET_PATH </span><span style="color:#3e999f;">= </span><span style="color:#839c00;">&quot;/dev/shm/%s.comet&quot;</span><span>;
</span><span>
</span><span>    </span><span style="color:#8959a8;">public function </span><span style="color:#4271ae;">run</span><span>() {
</span><span>        </span><span style="color:#8959a8;">if </span><span>(</span><span style="color:#4271ae;">is_null(</span><span style="color:#c82728;">$this</span><span style="color:#4271ae;">-&gt;</span><span style="color:#c82728;">_callback</span><span style="color:#4271ae;">)</span><span>) {
</span><span>            </span><span style="color:#c82728;">$defaultCometPAth </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">self</span><span>::DEFAULT_COMET_PATH;
</span><span>            </span><span style="color:#c82728;">$callback </span><span style="color:#3e999f;">= </span><span style="color:#8959a8;">function</span><span>(</span><span style="color:#f07219;">$id</span><span>) </span><span style="color:#8959a8;">use </span><span>(</span><span style="color:#f07219;">$defaultCometPAth</span><span>) {
</span><span>                </span><span style="color:#c82728;">$cometFile </span><span style="color:#3e999f;">= </span><span style="color:#4271ae;">sprintf(</span><span style="color:#c82728;">$defaultCometPAth</span><span style="color:#4271ae;">, </span><span style="color:#c82728;">$id</span><span style="color:#4271ae;">)</span><span>;
</span><span>                </span><span style="color:#8959a8;">return </span><span>(</span><span style="color:#4271ae;">is_file(</span><span style="color:#c82728;">$cometFile</span><span style="color:#4271ae;">)</span><span>) ? </span><span style="color:#4271ae;">filemtime(</span><span style="color:#c82728;">$cometFile</span><span style="color:#4271ae;">)</span><span> : </span><span style="color:#f07219;">0</span><span>;
</span><span>            };
</span><span>        } </span><span style="color:#8959a8;">else </span><span>{
</span><span>            </span><span style="color:#c82728;">$callback </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">$this</span><span>-&gt;</span><span style="color:#c82728;">_callback</span><span>;
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#8959a8;">for </span><span>(</span><span style="color:#c82728;">$i </span><span style="color:#3e999f;">= </span><span style="color:#f07219;">0</span><span>; </span><span style="color:#c82728;">$i </span><span style="color:#3e999f;">&lt; </span><span style="color:#c82728;">$this</span><span>-&gt;</span><span style="color:#c82728;">_tries</span><span>; </span><span style="color:#c82728;">$i</span><span style="color:#3e999f;">++</span><span>) {
</span><span>            </span><span style="color:#8959a8;">foreach </span><span>(</span><span style="color:#c82728;">$this</span><span>-&gt;</span><span style="color:#c82728;">_vars </span><span style="color:#3e999f;">as </span><span style="color:#c82728;">$id </span><span style="color:#3e999f;">=&gt; </span><span style="color:#c82728;">$timestamp</span><span>) {
</span><span>                </span><span style="color:#8959a8;">if </span><span>((</span><span style="color:#8959a8;">integer</span><span>) </span><span style="color:#c82728;">$timestamp </span><span style="color:#3e999f;">== </span><span style="color:#f07219;">0</span><span>) {
</span><span>                    </span><span style="color:#c82728;">$timestamp </span><span style="color:#3e999f;">= </span><span style="color:#4271ae;">time()</span><span>;
</span><span>                }
</span><span>                </span><span style="color:#c82728;">$fileTimestamp </span><span style="color:#3e999f;">= </span><span style="color:#4271ae;">$</span><span style="color:#c82728;">callback</span><span style="color:#4271ae;">(</span><span style="color:#c82728;">$id</span><span style="color:#4271ae;">)</span><span>;
</span><span>                </span><span style="color:#8959a8;">if </span><span>(</span><span style="color:#c82728;">$fileTimestamp </span><span style="color:#3e999f;">&gt; </span><span style="color:#c82728;">$timestamp</span><span>) {
</span><span>                    </span><span style="color:#c82728;">$out</span><span>[</span><span style="color:#c82728;">$id</span><span>] </span><span style="color:#3e999f;">= </span><span style="color:#c82728;">$fileTimestamp</span><span>;
</span><span>                }
</span><span>                </span><span style="color:#4271ae;">clearstatcache()</span><span>;
</span><span>            }
</span><span>            </span><span style="color:#8959a8;">if </span><span>(</span><span style="color:#4271ae;">count(</span><span style="color:#c82728;">$out</span><span style="color:#4271ae;">) </span><span style="color:#3e999f;">&gt; </span><span style="color:#f07219;">0</span><span>) {
</span><span>                </span><span style="color:#8959a8;">return </span><span style="color:#4271ae;">json_encode(array(</span><span style="color:#839c00;">&#39;s&#39; </span><span style="color:#3e999f;">=&gt; </span><span style="color:#c82728;">self</span><span style="color:#4271ae;">::</span><span>COMET_CHANGED</span><span style="color:#4271ae;">, </span><span style="color:#839c00;">&#39;k&#39; </span><span style="color:#3e999f;">=&gt; </span><span style="color:#c82728;">$out</span><span style="color:#4271ae;">))</span><span>;
</span><span>            }
</span><span>            </span><span style="color:#4271ae;">sleep(</span><span style="color:#c82728;">$this</span><span style="color:#4271ae;">-&gt;</span><span style="color:#c82728;">_sleep</span><span style="color:#4271ae;">)</span><span>;
</span><span>        }
</span><span>        </span><span style="color:#8959a8;">return </span><span style="color:#4271ae;">json_encode(array(</span><span style="color:#839c00;">&#39;s&#39; </span><span style="color:#3e999f;">=&gt; </span><span style="color:#c82728;">self</span><span style="color:#4271ae;">::</span><span>COMET_OK</span><span style="color:#4271ae;">))</span><span>;
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#8959a8;">public function </span><span style="color:#4271ae;">publish</span><span>(</span><span style="color:#f07219;">$id</span><span>)
</span><span>    {
</span><span>        </span><span style="color:#8959a8;">return </span><span style="color:#4271ae;">json_encode(touch(sprintf(</span><span style="color:#c82728;">self</span><span style="color:#4271ae;">::</span><span>DEFAULT_COMET_PATH</span><span style="color:#4271ae;">, </span><span style="color:#c82728;">$id</span><span style="color:#4271ae;">)))</span><span>;
</span><span>    }
</span><span>}
</span></code></pre>
<p>å¯ä»¥çœ‹åˆ° publish æ—¶ï¼Œåˆ›å»ºäº†ä¸€ä¸ªä»¥$idå‘½åçš„æ–‡ä»¶ã€‚runæ—¶ï¼Œå¦‚æœå‘ç°è¯¥$id æ–‡ä»¶å­˜åœ¨ï¼Œä¸”æ—¶é—´æˆ³å¤§äºä¹‹å‰ä¿å­˜çš„è¯¥$idå¯¹åº”çš„æ—¶é—´æˆ³(é€šè¿‡setVarè®¾ç½®çš„)ï¼Œè¯´æ˜$id äº‹ä»¶è¢«è§¦å‘ï¼Œå¤„ç†å®ŒåæŠŠ$idæ”¾åˆ°$out æ•°ç»„ä¸­ï¼Œç„¶ååˆ¤æ–­ä¸€ä¸‹$out æ•°ç»„æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™è¾“å‡ºä¸€æ®µ jsonã€‚</p>
<p>å¦‚æœä¸€æ®µæ—¶é—´å†…éƒ½æ²¡æœ‰è§¦å‘äº‹ä»¶(for å¾ªç¯æ‰§è¡Œå®Œæ¯•)ï¼Œä¹Ÿè¾“å‡ºä¸€æ®µ jsonï¼Œå‘Šè¯‰å‰ç«¯æ‰§è¡Œå®Œäº†ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•æ–°æƒ…å†µã€‚</p>
<h4 id="shuo-ming">è¯´æ˜</h4>
<ul>
<li>å¯ä»¥åœ¨å®¢æˆ·ç«¯ç›‘å¬/å‘å¸ƒå¤šä¸ªäº‹ä»¶</li>
<li>ç›‘å¬äº‹ä»¶æ—¶ï¼Œå¯ä»¥ä¼ ä¸€ä¸ª callbackï¼Œè¿™æ ·æ”¶åˆ°æ•°æ®æ—¶å°±ä¼šå‡ºå‘è¯¥ callback</li>
<li>å½“ç›‘å¬äº‹ä»¶æ—¶ï¼Œä¼šä¼ ä¸€ä¸ªæ—¶é—´æˆ³</li>
<li>å½“äº‹ä»¶è¢« publish æ—¶ï¼Œä¼šå‘åå°å‘ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªæ–°çš„æ—¶é—´æˆ³</li>
<li>æœåŠ¡ç«¯ä¸ä¼šä¸€ç›´æ‰§è¡Œï¼Œå¦‚æœæŒ‡å®šæ—¶é—´å†…ï¼Œæ²¡æœ‰ä»»ä½•è¯·æ±‚è¢«è§¦å‘ï¼Œåˆ™ç»“æŸè¿è¡Œ</li>
<li>å®¢æˆ·ç«¯ä¼šé‡å¤ä¸Šè¿°è¿‡ç¨‹(setTimeout &amp; NovComet.run())</li>
</ul>
<p>æœ€åæ¥ä¸€å¼ å›¾è¯´æ˜ä¸€ä¸‹</p>

<p  style="text-align:center" ><img src="&#x2F;posts&#x2F;php-comet&#x2F;comet-firebug.png"
        width="640" /></p>
<ol>
<li>è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œæ²¡æœ‰æ”¶åˆ°ä»»ä½• publish äº‹ä»¶ï¼ŒæœåŠ¡ç«¯ç»“æŸæ‰§è¡Œ</li>
<li>æœåŠ¡ç«¯è¿”å›ä¸€æ®µ json</li>
<li>å®¢æˆ·ç«¯è§¦å‘äº†ä¸€ä¸ªäº‹ä»¶ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°äº‹ä»¶ï¼Œè¿”å›ä¸€æ®µæ–°çš„ json</li>
<li>callback è¢«è§¦å‘</li>
<li>å®¢æˆ·ç«¯è¿›å…¥ä¸‹ä¸€æ¬¡çš„ ajax é•¿é“¾æ¥æŸ¥è¯¢</li>
</ol>

  </div>


  <ul class="tags flex flex-wrap justify-center items-center gap-4 mt-5 mb-8 text-lg">
    
    
    <li
      class="px-4 pb-[2px] leading-8 rounded-full border text-gray-700 border-gray-700 hover:text-gray-100 hover:border-gray-900 hover:bg-gray-900 transition-all">
      <a class="inline-block" href="https://limboy.me/tags/programming/">programming</a>
    </li>
    
    <li
      class="px-4 pb-[2px] leading-8 rounded-full border text-gray-700 border-gray-700 hover:text-gray-100 hover:border-gray-900 hover:bg-gray-900 transition-all">
      <a class="inline-block" href="https://limboy.me/tags/php/">php</a>
    </li>
    
    
  </ul>

  
  <script src="https://giscus.app/client.js" data-repo="limboy/telescope"
    data-repo-id="MDEwOlJlcG9zaXRvcnkzODEwOTA2MTg=" data-category="General"
    data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMzMDY2MTQy" data-mapping="title" data-reactions-enabled="1"
    data-emit-metadata="0" data-theme="light" data-lang="en" crossorigin="anonymous" async>
    </script>
  

  

</div>

      </div>
    </div>
    
    <footer
      class="flex border-t border-gray-300 text-gray-600 bg-gray-50 items-center justify-center h-12 text-sm mt-2">
      <div class="flex inner justify-center gap-4">
        <a class="hover:underline" href="https://github.com/limboy" target="_blank">GitHub</a>
        <a class="hover:underline" href="https://twitter.com/_limboy" target="_blank">Twitter</a>
        <a class="hover:underline" href="https://limboy.me/index.xml">RSS</a>
      </div>
    </footer>
    
  </div>

  
  

  <script>
    // éƒ½æ˜¯ä¸ºäº† iOS...
    document.querySelector("#wrapper").style.minHeight = `calc(${window.innerHeight}px - 6.5rem)`
    window.addEventListener('resize', () => {
      document.querySelector("#wrapper").style.minHeight = `calc(${window.innerHeight}px - 6.5rem)`
    })
  </script>
</body>

</html>